(function(){})();(function(){"use strict";var VPython_import=null;var VPython_names=[];var waitlist=[new RegExp("^rate\\s*\\("),new RegExp("sleep\\s*\\("),new RegExp("^get_library\\s*\\("),new RegExp("\\.waitfor\\s*\\("),new RegExp("\\.pause\\s*\\("),new RegExp("=\\s*read_local_file\\s*\\(")];function waits(line){for(var i=0;i<waitlist.length;i++){var patt=waitlist[i];if(line.search(patt)>=0){var end=line.lastIndexOf(")");var lastparen=end;var parencnt=1;var spaces="";var name="";while(end>=0){end--;if(end<0)break;switch(line[end]){case")":parencnt++;break;case"(":parencnt--;if(parencnt===0){if(name.length===0)return line.slice(0,end)+"(wait"+spaces+")";else{if(name=="wait")return line.slice(0,lastparen)+spaces+" )";return line.slice(0,lastparen)+","+spaces+"wait)"}}break;case",":if(parencnt===1){if(name=="wait")return line.slice(0,end)+","+spaces+" wait)";return line}break;case" ":spaces=" "+spaces;break;default:name=line[end]+name}}}}return line}function preprocess(program,lang){var c,lineno,lines,line,m,start;var parens=0,brackets=0,braces=0;var lastleftparens=null,lastleftbracket=null,lastleftbrace=null;var indent="";var getline=/(^\s*)(.*)/;var newprogram="",lastindent="";var firstquote=0;var continuedline=false;var indef=false;var delim='"';var defindents=[];var whenpatt=/when[ ]/;var pickpatt=/(\.pick)\s*(.)/;var defpatt=/def[^:]*:/;var classpatt=/class[^:]*:/;var decoration;lines=program.split("\n");for(lineno=0;lineno<lines.length;lineno++){decoration="";m=lines[lineno].match(getline);indent=m[1];line=m[2];if(line[0]=="#")continue;if(line[0]=="@"){var nextline=lines[lineno+1];m=nextline.match(getline);if(m[2].slice(0,3)=="def"||m[2].slice(0,6)=="module"){decoration=line;indent=m[1];line=m[2];lineno++}else{continue}}if(line.length===0)continue;if(lang=="vpython"){if(defindents.length>0&&indent.length<=defindents[defindents.length-1][1])defindents.pop();if(VPython_import===null)VPython_names=[];var w=line.split(" ");if(w[1]=="__future__")continue;if(w[1]=="visual.factorial")continue;if(w[0]=="from"&&w[2]=="import"&&w.length>=4){if(w[1]=="visual.graph"){if(w[3]=="*")continue;return'ERROR: Currently only "from visual.graph import *" is supported, line '+(lineno+2)+": "+lines[lineno]}if(!(w[1]=="visual"||w[1]=="vis")){throw new Error("Line "+(lineno+2)+": cannot import from "+w[1])}if(VPython_import===null){if(w[3]=="*")continue;VPython_import=w[1];for(var j=3;j<w.length;j++){if(w[j].length>0&&w[j]!=","){if(w[j].slice(-1)==",")w[j]=w[j].slice(0,-1);if(w[j]==" "||w[j]=="("||w[j]==")"||w[j][0]=="("||w[j][-1]==")")continue;VPython_names.push(w[j])}}}continue}else if(w[0]=="import"&&w.length==2){if(w[1]=="visual.graph")return'ERROR: Currently only "from visual.graph import *" is supported, line '+(lineno+2)+": "+lines[lineno];if(!(w[1]=="visual"||w[1]=="vis")){return"ERROR: Cannot import from "+w[1]+", line "+(lineno+2)+": "+lines[lineno]}if(VPython_import===null){VPython_import=w[1]}continue}}var doublequote=false,singlequote=false,backslash=false;var previouscontinuedline=continuedline;var triplequote=false;var processedtriplequote=false;var tline="";for(var i=0;i<line.length;i++){var previousquote=singlequote||doublequote||triplequote;var char=line[i];if(char=="\\"&&i<line.length-1&&line[i+1]!==" "){i++;continue}switch(char){case"#":if(!singlequote&&!doublequote&&!triplequote){line=line.slice(0,i)}break;case'"':if(i<=line.length-3&&line[i+1]=='"'&&line[i+2]=='"'){if(triplequote&&i<=line.length-4&&line[i+3]=='"')break;triplequote=!triplequote;processedtriplequote=true;i+=2}else if(!triplequote&&!singlequote)doublequote=!doublequote;break;case"'":if(i<=line.length-3&&line[i+1]=="'"&&line[i+2]=="'"){if(triplequote&&i<=line.length-4&&line[i+3]=="'")break;triplequote=!triplequote;processedtriplequote=true;i+=2}else if(!triplequote&&!doublequote)singlequote=!singlequote;break}if(triplequote&&i==line.length-1&&lineno<lines.length-1){lineno++;line+="\n"+lines[lineno]}if(singlequote||doublequote||triplequote){if(i<line.length-1)continue;if(lineno===lines.length-1){var q="single";if(doublequote)q="double";else q="triple";return"ERROR: Unbalanced "+q+" quotes"}}switch(char){case":":if(parens==1){indef=true}break;case"(":if(i>0&&line[i-1]=="\\")break;if(parens===0)lastleftparens=lineno;parens++;break;case")":if(i>0&&line[i-1]=="\\")break;parens--;if(indef&&parens==0)indef=false;break;case"[":if(i>0&&line[i-1]=="\\")break;if(brackets===0)lastleftbracket=lineno;brackets++;break;case"]":if(i>0&&line[i-1]=="\\")break;brackets--;break;case"{":if(i>0&&line[i-1]=="\\")break;if(braces===0)lastleftbrace=lineno;braces++;break;case"}":if(i>0&&line[i-1]=="\\")break;braces--;break}if(char=="\\"){if(i==line.length-1||line[i+1]==" "||line[i+1]=="#")line=line.slice(0,i);backslash=true;break}}continuedline=!indef&&(backslash||parens>0||brackets>0||braces>0);if(lang=="vpython"&&!previousquote){var m=pickpatt.exec(line+" ");if(m){if(m[2]!="("&&m[2].search(/\w/)!=0){var i=m.index;line=line.slice(0,i)+".pick()"+line.slice(i+5)}}if(!processedtriplequote){line=line.replace(/global/,"nonlocal");line=line.replace(/\.mouse\.camera/g,".camera.pos");if(line.search(defpatt)>=0||line.search(classpatt)>=0){defindents.push([newprogram.length,indent.length])}else{var L=line.length;line=waits(line);if(line.length>L){while(true){var definfo=defindents.pop();if(definfo==undefined)break;var end=newprogram.slice(definfo[0]).search(/:/)+definfo[0];while(newprogram[end]!==")")end--;var i=end-1;while(newprogram[i]==" ")i--;var insert;if(newprogram[i]=="(")insert="wait";else insert=",wait";newprogram=newprogram.slice(0,end)+insert+newprogram.slice(end)}}}}}c="";if(indent.length<lastindent.length&&(line.charAt(0)==")"||line.substr(0,4)=="else"||(lang=="rapydscript"||lang=="vpython")&&(line.substr(0,4)=="elif"||line.substr(0,6)=="except"||line.substr(0,7)=="finally"))){c=lastindent+delim+(lineno+2)+delim+"\n"}else c=indent+delim+(lineno+2)+delim+"\n";if(lang=="rapydscript"||lang=="vpython"){if(indent.length==lastindent.length&&(line.substr(0,4)=="elif"||line.substr(0,4)=="else")){c=""}else if(line.substr(0,3)=='"""'||line.substr(0,3)=="'''"||line[0]==")"){c=""}}if(lang=="rapydscript"||lang=="vpython"){if(previouscontinuedline){newprogram=newprogram.slice(0,-1)+indent+line+"\n";indent=lastindent}else if(c==""){newprogram+="  "+indent+line+"\n"}else{if(decoration.length>0){newprogram+="  "+c+"  "+indent+decoration+"\n";newprogram+="  "+indent+line+"\n"}else{newprogram+="  "+c+"  "+indent+line+"\n"}}}else{newprogram+=c+lines[lineno]+"\n"}lastindent=indent;if(parens<0)return"ERROR: Too many right parentheses, line "+(lineno+2)+": "+lines[lineno];if(brackets<0)return"ERROR: Too many right brackets, line "+(lineno+2)+": "+lines[lineno];if(braces<0)return"ERROR: Too many right braces, line "+(lineno+2)+": "+lines[lineno]}if(parens>0)return"ERROR: Missing right parenthesis, see line "+(lastleftparens+2)+": "+lines[lastleftparens];else if(brackets>0)return"ERROR: Missing right bracket, see line "+(lastleftbracket+2)+": "+lines[lastleftbracket];else if(braces>0)return"ERROR: Missing right brace, see line "+(lastleftbrace+2)+": "+lines[lastleftbrace];else return newprogram}var CSdict={};function CSlineNumbers(prog){var patt=/\/\*(\d*)[ ]*\*\//;var linenum;var lines=prog.split("\n");for(var n=0;n<lines.length;n++){var getline=lines[n].match(patt);if(getline!==null)break}for(;n<lines.length;n++){var getline=lines[n].match(patt);if(getline!==null){linenum=getline[1];CSdict[n]=linenum}else{CSdict[n]=linenum}}}var endvars="  _$GS_$END=0";var linenopatt=/"(\d*)"/;var RS_OPTIONS={filename:"demo",toplevel:null,basedir:null,libdir:null};var OUTPUT_OPTS={beautify:true,private_scope:false};function compile_rapydscript(rs_input){if(rs_input.slice(0,7)=="ERROR: "){throw new Error(rs_input.slice(7))}else{var output=OutputStream(OUTPUT_OPTS);rs_input+="\n";try{var TOPLEVEL=parse(rs_input,RS_OPTIONS);TOPLEVEL.print(output);return output.toString()}catch(err){if(err.line===undefined){throw new Error(err.message)}else{var lines=rs_input.split("\n");var L=lines[err.line];var m=L.match(linenopatt);if(m!==null){throw new Error(err.message+"; line "+m[1]+": "+lines[err.line+1])}else{throw new Error(err.message+": "+lines[err.line])}}}}}var vp_primitives=["box","sphere","cylinder","pyramid","cone","helix","ellipsoid","ring","arrow","graph"];var vp_other=["display","vec","vector","rate","sleep","update","compound","color","vertex","triangle","quad","label","distant_light","local_light","attach_trail","attach_arrow","sqrt","pi","abs","sin","cos","tan","asin","acos","atan","atan2","exp","log","pow","factorial","combin","radians","degrees","gcurve","gdots","gvbars","ghbars","gdisplay","get_library","read_local_file"];function compile(program,options){options=options||{};var wait=options.wait||"wait";window.__original={text:program.split("\n")};window.__GSlang=options.lang;var version='["'+options.version+'", "glowscript"]';program=program.replace(/\.delete/g,".remove");if(options.lang=="rapydscript"||options.lang=="vpython"){program=preprocess(program,options.lang);if(program.slice(0,7)=="ERROR: "){compile_rapydscript(program)}else{var prog;if(options.lang=="rapydscript"){prog="def main("+wait+"):\n  version = "+version+"\n  window.__GSlang = 'rapydscript'\n  scene = canvas()\n  arange=range\n  _$rapyd$_Temp = 0\n  _$rapyd$_print = GSprint\n"+endvars+"\n"+program+"main"}else{prog="def main("+wait+"):\n  version = "+version+"\n";if(VPython_import===null){prog+="  window.__GSlang = 'vpython'\n";for(var i=0;i<vp_primitives.length;i++)prog+="  "+vp_primitives[i]+"=vp_"+vp_primitives[i]+"\n";prog+="  display=canvas\n  vector=vec\n"+endvars+"\n"}else if((VPython_import=="visual"||VPython_import=="vis")&&VPython_names.length>0){var vars="  window.__GSlang = 'vpython'\n";vars+="  vector=vec\n";for(var i=0;i<vp_primitives.length;i++){var name=vp_primitives[i];var n=VPython_names.indexOf(name);if(n>=0)vars+="  "+name+"=vp_"+name+"\n";else vars+="  "+name+"=undefined\n"}var hasvector=VPython_names.indexOf("vector")>=0;for(var i=0;i<vp_other.length;i++){var name=vp_other[i];if(name=="vec"&&hasvector)continue;var n=VPython_names.indexOf(name);if(n>=0){if(name=="display")vars+="  display=canvas\n"}else vars+="  "+name+"=undefined\n"}prog+=vars}else if((VPython_import=="visual"||VPython_import=="vis")&&VPython_names.length==0){var importpatt;if(VPython_import=="visual")importpatt=/visual\.(\w+)/g;else importpatt=/vis\.(\w+)/g;var m=program.match(importpatt);if(VPython_import=="visual")importpatt=/visual\.(\w+)/;else importpatt=/vis\.(\w+)/;var attrs={};for(var i=0;i<m.length;i++){var a=importpatt.exec(m[i])[1];if(!(a in attrs))attrs[a]=a}var vars="  window.__GSlang = 'vpython'\n";var purge="";vars+="  "+VPython_import+"={";for(var i=0;i<vp_primitives.length;i++){var name=vp_primitives[i];if(name in attrs)vars+=name+":vp_"+name+", ";else purge+="  "+name+"=undefined\n"}for(var i=0;i<vp_other.length;i++){var name=vp_other[i];if(name in attrs){if(name=="display"&&name in attrs)vars+="display:canvas, ";else if(name=="vector")vars+="vector:vec, ";else vars+=name+":"+name+", "}else{if(name=="vec"&&"vector"in attrs)continue;purge+="  "+name+"=undefined\n"}}vars=vars.slice(0,-2)+"}\n";prog+=vars;prog+=purge}prog+="  scene = canvas()\n";prog+="  _$rapyd$_Temp=0\n  _$rapyd$_print=GSprint\n  arange=range\n";prog+=program+"main"}program=compile_rapydscript(prog);if(options.lang=="rapydscript"||options.lang=="vpython"){var start=program.indexOf("window.__GSlang");var arr="Array.prototype['+']=function(r) {return this.concat(r)};\n";program=program.slice(0,start)+arr+program.slice(start-4)}}}else{var prog="function main("+wait+") {\n";prog+="var version = "+version+";\n";prog+="var scene = canvas();\n";program=prog+program+"\n};\nmain"}var parsed=papercompile(program);var prog=Streamline.transform(parsed,{callback:"wait"});program=prog.replace(/\n\n\n\n/g,"");return program}window.glowscript_compile=compile})();function isNumeric(num){return num>=0||num<0&&parseInt(num)===num}var binaryOperators={"+":"add","-":"sub","*":"multiply","/":"divide"};var unaryOperators={"-":"negate","+":"plus"};!function(e,r){return"object"==typeof exports&&"object"==typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):(r(e.acorn||(e.acorn={})),void 0)}(this,function(e){"use strict";function r(e){fr=e||{};for(var r in hr)Object.prototype.hasOwnProperty.call(fr,r)||(fr[r]=hr[r]);mr=fr.sourceFile||null}function t(e,r){var t=vr(pr,e);r+=" ("+t.line+":"+t.column+")";var n=new SyntaxError(r);throw n.pos=e,n.loc=t,n.raisedAt=br,n}function n(e){function r(e){if(1==e.length)return t+="return str === "+JSON.stringify(e[0])+";";t+="switch(str){";for(var r=0;r<e.length;++r)t+="case "+JSON.stringify(e[r])+":";t+="return true}return false;"}e=e.split(" ");var t="",n=[];e:for(var a=0;a<e.length;++a){for(var o=0;o<n.length;++o)if(n[o][0].length==e[a].length){n[o].push(e[a]);continue e}n.push([e[a]])}if(n.length>3){n.sort(function(e,r){return r.length-e.length}),t+="switch(str.length){";for(var a=0;a<n.length;++a){var i=n[a];t+="case "+i[0].length+":",r(i)}t+="}"}else r(e);return new Function("str",t)}function a(){this.line=Ar,this.column=br-Sr}function o(){Ar=1,br=Sr=0,Er=!0,u()}function i(e,r){gr=br,fr.locations&&(kr=new a),wr=e,u(),Cr=r,Er=e.beforeExpr}function s(){var e=fr.onComment&&fr.locations&&new a,r=br,n=pr.indexOf("*/",br+=2);if(-1===n&&t(br-2,"Unterminated comment"),br=n+2,fr.locations){Kt.lastIndex=r;for(var o;(o=Kt.exec(pr))&&o.index<br;)++Ar,Sr=o.index+o[0].length}fr.onComment&&fr.onComment(!0,pr.slice(r+2,n),r,br,e,fr.locations&&new a)}function c(){for(var e=br,r=fr.onComment&&fr.locations&&new a,t=pr.charCodeAt(br+=2);dr>br&&10!==t&&13!==t&&8232!==t&&8329!==t;)++br,t=pr.charCodeAt(br);fr.onComment&&fr.onComment(!1,pr.slice(e+2,br),e,br,r,fr.locations&&new a)}function u(){for(;dr>br;){var e=pr.charCodeAt(br);if(32===e)++br;else if(13===e){++br;var r=pr.charCodeAt(br);10===r&&++br,fr.locations&&(++Ar,Sr=br)}else if(10===e)++br,++Ar,Sr=br;else if(14>e&&e>8)++br;else if(47===e){var r=pr.charCodeAt(br+1);if(42===r)s();else{if(47!==r)break;c()}}else if(160===e)++br;else{if(!(e>=5760&&Jt.test(String.fromCharCode(e))))break;++br}}}function l(){var e=pr.charCodeAt(br+1);return e>=48&&57>=e?E(!0):(++br,i(xt))}function f(){var e=pr.charCodeAt(br+1);return Er?(++br,k()):61===e?x(Et,2):x(wt,1)}function p(){var e=pr.charCodeAt(br+1);return 61===e?x(Et,2):x(Ft,1)}function d(e){var r=pr.charCodeAt(br+1);return r===e?x(124===e?Lt:Ut,2):61===r?x(Et,2):x(124===e?Rt:Vt,1)}function m(){var e=pr.charCodeAt(br+1);return 61===e?x(Et,2):x(Tt,1)}function h(e){var r=pr.charCodeAt(br+1);return r===e?x(St,2):61===r?x(Et,2):x(At,1)}function v(e){var r=pr.charCodeAt(br+1),t=1;return r===e?(t=62===e&&62===pr.charCodeAt(br+2)?3:2,61===pr.charCodeAt(br+t)?x(Et,t+1):x(jt,t)):(61===r&&(t=61===pr.charCodeAt(br+2)?3:2),x(Ot,t))}function b(e){var r=pr.charCodeAt(br+1);return 61===r?x(qt,61===pr.charCodeAt(br+2)?3:2):x(61===e?Ct:It,1)}function y(e){switch(e){case 46:return l();case 40:return++br,i(ht);case 41:return++br,i(vt);case 59:return++br,i(yt);case 44:return++br,i(bt);case 91:return++br,i(ft);case 93:return++br,i(pt);case 123:return++br,i(dt);case 125:return++br,i(mt);case 58:return++br,i(gt);case 63:return++br,i(kt);case 48:var r=pr.charCodeAt(br+1);if(120===r||88===r)return C();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return E(!1);case 34:case 39:return A(e);case 47:return f(e);case 37:case 42:return p();case 124:case 38:return d(e);case 94:return m();case 43:case 45:return h(e);case 60:case 62:return v(e);case 61:case 33:return b(e);case 126:return x(It,1)}return!1}function g(e){if(e?br=yr+1:yr=br,fr.locations&&(xr=new a),e)return k();if(br>=dr)return i(Br);var r=pr.charCodeAt(br);if(Qt(r)||92===r)return L();var n=y(r);if(n===!1){var o=String.fromCharCode(r);if("\\"===o||$t.test(o))return L();t(br,"Unexpected character '"+o+"'")}return n}function x(e,r){var t=pr.slice(br,br+r);br+=r,i(e,t)}function k(){for(var e,r,n="",a=br;;){br>=dr&&t(a,"Unterminated regular expression");var o=pr.charAt(br);if(Gt.test(o)&&t(a,"Unterminated regular expression"),e)e=!1;else{if("["===o)r=!0;else if("]"===o&&r)r=!1;else if("/"===o&&!r)break;e="\\"===o}++br}var n=pr.slice(a,br);++br;var s=I();return s&&!/^[gmsiy]*$/.test(s)&&t(a,"Invalid regexp flag"),i(jr,new RegExp(n,s))}function w(e,r){for(var t=br,n=0,a=0,o=null==r?1/0:r;o>a;++a){var i,s=pr.charCodeAt(br);if(i=s>=97?s-97+10:s>=65?s-65+10:s>=48&&57>=s?s-48:1/0,i>=e)break;++br,n=n*e+i}return br===t||null!=r&&br-t!==r?null:n}function C(){br+=2;var e=w(16);return null==e&&t(yr+2,"Expected hexadecimal number"),Qt(pr.charCodeAt(br))&&t(br,"Identifier directly after number"),i(Or,e)}function E(e){var r=br,n=!1,a=48===pr.charCodeAt(br);e||null!==w(10)||t(r,"Invalid number"),46===pr.charCodeAt(br)&&(++br,w(10),n=!0);var o=pr.charCodeAt(br);(69===o||101===o)&&(o=pr.charCodeAt(++br),(43===o||45===o)&&++br,null===w(10)&&t(r,"Invalid number"),n=!0),Qt(pr.charCodeAt(br))&&t(br,"Identifier directly after number");var s,c=pr.slice(r,br);return n?s=parseFloat(c):a&&1!==c.length?/[89]/.test(c)||Vr?t(r,"Invalid number"):s=parseInt(c,8):s=parseInt(c,10),i(Or,s)}function A(e){br++;for(var r="";;){br>=dr&&t(yr,"Unterminated string constant");var n=pr.charCodeAt(br);if(n===e)return++br,i(Fr,r);if(92===n){n=pr.charCodeAt(++br);var a=/^[0-7]+/.exec(pr.slice(br,br+3));for(a&&(a=a[0]);a&&parseInt(a,8)>255;)a=a.slice(0,a.length-1);if("0"===a&&(a=null),++br,a)Vr&&t(br-2,"Octal literal in strict mode"),r+=String.fromCharCode(parseInt(a,8)),br+=a.length-1;else switch(n){case 110:r+="\n";break;case 114:r+="\r";break;case 120:r+=String.fromCharCode(S(2));break;case 117:r+=String.fromCharCode(S(4));break;case 85:r+=String.fromCharCode(S(8));break;case 116:r+="	";break;case 98:r+="\b";break;case 118:r+="";break;case 102:r+="\f";break;case 48:r+="\x00";break;case 13:10===pr.charCodeAt(br)&&++br;case 10:fr.locations&&(Sr=br,++Ar);break;default:r+=String.fromCharCode(n)}}else(13===n||10===n||8232===n||8329===n)&&t(yr,"Unterminated string constant"),r+=String.fromCharCode(n),++br}}function S(e){var r=w(16,e);return null===r&&t(yr,"Bad character escape sequence"),r}function I(){Bt=!1;for(var e,r=!0,n=br;;){var a=pr.charCodeAt(br);if(Yt(a))Bt&&(e+=pr.charAt(br)),++br;else{if(92!==a)break;Bt||(e=pr.slice(n,br)),Bt=!0,117!=pr.charCodeAt(++br)&&t(br,"Expecting Unicode escape sequence \\uXXXX"),++br;var o=S(4),i=String.fromCharCode(o);i||t(br-1,"Invalid Unicode escape"),(r?Qt(o):Yt(o))||t(br-4,"Invalid Unicode escape"),e+=i}r=!1}return Bt?e:pr.slice(n,br)}function L(){var e=I(),r=Dr;return Bt||(Wt(e)?r=lt[e]:(fr.forbidReserved&&(3===fr.ecmaVersion?Mt:zt)(e)||Vr&&Xt(e))&&t(yr,"The keyword '"+e+"' is reserved")),i(r,e)}function U(){Ir=yr,Lr=gr,Ur=kr,g()}function R(e){for(Vr=e,br=Lr;Sr>br;)Sr=pr.lastIndexOf("\n",Sr-2)+1,--Ar;u(),g()}function T(){this.type=null,this.start=yr,this.end=null}function V(){this.start=xr,this.end=null,null!==mr&&(this.source=mr)}function q(){var e=new T;return fr.locations&&(e.loc=new V),fr.ranges&&(e.range=[yr,0]),e}function O(e){var r=new T;return r.start=e.start,fr.locations&&(r.loc=new V,r.loc.start=e.loc.start),fr.ranges&&(r.range=[e.range[0],0]),r}function j(e,r){return e.type=r,e.end=Lr,fr.locations&&(e.loc.end=Ur),fr.ranges&&(e.range[1]=Lr),e}function F(e){return fr.ecmaVersion>=5&&"ExpressionStatement"===e.type&&"Literal"===e.expression.type&&"use strict"===e.expression.value}function D(e){return wr===e?(U(),!0):void 0}function B(){return!fr.strictSemicolons&&(wr===Br||wr===mt||Gt.test(pr.slice(Lr,yr)))}function M(){D(yt)||B()||X()}function z(e){wr===e?U():X()}function X(){t(yr,"Unexpected token")}function N(e){"Identifier"!==e.type&&"MemberExpression"!==e.type&&t(e.start,"Assigning to rvalue"),Vr&&"Identifier"===e.type&&Nt(e.name)&&t(e.start,"Assigning to "+e.name+" in strict mode")}function W(e){Ir=Lr=br,fr.locations&&(Ur=new a),Rr=Vr=null,Tr=[],g();var r=e||q(),t=!0;for(e||(r.body=[]);wr!==Br;){var n=J();r.body.push(n),t&&F(n)&&R(!0),t=!1}return j(r,"Program")}function J(){wr===wt&&g(!0);var e=wr,r=q();switch(e){case Mr:case Nr:U();var n=e===Mr;D(yt)||B()?r.label=null:wr!==Dr?X():(r.label=lr(),M());for(var a=0;a<Tr.length;++a){var o=Tr[a];if(null==r.label||o.name===r.label.name){if(null!=o.kind&&(n||"loop"===o.kind))break;if(r.label&&n)break}}return a===Tr.length&&t(r.start,"Unsyntactic "+e.keyword),j(r,n?"BreakStatement":"ContinueStatement");case Wr:return U(),M(),j(r,"DebuggerStatement");case Pr:return U(),Tr.push(Zt),r.body=J(),Tr.pop(),z(tt),r.test=P(),M(),j(r,"DoWhileStatement");case _r:if(U(),Tr.push(Zt),z(ht),wr===yt)return $(r,null);if(wr===rt){var i=q();return U(),G(i,!0),1===i.declarations.length&&D(ut)?_(r,i):$(r,i)}var i=K(!1,!0);return D(ut)?(N(i),_(r,i)):$(r,i);case Gr:return U(),cr(r,!0);case Kr:return U(),r.test=P(),r.consequent=J(),r.alternate=D(Hr)?J():null,j(r,"IfStatement");case Qr:return Rr||t(yr,"'return' outside of function"),U(),D(yt)||B()?r.argument=null:(r.argument=K(),M()),j(r,"ReturnStatement");case Yr:U(),r.discriminant=P(),r.cases=[],z(dt),Tr.push(en);for(var s,c;wr!=mt;)if(wr===zr||wr===Jr){var u=wr===zr;s&&j(s,"SwitchCase"),r.cases.push(s=q()),s.consequent=[],U(),u?s.test=K():(c&&t(Ir,"Multiple default clauses"),c=!0,s.test=null),z(gt)}else s||X(),s.consequent.push(J());return s&&j(s,"SwitchCase"),U(),Tr.pop(),j(r,"SwitchStatement");case Zr:return U(),Gt.test(pr.slice(Lr,yr))&&t(Lr,"Illegal newline after throw"),r.argument=K(),M(),j(r,"ThrowStatement");case et:if(U(),r.block=H(),r.handler=null,wr===Xr){var l=q();U(),z(ht),l.param=lr(),Vr&&Nt(l.param.name)&&t(l.param.start,"Binding "+l.param.name+" in strict mode"),z(vt),l.guard=null,l.body=H(),r.handler=j(l,"CatchClause")}return r.guardedHandlers=qr,r.finalizer=D($r)?H():null,r.handler||r.finalizer||t(r.start,"Missing catch or finally clause"),j(r,"TryStatement");case rt:return U(),r=G(r),M(),r;case tt:return U(),r.test=P(),Tr.push(Zt),r.body=J(),Tr.pop(),j(r,"WhileStatement");case nt:return Vr&&t(yr,"'with' in strict mode"),U(),r.object=P(),r.body=J(),j(r,"WithStatement");case dt:return H();case yt:return U(),j(r,"EmptyStatement");default:var f=Cr,p=K();if(e===Dr&&"Identifier"===p.type&&D(gt)){for(var a=0;a<Tr.length;++a)Tr[a].name===f&&t(p.start,"Label '"+f+"' is already declared");var d=wr.isLoop?"loop":wr===Yr?"switch":null;return Tr.push({name:f,kind:d}),r.body=J(),Tr.pop(),r.label=p,j(r,"LabeledStatement")}return r.expression=p,M(),j(r,"ExpressionStatement")}}function P(){z(ht);var e=K();return z(vt),e}function H(e){var r,t=q(),n=!0,a=!1;for(t.body=[],z(dt);!D(mt);){var o=J();t.body.push(o),n&&e&&F(o)&&(r=a,R(a=!0)),n=!1}return a&&!r&&R(!1),j(t,"BlockStatement")}function $(e,r){return e.init=r,z(yt),e.test=wr===yt?null:K(),z(yt),e.update=wr===vt?null:K(),z(vt),e.body=J(),Tr.pop(),j(e,"ForStatement")}function _(e,r){return e.left=r,e.right=K(),z(vt),e.body=J(),Tr.pop(),j(e,"ForInStatement")}function G(e,r){for(e.declarations=[],e.kind="var";;){var n=q();if(n.id=lr(),Vr&&Nt(n.id.name)&&t(n.id.start,"Binding "+n.id.name+" in strict mode"),n.init=D(Ct)?K(!0,r):null,e.declarations.push(j(n,"VariableDeclarator")),!D(bt))break}return j(e,"VariableDeclaration")}function K(e,r){var t=Q(r);if(!e&&wr===bt){var n=O(t);for(n.expressions=[t];D(bt);)n.expressions.push(Q(r));return j(n,"SequenceExpression")}return t}function Q(e){var r=Y(e);if(wr.isAssign){var t=O(r);return t.operator=Cr,t.left=r,U(),t.right=Q(e),N(r),j(t,"AssignmentExpression")}return r}function Y(e){var r=Z(e);if(D(kt)){var t=O(r);return t.test=r,t.consequent=K(!0),z(gt),t.alternate=K(!0,e),j(t,"ConditionalExpression")}return r}function Z(e){return er(rr(),-1,e)}function er(e,r,t){var n=wr.binop;if(null!=n&&(!t||wr!==ut)&&n>r){var a=O(e);a.left=e,a.operator=Cr,U(),a.right=er(rr(),n,t);var a=j(a,/&&|\|\|/.test(a.operator)?"LogicalExpression":"BinaryExpression");return er(a,r,t)}return e}function rr(){if(wr.prefix){var e=q(),r=wr.isUpdate;return e.operator=Cr,e.prefix=!0,U(),e.argument=rr(),r?N(e.argument):Vr&&"delete"===e.operator&&"Identifier"===e.argument.type&&t(e.start,"Deleting local variable in strict mode"),j(e,r?"UpdateExpression":"UnaryExpression")}for(var n=tr();wr.postfix&&!B();){var e=O(n);e.operator=Cr,e.prefix=!1,e.argument=n,N(n),U(),n=j(e,"UpdateExpression")}return n}function tr(){return nr(ar())}function nr(e,r){if(D(xt)){var t=O(e);return t.object=e,t.property=lr(!0),t.computed=!1,nr(j(t,"MemberExpression"),r)}if(D(ft)){var t=O(e);return t.object=e,t.property=K(),t.computed=!0,z(pt),nr(j(t,"MemberExpression"),r)}if(!r&&D(ht)){var t=O(e);return t.callee=e,t.arguments=ur(vt,!1),nr(j(t,"CallExpression"),r)}return e}function ar(){switch(wr){case ot:var e=q();return U(),j(e,"ThisExpression");case Dr:return lr();case Or:case Fr:case jr:var e=q();return e.value=Cr,e.raw=pr.slice(yr,gr),U(),j(e,"Literal");case it:case st:case ct:var e=q();return e.value=wr.atomValue,e.raw=wr.keyword,U(),j(e,"Literal");case ht:var r=xr,t=yr;U();var n=K();return n.start=t,n.end=gr,fr.locations&&(n.loc.start=r,n.loc.end=kr),fr.ranges&&(n.range=[t,gr]),z(vt),n;case ft:var e=q();return U(),e.elements=ur(pt,!0,!0),j(e,"ArrayExpression");case dt:return ir();case Gr:var e=q();return U(),cr(e,!1);case at:return or();default:X()}}function or(){var e=q();return U(),e.callee=nr(ar(),!0),e.arguments=D(ht)?ur(vt,!1):qr,j(e,"NewExpression")}function ir(){var e=q(),r=!0,n=!1;for(e.properties=[],U();!D(mt);){if(r)r=!1;else if(z(bt),fr.allowTrailingCommas&&D(mt))break;var a,o={key:sr()},i=!1;if(D(gt)?(o.value=K(!0),a=o.kind="init"):fr.ecmaVersion>=5&&"Identifier"===o.key.type&&("get"===o.key.name||"set"===o.key.name)?(i=n=!0,a=o.kind=o.key.name,o.key=sr(),wr!==ht&&X(),o.value=cr(q(),!1)):X(),"Identifier"===o.key.type&&(Vr||n))for(var s=0;s<e.properties.length;++s){var c=e.properties[s];if(c.key.name===o.key.name){var u=a==c.kind||i&&"init"===c.kind||"init"===a&&("get"===c.kind||"set"===c.kind);u&&!Vr&&"init"===a&&"init"===c.kind&&(u=!1),u&&t(o.key.start,"Redefinition of property")}}e.properties.push(o)}return j(e,"ObjectExpression")}function sr(){return wr===Or||wr===Fr?ar():lr(!0)}function cr(e,r){wr===Dr?e.id=lr():r?X():e.id=null,e.params=[];var n=!0;for(z(ht);!D(vt);)n?n=!1:z(bt),e.params.push(lr());var a=Rr,o=Tr;if(Rr=!0,Tr=[],e.body=H(!0),Rr=a,Tr=o,Vr||e.body.body.length&&F(e.body.body[0]))for(var i=e.id?-1:0;i<e.params.length;++i){var s=0>i?e.id:e.params[i];if((Xt(s.name)||Nt(s.name))&&t(s.start,"Defining '"+s.name+"' in strict mode"),i>=0)for(var c=0;i>c;++c)s.name===e.params[c].name&&t(s.start,"Argument name clash in strict mode")}return j(e,r?"FunctionDeclaration":"FunctionExpression")}function ur(e,r,t){for(var n=[],a=!0;!D(e);){if(a)a=!1;else if(z(bt),r&&fr.allowTrailingCommas&&D(e))break;t&&wr===bt?n.push(null):n.push(K(!0))}return n}function lr(e){var r=q();return r.name=wr===Dr?Cr:e&&!fr.forbidReserved&&wr.keyword||X(),U(),j(r,"Identifier")}e.version="0.3.2";var fr,pr,dr,mr;e.parse=function(e,t){return pr=String(e),dr=pr.length,r(t),o(),W(fr.program)};var hr=e.defaultOptions={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null},vr=e.getLineInfo=function(e,r){for(var t=1,n=0;;){Kt.lastIndex=n;var a=Kt.exec(e);if(!(a&&a.index<r))break;++t,n=a.index+a[0].length}return{line:t,column:r-n}};e.tokenize=function(e,t){function n(e){return g(e),a.start=yr,a.end=gr,a.startLoc=xr,a.endLoc=kr,a.type=wr,a.value=Cr,a}pr=String(e),dr=pr.length,r(t),o();var a={};return n.jumpTo=function(e,r){if(br=e,fr.locations){Ar=1,Sr=Kt.lastIndex=0;for(var t;(t=Kt.exec(pr))&&t.index<e;)++Ar,Sr=t.index+t[0].length}Er=r,u()},n};var br,yr,gr,xr,kr,wr,Cr,Er,Ar,Sr,Ir,Lr,Ur,Rr,Tr,Vr,qr=[],Or={type:"num"},jr={type:"regexp"},Fr={type:"string"},Dr={type:"name"},Br={type:"eof"},Mr={keyword:"break"},zr={keyword:"case",beforeExpr:!0},Xr={keyword:"catch"},Nr={keyword:"continue"},Wr={keyword:"debugger"},Jr={keyword:"default"},Pr={keyword:"do",isLoop:!0},Hr={keyword:"else",beforeExpr:!0},$r={keyword:"finally"},_r={keyword:"for",isLoop:!0},Gr={keyword:"function"},Kr={keyword:"if"},Qr={keyword:"return",beforeExpr:!0},Yr={keyword:"switch"},Zr={keyword:"throw",beforeExpr:!0},et={keyword:"try"},rt={keyword:"var"},tt={keyword:"while",isLoop:!0},nt={keyword:"with"},at={keyword:"new",beforeExpr:!0},ot={keyword:"this"},it={keyword:"null",atomValue:null},st={keyword:"true",atomValue:!0},ct={keyword:"false",atomValue:!1},ut={keyword:"in",binop:7,beforeExpr:!0},lt={"break":Mr,"case":zr,"catch":Xr,"continue":Nr,"debugger":Wr,"default":Jr,"do":Pr,"else":Hr,"finally":$r,"for":_r,"function":Gr,"if":Kr,"return":Qr,"switch":Yr,"throw":Zr,"try":et,"var":rt,"while":tt,"with":nt,"null":it,"true":st,"false":ct,"new":at,"in":ut,"instanceof":{keyword:"instanceof",binop:7,beforeExpr:!0},"this":ot,"typeof":{keyword:"typeof",prefix:!0,beforeExpr:!0},"void":{keyword:"void",prefix:!0,beforeExpr:!0},"delete":{keyword:"delete",prefix:!0,beforeExpr:!0}},ft={type:"[",beforeExpr:!0},pt={type:"]"},dt={type:"{",beforeExpr:!0},mt={type:"}"},ht={type:"(",beforeExpr:!0},vt={type:")"},bt={type:",",beforeExpr:!0},yt={type:";",beforeExpr:!0},gt={type:":",beforeExpr:!0},xt={type:"."},kt={type:"?",beforeExpr:!0},wt={binop:10,beforeExpr:!0},Ct={isAssign:!0,beforeExpr:!0},Et={isAssign:!0,beforeExpr:!0},At={binop:9,prefix:!0,beforeExpr:!0},St={postfix:!0,prefix:!0,isUpdate:!0},It={prefix:!0,beforeExpr:!0},Lt={binop:1,beforeExpr:!0},Ut={binop:2,beforeExpr:!0},Rt={binop:3,beforeExpr:!0},Tt={binop:4,beforeExpr:!0},Vt={binop:5,beforeExpr:!0},qt={binop:6,beforeExpr:!0},Ot={binop:7,beforeExpr:!0},jt={binop:8,beforeExpr:!0},Ft={binop:10,beforeExpr:!0};e.tokTypes={bracketL:ft,bracketR:pt,braceL:dt,braceR:mt,parenL:ht,parenR:vt,comma:bt,semi:yt,colon:gt,dot:xt,question:kt,slash:wt,eq:Ct,name:Dr,eof:Br,num:Or,regexp:jr,string:Fr};for(var Dt in lt)e.tokTypes["_"+Dt]=lt[Dt];var Bt,Mt=n("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),zt=n("class enum extends super const export import"),Xt=n("implements interface let package private protected public static yield"),Nt=n("eval arguments"),Wt=n("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),Jt=/[\u1680\u180e\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]/,Pt="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",Ht="̀-ͯ҃-֑҇-ׇֽֿׁׂׅׄؐ-ؚؠ-ىٲ-ۓۧ-ۨۻ-ۼܰ-݊ࠀ-ࠔࠛ-ࠣࠥ-ࠧࠩ-࠭ࡀ-ࡗࣤ-ࣾऀ-ःऺ-़ा-ॏ॑-ॗॢ-ॣ०-९ঁ-ঃ়া-ৄেৈৗয়-ৠਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢ-ૣ૦-૯ଁ-ଃ଼ା-ୄେୈୋ-୍ୖୗୟ-ୠ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఁ-ఃె-ైొ-్ౕౖౢ-ౣ౦-౯ಂಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢ-ೣ೦-೯ംഃെ-ൈൗൢ-ൣ൦-൯ංඃ්ා-ුූෘ-ෟෲෳิ-ฺเ-ๅ๐-๙ິ-ູ່-ໍ໐-໙༘༙༠-༩༹༵༷ཁ-ཇཱ-྄྆-྇ྍ-ྗྙ-ྼ࿆က-ဩ၀-၉ၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟ᜎ-ᜐᜠ-ᜰᝀ-ᝐᝲᝳក-ឲ៝០-៩᠋-᠍᠐-᠙ᤠ-ᤫᤰ-᤻ᥑ-ᥭᦰ-ᧀᧈ-ᧉ᧐-᧙ᨀ-ᨕᨠ-ᩓ᩠-᩿᩼-᪉᪐-᪙ᭆ-ᭋ᭐-᭙᭫-᭳᮰-᮹᯦-᯳ᰀ-ᰢ᱀-᱉ᱛ-ᱽ᳐-᳒ᴀ-ᶾḁ-ἕ‌‍‿⁀⁔⃐-⃥⃜⃡-⃰ⶁ-ⶖⷠ-ⷿ〡-〨゙゚Ꙁ-ꙭꙴ-꙽ꚟ꛰-꛱ꟸ-ꠀ꠆ꠋꠣ-ꠧꢀ-ꢁꢴ-꣄꣐-꣙ꣳ-ꣷ꤀-꤉ꤦ-꤭ꤰ-ꥅꦀ-ꦃ꦳-꧀ꨀ-ꨧꩀ-ꩁꩌ-ꩍ꩐-꩙ꩻꫠ-ꫩꫲ-ꫳꯀ-ꯡ꯬꯭꯰-꯹ﬠ-ﬨ︀-️︠-︦︳︴﹍-﹏０-９＿",$t=new RegExp("["+Pt+"]"),_t=new RegExp("["+Pt+Ht+"]"),Gt=/[\n\r\u2028\u2029]/,Kt=/\r\n|[\n\r\u2028\u2029]/g,Qt=e.isIdentifierStart=function(e){return 65>e?36===e:91>e?!0:97>e?95===e:123>e?!0:e>=170&&$t.test(String.fromCharCode(e))
},Yt=e.isIdentifierChar=function(e){return 48>e?36===e:58>e?!0:65>e?!1:91>e?!0:97>e?95===e:123>e?!0:e>=170&&_t.test(String.fromCharCode(e))},Zt={kind:"loop"},en={kind:"switch"}});function papercompile(code){var insertions=[];function getOffset(offset){for(var i=0,l=insertions.length;i<l;i++){var insertion=insertions[i];if(insertion[0]>=offset)break;offset+=insertion[1]}return offset}function getCode(node){return code.substring(getOffset(node.range[0]),getOffset(node.range[1]))}function replaceCode(node,str){var start=getOffset(node.range[0]),end=getOffset(node.range[1]);var insert=0;for(var i=insertions.length-1;i>=0;i--){if(start>insertions[i][0]){insert=i+1;break}}insertions.splice(insert,0,[start,str.length-end+start]);code=code.substring(0,start)+str+code.substring(end)}function walkAST(node,parent){if(!node)return;for(var key in node){if(key==="range")continue;var value=node[key];if(Array.isArray(value)){for(var i=0,l=value.length;i<l;i++)walkAST(value[i],node)}else if(value&&typeof value==="object"){walkAST(value,node)}}var left;var right;var arg;switch(node&&node.type){case"BinaryExpression":if(node.operator in binaryOperators){left=getCode(node.left);right=getCode(node.right);arg=binaryOperators[node.operator];replaceCode(node,left+'["'+node.operator+'"]('+right+")")}break;case"UnaryExpression":if(node.operator in unaryOperators){arg=getCode(node.argument);if(node.operator=="-")replaceCode(node,arg+'["-u"]()');else replaceCode(node,arg)}break}}walkAST(acorn.parse(code,{ranges:true}));return code}if(!Object.create||!Object.defineProperty||!Object.defineProperties)alert("Example will fail because your browser does not support ECMAScript 5. Try with another browser!");var __filename=""+window.location;window.Streamline={globals:{}};function srequire(str){if(str=="streamline/lib/util/flows")return Streamline.flows;else if(str=="streamline/lib/globals")return Streamline.globals;else if(str=="streamline/lib/version")return Streamline.version;else if(str=="streamline/lib/callbacks/runtime")return Streamline.runtime;else if(str=="streamline/lib/callbacks/transform")return Streamline;else if(str=="streamline/lib/callbacks/builtins")return Streamline.builtins;else if(str=="streamline/lib/util/future")return Streamline.future;else if(str=="streamline/lib/util/source-map")return Streamline.sourceMap.exports;else throw new Error("Cannot require "+str)}(function(){var narcissus={options:{version:185},hostGlobal:this};Narcissus=narcissus})();Narcissus.definitions=function(){var tokens=["END","\n",";",",","=","?",":","CONDITIONAL","||","&&","|","^","&","==","!=","===","!==","<","<=",">=",">","<<",">>",">>>","+","-","*","/","%","!","~","UNARY_PLUS","UNARY_MINUS","++","--",".","[","]","{","}","(",")","SCRIPT","BLOCK","LABEL","FOR_IN","CALL","NEW_WITH_ARGS","INDEX","ARRAY_INIT","OBJECT_INIT","PROPERTY_INIT","GETTER","SETTER","GROUP","LIST","LET_BLOCK","ARRAY_COMP","GENERATOR","COMP_TAIL","IDENTIFIER","NUMBER","STRING","REGEXP","break","case","catch","const","continue","debugger","default","delete","do","else","false","finally","for","function","if","in","instanceof","let","new","null","return","switch","this","throw","true","try","typeof","var","void","yield","while","with"];var statementStartTokens=["break","const","continue","debugger","do","for","if","return","switch","throw","try","var","yield","while","with"];var opTypeNames={"\n":"NEWLINE",";":"SEMICOLON",",":"COMMA","?":"HOOK",":":"COLON","||":"OR","&&":"AND","|":"BITWISE_OR","^":"BITWISE_XOR","&":"BITWISE_AND","===":"STRICT_EQ","==":"EQ","=":"ASSIGN","!==":"STRICT_NE","!=":"NE","<<":"LSH","<=":"LE","<":"LT",">>>":"URSH",">>":"RSH",">=":"GE",">":"GT","++":"INCREMENT","--":"DECREMENT","+":"PLUS","-":"MINUS","*":"MUL","/":"DIV","%":"MOD","!":"NOT","~":"BITWISE_NOT",".":"DOT","[":"LEFT_BRACKET","]":"RIGHT_BRACKET","{":"LEFT_CURLY","}":"RIGHT_CURLY","(":"LEFT_PAREN",")":"RIGHT_PAREN"};var keywords={__proto__:null};var tokenIds={};var consts="var ";for(var i=0,j=tokens.length;i<j;i++){if(i>0)consts+=", ";var t=tokens[i];var name;if(/^[a-z]/.test(t)){name=t.toUpperCase();keywords[t]=i}else{name=/^\W/.test(t)?opTypeNames[t]:t}consts+=name+" = "+i;tokenIds[name]=i;tokens[t]=i}consts+=";";var isStatementStartCode={__proto__:null};for(i=0,j=statementStartTokens.length;i<j;i++)isStatementStartCode[keywords[statementStartTokens[i]]]=true;var assignOps=["|","^","&","<<",">>",">>>","+","-","*","/","%"];for(i=0,j=assignOps.length;i<j;i++){t=assignOps[i];assignOps[t]=tokens[t]}function defineGetter(obj,prop,fn,dontDelete,dontEnum){Object.defineProperty(obj,prop,{get:fn,configurable:!dontDelete,enumerable:!dontEnum})}function defineProperty(obj,prop,val,dontDelete,readOnly,dontEnum){Object.defineProperty(obj,prop,{value:val,writable:!readOnly,configurable:!dontDelete,enumerable:!dontEnum})}function isNativeCode(fn){return typeof fn==="function"&&fn.toString().match(/\[native code\]/)}function getPropertyDescriptor(obj,name){while(obj){if({}.hasOwnProperty.call(obj,name))return Object.getOwnPropertyDescriptor(obj,name);obj=Object.getPrototypeOf(obj)}}function getOwnProperties(obj){var map={};for(var name in Object.getOwnPropertyNames(obj))map[name]=Object.getOwnPropertyDescriptor(obj,name);return map}function makePassthruHandler(obj){return{getOwnPropertyDescriptor:function(name){var desc=Object.getOwnPropertyDescriptor(obj,name);desc.configurable=true;return desc},getPropertyDescriptor:function(name){var desc=getPropertyDescriptor(obj,name);desc.configurable=true;return desc},getOwnPropertyNames:function(){return Object.getOwnPropertyNames(obj)},defineProperty:function(name,desc){Object.defineProperty(obj,name,desc)},"delete":function(name){return delete obj[name]},fix:function(){if(Object.isFrozen(obj)){return getOwnProperties(obj)}return undefined},has:function(name){return name in obj},hasOwn:function(name){return{}.hasOwnProperty.call(obj,name)},get:function(receiver,name){return obj[name]},set:function(receiver,name,val){obj[name]=val;return true},enumerate:function(){var result=[];for(name in obj){result.push(name)}return result},keys:function(){return Object.keys(obj)}}}function noPropFound(){return undefined}var hasOwnProperty={}.hasOwnProperty;function StringMap(){this.table=Object.create(null,{});this.size=0}StringMap.prototype={has:function(x){return hasOwnProperty.call(this.table,x)},set:function(x,v){if(!hasOwnProperty.call(this.table,x))this.size++;this.table[x]=v},get:function(x){return this.table[x]},getDef:function(x,thunk){if(!hasOwnProperty.call(this.table,x)){this.size++;this.table[x]=thunk()}return this.table[x]},forEach:function(f){var table=this.table;for(var key in table)f.call(this,key,table[key])},toString:function(){return"[object StringMap]"}};function Stack(elts){this.elts=elts||null}Stack.prototype={push:function(x){return new Stack({top:x,rest:this.elts})},top:function(){if(!this.elts)throw new Error("empty stack");return this.elts.top},isEmpty:function(){return this.top===null},find:function(test){for(var elts=this.elts;elts;elts=elts.rest){if(test(elts.top))return elts.top}return null},has:function(x){return Boolean(this.find(function(elt){return elt===x}))},forEach:function(f){for(var elts=this.elts;elts;elts=elts.rest){f(elts.top)}}};return{tokens:tokens,opTypeNames:opTypeNames,keywords:keywords,isStatementStartCode:isStatementStartCode,tokenIds:tokenIds,consts:consts,assignOps:assignOps,defineGetter:defineGetter,defineProperty:defineProperty,isNativeCode:isNativeCode,makePassthruHandler:makePassthruHandler,noPropFound:noPropFound,StringMap:StringMap,Stack:Stack}}();Narcissus.lexer=function(){var definitions=Narcissus.definitions;eval(definitions.consts);var opTokens={};for(var op in definitions.opTypeNames){if(op==="\n"||op===".")continue;var node=opTokens;for(var i=0;i<op.length;i++){var ch=op[i];if(!(ch in node))node[ch]={};node=node[ch];node.op=op}}function Tokenizer(s,f,l){this.cursor=0;this.source=String(s);this.tokens=[];this.tokenIndex=0;this.lookahead=0;this.scanNewlines=false;this.unexpectedEOF=false;this.filename=f||"";this.lineno=l||1}Tokenizer.prototype={get done(){return this.peek(true)===END},get token(){return this.tokens[this.tokenIndex]},match:function(tt,scanOperand){return this.get(scanOperand)===tt||this.unget()},mustMatch:function(tt){if(!this.match(tt)){throw this.newSyntaxError("Missing "+definitions.tokens[tt].toLowerCase())}return this.token},forceIdentifier:function(){if(!this.match(IDENTIFIER)){if(this.get()>=definitions.keywords[0]||this.unget){this.token.type=IDENTIFIER}else{throw this.newSyntaxError("Missing identifier")}}return this.token},peek:function(scanOperand){var tt,next;if(this.lookahead){next=this.tokens[this.tokenIndex+this.lookahead&3];tt=this.scanNewlines&&next.lineno!==this.lineno?NEWLINE:next.type}else{tt=this.get(scanOperand);this.unget()}return tt},peekOnSameLine:function(scanOperand){this.scanNewlines=true;var tt=this.peek(scanOperand);this.scanNewlines=false;return tt},skip:function(){var input=this.source;for(;;){var ch=input[this.cursor++];var next=input[this.cursor];if(ch==="\n"&&!this.scanNewlines){this.lineno++}else if(ch==="/"&&next==="*"){this.cursor++;for(;;){ch=input[this.cursor++];if(ch===undefined)throw this.newSyntaxError("Unterminated comment");if(ch==="*"){next=input[this.cursor];if(next==="/"){this.cursor++;break}}else if(ch==="\n"){this.lineno++}}}else if(ch==="/"&&next==="/"){this.cursor++;for(;;){ch=input[this.cursor++];if(ch===undefined)return;if(ch==="\n"){this.lineno++;break}}}else if(ch!==" "&&ch!=="	"){this.cursor--;return}}},lexExponent:function(){var input=this.source;var next=input[this.cursor];if(next==="e"||next==="E"){this.cursor++;ch=input[this.cursor++];if(ch==="+"||ch==="-")ch=input[this.cursor++];if(ch<"0"||ch>"9")throw this.newSyntaxError("Missing exponent");do{ch=input[this.cursor++]}while(ch>="0"&&ch<="9");this.cursor--;return true}return false},lexZeroNumber:function(ch){var token=this.token,input=this.source;token.type=NUMBER;ch=input[this.cursor++];if(ch==="."){do{ch=input[this.cursor++]}while(ch>="0"&&ch<="9");this.cursor--;this.lexExponent();token.value=parseFloat(input.substring(token.start,this.cursor))}else if(ch==="x"||ch==="X"){do{ch=input[this.cursor++]}while(ch>="0"&&ch<="9"||ch>="a"&&ch<="f"||ch>="A"&&ch<="F");this.cursor--;token.value=parseInt(input.substring(token.start,this.cursor))}else if(ch>="0"&&ch<="7"){do{ch=input[this.cursor++]}while(ch>="0"&&ch<="7");this.cursor--;token.value=parseInt(input.substring(token.start,this.cursor),8);token.value.isOctal=true}else{this.cursor--;this.lexExponent();token.value=0}},lexNumber:function(ch){var token=this.token,input=this.source;token.type=NUMBER;var floating=false;do{ch=input[this.cursor++];if(ch==="."&&!floating){floating=true;ch=input[this.cursor++]}}while(ch>="0"&&ch<="9");this.cursor--;var exponent=this.lexExponent();floating=floating||exponent;var str=input.substring(token.start,this.cursor);token.value=floating?parseFloat(str):parseInt(str)},lexDot:function(ch){var token=this.token,input=this.source;var next=input[this.cursor];if(next>="0"&&next<="9"){do{ch=input[this.cursor++]}while(ch>="0"&&ch<="9");this.cursor--;this.lexExponent();token.type=NUMBER;token.value=parseFloat(input.substring(token.start,this.cursor))}else{token.type=DOT;token.assignOp=null;token.value="."}},lexString:function(ch){var token=this.token,input=this.source;token.type=STRING;var hasEscapes=false;var delim=ch;while((ch=input[this.cursor++])!==delim){if(this.cursor==input.length)throw this.newSyntaxError("Unterminated string literal");if(ch==="\\"){hasEscapes=true;if(input[this.cursor]==="\n")this.lineno++;if(++this.cursor==input.length)throw this.newSyntaxError("Unterminated string literal")}}token.value=hasEscapes?eval(input.substring(token.start,this.cursor)):input.substring(token.start+1,this.cursor-1)},lexRegExp:function(ch){var token=this.token,input=this.source;token.type=REGEXP;do{ch=input[this.cursor++];if(ch==="\\"){this.cursor++}else if(ch==="["){do{if(ch===undefined)throw this.newSyntaxError("Unterminated character class");if(ch==="\\")this.cursor++;ch=input[this.cursor++]}while(ch!=="]")}else if(ch===undefined){throw this.newSyntaxError("Unterminated regex")}}while(ch!=="/");do{ch=input[this.cursor++]}while(ch>="a"&&ch<="z");this.cursor--;token.value=eval(input.substring(token.start,this.cursor))},lexOp:function(ch){var token=this.token,input=this.source;var node=opTokens[ch];var next=input[this.cursor];if(next in node){node=node[next];this.cursor++;next=input[this.cursor];if(next in node){node=node[next];this.cursor++;next=input[this.cursor]}}var op=node.op;if(definitions.assignOps[op]&&input[this.cursor]==="="){this.cursor++;token.type=ASSIGN;token.assignOp=definitions.tokenIds[definitions.opTypeNames[op]];op+="="}else{token.type=definitions.tokenIds[definitions.opTypeNames[op]];token.assignOp=null}token.value=op},lexIdent:function(ch){var token=this.token,input=this.source;do{ch=input[this.cursor++]}while(ch>="a"&&ch<="z"||ch>="A"&&ch<="Z"||ch>="0"&&ch<="9"||ch==="$"||ch==="_");this.cursor--;var id=input.substring(token.start,this.cursor);token.type=definitions.keywords[id]||IDENTIFIER;token.value=id},get:function(scanOperand){var token;while(this.lookahead){--this.lookahead;this.tokenIndex=this.tokenIndex+1&3;token=this.tokens[this.tokenIndex];if(token.type!==NEWLINE||this.scanNewlines)return token.type}this.skip();this.tokenIndex=this.tokenIndex+1&3;token=this.tokens[this.tokenIndex];if(!token)this.tokens[this.tokenIndex]=token={};var input=this.source;if(this.cursor===input.length)return token.type=END;token.start=this.cursor;token.lineno=this.lineno;var ch=input[this.cursor++];if(ch>="a"&&ch<="z"||ch>="A"&&ch<="Z"||ch==="$"||ch==="_"){this.lexIdent(ch)}else if(scanOperand&&ch==="/"){this.lexRegExp(ch)}else if(ch in opTokens){this.lexOp(ch)}else if(ch==="."){this.lexDot(ch)}else if(ch>="1"&&ch<="9"){this.lexNumber(ch)}else if(ch==="0"){this.lexZeroNumber(ch)}else if(ch==='"'||ch==="'"){this.lexString(ch)}else if(this.scanNewlines&&ch==="\n"){token.type=NEWLINE;token.value="\n";this.lineno++}else{throw this.newSyntaxError("Illegal token")}token.end=this.cursor;return token.type},unget:function(){if(++this.lookahead===4)throw"PANIC: too much lookahead!";this.tokenIndex=this.tokenIndex-1&3},newSyntaxError:function(m){var e=new SyntaxError(this.filename+":"+this.lineno+":"+m);e.source=this.source;e.cursor=this.lookahead?this.tokens[this.tokenIndex+this.lookahead&3].start:this.cursor;return e}};return{Tokenizer:Tokenizer}}();Narcissus.parser=function(){var lexer=Narcissus.lexer;var definitions=Narcissus.definitions;const StringMap=definitions.StringMap;const Stack=definitions.Stack;eval(definitions.consts);function pushDestructuringVarDecls(n,s){for(var i in n){var sub=n[i];if(sub.type===IDENTIFIER){s.varDecls.push(sub)}else{pushDestructuringVarDecls(sub,s)}}}const NESTING_TOP=0,NESTING_SHALLOW=1,NESTING_DEEP=2;function StaticContext(parentScript,parentBlock,inFunction,inForLoopInit,nesting){this.parentScript=parentScript;this.parentBlock=parentBlock;this.inFunction=inFunction;this.inForLoopInit=inForLoopInit;this.nesting=nesting;this.allLabels=new Stack;this.currentLabels=new Stack;this.labeledTargets=new Stack;this.defaultTarget=null;Narcissus.options.ecma3OnlyMode&&(this.ecma3OnlyMode=true);Narcissus.options.parenFreeMode&&(this.parenFreeMode=true)}StaticContext.prototype={ecma3OnlyMode:false,parenFreeMode:false,update:function(ext){var desc={};for(var key in ext){desc[key]={value:ext[key],writable:true,enumerable:true,configurable:true}}return Object.create(this,desc)},pushLabel:function(label){return this.update({currentLabels:this.currentLabels.push(label),allLabels:this.allLabels.push(label)})},pushTarget:function(target){var isDefaultTarget=target.isLoop||target.type===SWITCH;if(isDefaultTarget)target.target=this.defaultTarget;if(this.currentLabels.isEmpty()){return isDefaultTarget?this.update({defaultTarget:target}):this}target.labels=new StringMap;this.currentLabels.forEach(function(label){target.labels.set(label,true)});return this.update({currentLabels:new Stack,labeledTargets:this.labeledTargets.push(target),defaultTarget:isDefaultTarget?target:this.defaultTarget})},nest:function(atLeast){var nesting=Math.max(this.nesting,atLeast);return nesting!==this.nesting?this.update({nesting:nesting}):this}};function Script(t,inFunction){var n=new Node(t,scriptInit());var x=new StaticContext(n,n,inFunction,false,NESTING_TOP);Statements(t,x,n);return n}definitions.defineProperty(Array.prototype,"top",function(){return this.length&&this[this.length-1]},false,false,true);function Node(t,init){var token=t.token;if(token){this.type=token.type;this.value=token.value;this.lineno=token.lineno;this.start=token.start;this.end=token.end}else{this.lineno=t.lineno}this.tokenizer=t;this.children=[];for(var prop in init)this[prop]=init[prop]}var Np=Node.prototype={};Np.constructor=Node;Np.toSource=Object.prototype.toSource;Np.push=function(kid){if(kid!==null){if(kid.start<this.start)this.start=kid.start;if(this.end<kid.end)this.end=kid.end}return this.children.push(kid)};Node.indentLevel=0;function tokenString(tt){var t=definitions.tokens[tt];return/^\W/.test(t)?definitions.opTypeNames[t]:t.toUpperCase()}Np.toString=function(){var a=[];for(var i in this){if(this.hasOwnProperty(i)&&i!=="type"&&i!=="target")a.push({id:i,value:this[i]})}a.sort(function(a,b){return a.id<b.id?-1:1});const INDENTATION="    ";var n=++Node.indentLevel;var s="{\n"+INDENTATION.repeat(n)+"type: "+tokenString(this.type);for(i=0;i<a.length;i++)s+=", "+a[i].id+": "+a[i].value;n=--Node.indentLevel;s+="\n"+INDENTATION.repeat(n)+"}";return s};Np.getSource=function(){return this.tokenizer.source.slice(this.start,this.end)};const LOOP_INIT={isLoop:true};function blockInit(){return{type:BLOCK,varDecls:[]}}function scriptInit(){return{type:SCRIPT,funDecls:[],varDecls:[],modDecls:[],impDecls:[],expDecls:[],loadDeps:[],hasEmptyReturn:false,hasReturnWithValue:false,isGenerator:false}}definitions.defineGetter(Np,"filename",function(){return this.tokenizer.filename});definitions.defineGetter(Np,"length",function(){throw new Error("Node.prototype.length is gone; "+"use n.children.length instead")});definitions.defineProperty(String.prototype,"repeat",function(n){var s="",t=this+s;while(--n>=0)s+=t;return s},false,false,true);function MaybeLeftParen(t,x){if(x.parenFreeMode)return t.match(LEFT_PAREN)?LEFT_PAREN:END;return t.mustMatch(LEFT_PAREN).type}function MaybeRightParen(t,p){if(p===LEFT_PAREN)t.mustMatch(RIGHT_PAREN)}function Statements(t,x,n){try{while(!t.done&&t.peek(true)!==RIGHT_CURLY)n.push(Statement(t,x))}catch(e){if(t.done)t.unexpectedEOF=true;throw e}}function Block(t,x){t.mustMatch(LEFT_CURLY);var n=new Node(t,blockInit());Statements(t,x.update({parentBlock:n}).pushTarget(n),n);t.mustMatch(RIGHT_CURLY);n.end=t.token.end;return n}const DECLARED_FORM=0,EXPRESSED_FORM=1,STATEMENT_FORM=2;function Statement(t,x){var i,label,n,n2,p,c,ss,tt=t.get(true),tt2,x2,x3;switch(tt){case FUNCTION:return FunctionDefinition(t,x,true,x.nesting!==NESTING_TOP?STATEMENT_FORM:DECLARED_FORM);case LEFT_CURLY:n=new Node(t,blockInit());Statements(t,x.update({parentBlock:n}).pushTarget(n).nest(NESTING_SHALLOW),n);t.mustMatch(RIGHT_CURLY);n.end=t.token.end;return n;case IF:n=new Node(t);n.condition=HeadExpression(t,x);x2=x.pushTarget(n).nest(NESTING_DEEP);n.thenPart=Statement(t,x2);n.elsePart=t.match(ELSE)?Statement(t,x2):null;return n;case SWITCH:n=new Node(t,{cases:[],defaultIndex:-1});n.discriminant=HeadExpression(t,x);x2=x.pushTarget(n).nest(NESTING_DEEP);t.mustMatch(LEFT_CURLY);while((tt=t.get())!==RIGHT_CURLY){switch(tt){case DEFAULT:if(n.defaultIndex>=0)throw t.newSyntaxError("More than one switch default");case CASE:n2=new Node(t);if(tt===DEFAULT)n.defaultIndex=n.cases.length;else n2.caseLabel=Expression(t,x2,COLON);break;default:throw t.newSyntaxError("Invalid switch case")}t.mustMatch(COLON);n2.statements=new Node(t,blockInit());while((tt=t.peek(true))!==CASE&&tt!==DEFAULT&&tt!==RIGHT_CURLY)n2.statements.push(Statement(t,x2));n.cases.push(n2)}n.end=t.token.end;return n;case FOR:n=new Node(t,LOOP_INIT);if(t.match(IDENTIFIER)){if(t.token.value==="each")n.isEach=true;else t.unget()}if(!x.parenFreeMode)t.mustMatch(LEFT_PAREN);x2=x.pushTarget(n).nest(NESTING_DEEP);x3=x.update({inForLoopInit:true});if((tt=t.peek())!==SEMICOLON){if(tt===VAR||tt===CONST){t.get();n2=Variables(t,x3)}else if(tt===LET){t.get();if(t.peek()===LEFT_PAREN){n2=LetBlock(t,x3,false)}else{x3.parentBlock=n;n.varDecls=[];n2=Variables(t,x3)}}else{n2=Expression(t,x3)}}if(n2&&t.match(IN)){n.type=FOR_IN;n.object=Expression(t,x3);if(n2.type===VAR||n2.type===LET){c=n2.children;if(c.length!==1&&n2.destructurings.length!==1){throw new SyntaxError("Invalid for..in left-hand side",t.filename,n2.lineno)}if(n2.destructurings.length>0){n.iterator=n2.destructurings[0]}else{n.iterator=c[0]}n.varDecl=n2}else{if(n2.type===ARRAY_INIT||n2.type===OBJECT_INIT){n2.destructuredNames=checkDestructuring(t,x3,n2)}n.iterator=n2}}else{n.setup=n2;t.mustMatch(SEMICOLON);if(n.isEach)throw t.newSyntaxError("Invalid for each..in loop");n.condition=t.peek()===SEMICOLON?null:Expression(t,x3);t.mustMatch(SEMICOLON);tt2=t.peek();n.update=(x.parenFreeMode?tt2===LEFT_CURLY||definitions.isStatementStartCode[tt2]:tt2===RIGHT_PAREN)?null:Expression(t,x3)}if(!x.parenFreeMode)t.mustMatch(RIGHT_PAREN);n.body=Statement(t,x2);n.end=t.token.end;return n;case WHILE:n=new Node(t,{isLoop:true});n.condition=HeadExpression(t,x);n.body=Statement(t,x.pushTarget(n).nest(NESTING_DEEP));n.end=t.token.end;return n;case DO:n=new Node(t,{isLoop:true});n.body=Statement(t,x.pushTarget(n).nest(NESTING_DEEP));t.mustMatch(WHILE);n.condition=HeadExpression(t,x);if(!x.ecmaStrictMode){t.match(SEMICOLON);n.end=t.token.end;return n}break;case BREAK:case CONTINUE:n=new Node(t);x2=x.pushTarget(n);if(t.peekOnSameLine()===IDENTIFIER){t.get();n.label=t.token.value}n.target=n.label?x2.labeledTargets.find(function(target){return target.labels.has(n.label)}):x2.defaultTarget;if(!n.target)throw t.newSyntaxError("Invalid "+(tt===BREAK?"break":"continue"));if(tt===CONTINUE){for(var ttt=n.target;ttt&&!ttt.isLoop;ttt=ttt.target);if(!ttt)throw t.newSyntaxError("Invalid continue")}break;case TRY:n=new Node(t,{catchClauses:[]});n.tryBlock=Block(t,x);while(t.match(CATCH)){n2=new Node(t);p=MaybeLeftParen(t,x);switch(t.get()){case LEFT_BRACKET:case LEFT_CURLY:t.unget();n2.varName=DestructuringExpression(t,x,true);break;case IDENTIFIER:n2.varName=t.token.value;break;default:throw t.newSyntaxError("missing identifier in catch");break}if(t.match(IF)){if(x.ecma3OnlyMode)throw t.newSyntaxError("Illegal catch guard");if(n.catchClauses.length&&!n.catchClauses.top().guard)throw t.newSyntaxError("Guarded catch after unguarded");n2.guard=Expression(t,x)}MaybeRightParen(t,p);n2.block=Block(t,x);n.catchClauses.push(n2)}if(t.match(FINALLY))n.finallyBlock=Block(t,x);if(!n.catchClauses.length&&!n.finallyBlock)throw t.newSyntaxError("Invalid try statement");n.end=t.token.end;return n;case CATCH:case FINALLY:throw t.newSyntaxError(definitions.tokens[tt]+" without preceding try");case THROW:n=new Node(t);n.exception=Expression(t,x);break;case RETURN:n=ReturnOrYield(t,x);break;case WITH:n=new Node(t);n.object=HeadExpression(t,x);n.body=Statement(t,x.pushTarget(n).nest(NESTING_DEEP));n.end=t.token.end;return n;case VAR:case CONST:n=Variables(t,x);n.eligibleForASI=true;break;case LET:if(t.peek()===LEFT_PAREN)n=LetBlock(t,x,true);else n=Variables(t,x);n.eligibleForASI=true;break;case DEBUGGER:n=new Node(t);break;case NEWLINE:case SEMICOLON:n=new Node(t,{type:SEMICOLON});n.expression=null;return n;default:if(tt===IDENTIFIER){tt=t.peek();if(tt===COLON){label=t.token.value;if(x.allLabels.has(label))throw t.newSyntaxError("Duplicate label");t.get();n=new Node(t,{type:LABEL,label:label});n.statement=Statement(t,x.pushLabel(label).nest(NESTING_SHALLOW));n.target=n.statement.type===LABEL?n.statement.target:n.statement;n.end=t.token.end;return n}}n=new Node(t,{type:SEMICOLON});t.unget();n.expression=Expression(t,x);n.end=n.expression.end;break}MagicalSemicolon(t);n.end=t.token.end;return n}function MagicalSemicolon(t){var tt;if(t.lineno===t.token.lineno){tt=t.peekOnSameLine();if(tt!==END&&tt!==NEWLINE&&tt!==SEMICOLON&&tt!==RIGHT_CURLY)throw t.newSyntaxError("missing ; before statement")}t.match(SEMICOLON)}function ReturnOrYield(t,x){var n,b,tt=t.token.type,tt2;var parentScript=x.parentScript;if(tt===RETURN){if(false&&!x.inFunction)throw t.newSyntaxError("Return not in function")}else{if(!x.inFunction)throw t.newSyntaxError("Yield not in function");parentScript.isGenerator=true}n=new Node(t,{value:undefined});tt2=t.peek(true);if(tt2!==END&&tt2!==NEWLINE&&tt2!==SEMICOLON&&tt2!==RIGHT_CURLY&&(tt!==YIELD||tt2!==tt&&tt2!==RIGHT_BRACKET&&tt2!==RIGHT_PAREN&&tt2!==COLON&&tt2!==COMMA)){if(tt===RETURN){n.value=Expression(t,x);parentScript.hasReturnWithValue=true}else{n.value=AssignExpression(t,x)}}else if(tt===RETURN){parentScript.hasEmptyReturn=true}if(parentScript.hasReturnWithValue&&parentScript.isGenerator)throw t.newSyntaxError("Generator returns a value");return n}function FunctionDefinition(t,x,requireName,functionForm){var tt;var f=new Node(t,{params:[]});if(f.type!==FUNCTION)f.type=f.value==="get"?GETTER:SETTER;if(t.match(IDENTIFIER))f.name=t.token.value;else if(requireName)throw t.newSyntaxError("missing function identifier");var x2=new StaticContext(null,null,true,false,NESTING_TOP);t.mustMatch(LEFT_PAREN);if(!t.match(RIGHT_PAREN)){do{switch(t.get()){case LEFT_BRACKET:case LEFT_CURLY:t.unget();f.params.push(DestructuringExpression(t,x2));break;case IDENTIFIER:f.params.push(t.token.value);break;default:throw t.newSyntaxError("missing formal parameter");break}}while(t.match(COMMA));t.mustMatch(RIGHT_PAREN)}tt=t.get();if(tt!==LEFT_CURLY)t.unget();if(tt!==LEFT_CURLY){f.body=AssignExpression(t,x2);if(f.body.isGenerator)throw t.newSyntaxError("Generator returns a value")}else{f.body=Script(t,true)}if(tt===LEFT_CURLY)t.mustMatch(RIGHT_CURLY);f.end=t.token.end;f.functionForm=functionForm;if(functionForm===DECLARED_FORM)x.parentScript.funDecls.push(f);return f}function Variables(t,x,letBlock){var n,n2,ss,i,s,tt;tt=t.token.type;switch(tt){case VAR:case CONST:s=x.parentScript;break;case LET:s=x.parentBlock;break;case LEFT_PAREN:tt=LET;s=letBlock;break}n=new Node(t,{type:tt,destructurings:[]});do{tt=t.get();if(tt===LEFT_BRACKET||tt===LEFT_CURLY){t.unget();var dexp=DestructuringExpression(t,x,true);n2=new Node(t,{type:IDENTIFIER,name:dexp,readOnly:n.type===CONST});n.push(n2);pushDestructuringVarDecls(n2.name.destructuredNames,s);n.destructurings.push({exp:dexp,decl:n2});if(x.inForLoopInit&&t.peek()===IN){continue}t.mustMatch(ASSIGN);if(t.token.assignOp)throw t.newSyntaxError("Invalid variable initialization");n2.initializer=AssignExpression(t,x);continue}if(tt!==IDENTIFIER)throw t.newSyntaxError("missing variable name");n2=new Node(t,{type:IDENTIFIER,name:t.token.value,readOnly:n.type===CONST});n.push(n2);s.varDecls.push(n2);if(t.match(ASSIGN)){if(t.token.assignOp)throw t.newSyntaxError("Invalid variable initialization");n2.initializer=AssignExpression(t,x)}}while(t.match(COMMA));n.end=t.token.end;return n}function LetBlock(t,x,isStatement){var n,n2;n=new Node(t,{type:LET_BLOCK,varDecls:[]});t.mustMatch(LEFT_PAREN);n.variables=Variables(t,x,n);t.mustMatch(RIGHT_PAREN);if(isStatement&&t.peek()!==LEFT_CURLY){n2=new Node(t,{type:SEMICOLON,expression:n});isStatement=false}if(isStatement)n.block=Block(t,x);else n.expression=AssignExpression(t,x);return n}function checkDestructuring(t,x,n,simpleNamesOnly){if(n.type===ARRAY_COMP)throw t.newSyntaxError("Invalid array comprehension left-hand side");if(n.type!==ARRAY_INIT&&n.type!==OBJECT_INIT)return;var lhss={};var nn,n2,idx,sub,cc,c=n.children;for(var i=0,j=c.length;i<j;i++){if(!(nn=c[i]))continue;if(nn.type===PROPERTY_INIT){cc=nn.children;sub=cc[1];idx=cc[0].value}else if(n.type===OBJECT_INIT){sub=nn;idx=nn.value}else{sub=nn;idx=i}if(sub.type===ARRAY_INIT||sub.type===OBJECT_INIT){lhss[idx]=checkDestructuring(t,x,sub,simpleNamesOnly)}else{if(simpleNamesOnly&&sub.type!==IDENTIFIER){throw t.newSyntaxError("missing name in pattern")}lhss[idx]=sub}}return lhss}function DestructuringExpression(t,x,simpleNamesOnly){var n=PrimaryExpression(t,x);n.destructuredNames=checkDestructuring(t,x,n,simpleNamesOnly);return n}function GeneratorExpression(t,x,e){return new Node(t,{type:GENERATOR,expression:e,tail:ComprehensionTail(t,x)})}function ComprehensionTail(t,x){var body,n,n2,n3,p;body=new Node(t,{type:COMP_TAIL});do{n=new Node(t,{type:FOR_IN,isLoop:true});if(t.match(IDENTIFIER)){if(t.token.value==="each")n.isEach=true;else t.unget()}p=MaybeLeftParen(t,x);switch(t.get()){case LEFT_BRACKET:case LEFT_CURLY:t.unget();n.iterator=DestructuringExpression(t,x);break;case IDENTIFIER:n.iterator=n3=new Node(t,{type:IDENTIFIER});n3.name=n3.value;n.varDecl=n2=new Node(t,{type:VAR});n2.push(n3);x.parentScript.varDecls.push(n3);break;default:throw t.newSyntaxError("missing identifier")}t.mustMatch(IN);n.object=Expression(t,x);MaybeRightParen(t,p);body.push(n)}while(t.match(FOR));if(t.match(IF))body.guard=HeadExpression(t,x);return body}function HeadExpression(t,x){var p=MaybeLeftParen(t,x);var n=ParenExpression(t,x);MaybeRightParen(t,p);if(p===END&&!n.parenthesized){var tt=t.peek();if(tt!==LEFT_CURLY&&!definitions.isStatementStartCode[tt])throw t.newSyntaxError("Unparenthesized head followed by unbraced body")}return n}function ParenExpression(t,x){var n=Expression(t,x.update({inForLoopInit:x.inForLoopInit&&t.token.type===LEFT_PAREN}));if(t.match(FOR)){if(n.type===YIELD&&!n.parenthesized)throw t.newSyntaxError("Yield expression must be parenthesized");if(n.type===COMMA&&!n.parenthesized)throw t.newSyntaxError("Generator expression must be parenthesized");n=GeneratorExpression(t,x,n)}return n}function Expression(t,x){var n,n2;n=AssignExpression(t,x);if(t.match(COMMA)){n2=new Node(t,{type:COMMA});n2.push(n);n=n2;do{n2=n.children[n.children.length-1];if(n2.type===YIELD&&!n2.parenthesized)throw t.newSyntaxError("Yield expression must be parenthesized");n.push(AssignExpression(t,x))}while(t.match(COMMA))}return n}function AssignExpression(t,x){var n,lhs;if(t.match(YIELD,true))return ReturnOrYield(t,x);n=new Node(t,{type:ASSIGN});lhs=ConditionalExpression(t,x);if(!t.match(ASSIGN)){return lhs}switch(lhs.type){case OBJECT_INIT:case ARRAY_INIT:lhs.destructuredNames=checkDestructuring(t,x,lhs);case IDENTIFIER:case DOT:case INDEX:case CALL:break;default:throw t.newSyntaxError("Bad left-hand side of assignment");break}n.assignOp=t.token.assignOp;n.push(lhs);n.push(AssignExpression(t,x));return n}function ConditionalExpression(t,x){var n,n2;n=OrExpression(t,x);if(t.match(HOOK)){n2=n;n=new Node(t,{type:HOOK});n.push(n2);n.push(AssignExpression(t,x.update({inForLoopInit:false})));if(!t.match(COLON))throw t.newSyntaxError("missing : after ?");n.push(AssignExpression(t,x))}return n}function OrExpression(t,x){var n,n2;n=AndExpression(t,x);while(t.match(OR)){n2=new Node(t);n2.push(n);n2.push(AndExpression(t,x));n=n2}return n}function AndExpression(t,x){var n,n2;n=BitwiseOrExpression(t,x);while(t.match(AND)){n2=new Node(t);n2.push(n);n2.push(BitwiseOrExpression(t,x));n=n2}return n}function BitwiseOrExpression(t,x){var n,n2;n=BitwiseXorExpression(t,x);while(t.match(BITWISE_OR)){n2=new Node(t);n2.push(n);n2.push(BitwiseXorExpression(t,x));n=n2}return n}function BitwiseXorExpression(t,x){var n,n2;n=BitwiseAndExpression(t,x);while(t.match(BITWISE_XOR)){n2=new Node(t);n2.push(n);n2.push(BitwiseAndExpression(t,x));n=n2}return n}function BitwiseAndExpression(t,x){var n,n2;n=EqualityExpression(t,x);while(t.match(BITWISE_AND)){n2=new Node(t);n2.push(n);n2.push(EqualityExpression(t,x));n=n2}return n}function EqualityExpression(t,x){var n,n2;n=RelationalExpression(t,x);while(t.match(EQ)||t.match(NE)||t.match(STRICT_EQ)||t.match(STRICT_NE)){n2=new Node(t);n2.push(n);n2.push(RelationalExpression(t,x));n=n2}return n}function RelationalExpression(t,x){var n,n2;
var x2=x.update({inForLoopInit:false});n=ShiftExpression(t,x2);while(t.match(LT)||t.match(LE)||t.match(GE)||t.match(GT)||!x.inForLoopInit&&t.match(IN)||t.match(INSTANCEOF)){n2=new Node(t);n2.push(n);n2.push(ShiftExpression(t,x2));n=n2}return n}function ShiftExpression(t,x){var n,n2;n=AddExpression(t,x);while(t.match(LSH)||t.match(RSH)||t.match(URSH)){n2=new Node(t);n2.push(n);n2.push(AddExpression(t,x));n=n2}return n}function AddExpression(t,x){var n,n2;n=MultiplyExpression(t,x);while(t.match(PLUS)||t.match(MINUS)){n2=new Node(t);n2.push(n);n2.push(MultiplyExpression(t,x));n=n2}return n}function MultiplyExpression(t,x){var n,n2;n=UnaryExpression(t,x);while(t.match(MUL)||t.match(DIV)||t.match(MOD)){n2=new Node(t);n2.push(n);n2.push(UnaryExpression(t,x));n=n2}return n}function UnaryExpression(t,x){var n,n2,tt;switch(tt=t.get(true)){case DELETE:case VOID:case TYPEOF:case NOT:case BITWISE_NOT:case PLUS:case MINUS:if(tt===PLUS)n=new Node(t,{type:UNARY_PLUS});else if(tt===MINUS)n=new Node(t,{type:UNARY_MINUS});else n=new Node(t);n.push(UnaryExpression(t,x));break;case INCREMENT:case DECREMENT:n=new Node(t);n.push(MemberExpression(t,x,true));break;default:t.unget();n=MemberExpression(t,x,true);if(t.tokens[t.tokenIndex+t.lookahead-1&3].lineno===t.lineno){if(t.match(INCREMENT)||t.match(DECREMENT)){n2=new Node(t,{postfix:true});n2.push(n);n=n2}}break}return n}function MemberExpression(t,x,allowCallSyntax){var n,n2,name,tt;if(t.match(NEW)){n=new Node(t);n.push(MemberExpression(t,x,false));if(t.match(LEFT_PAREN)){n.type=NEW_WITH_ARGS;n.push(ArgumentList(t,x))}}else{n=PrimaryExpression(t,x)}while((tt=t.get())!==END){switch(tt){case DOT:n2=new Node(t);n2.push(n);t.forceIdentifier();n2.push(new Node(t));break;case LEFT_BRACKET:n2=new Node(t,{type:INDEX});n2.push(n);n2.push(Expression(t,x));t.mustMatch(RIGHT_BRACKET);n2.end=t.token.end;break;case LEFT_PAREN:if(allowCallSyntax){n2=new Node(t,{type:CALL});n2.push(n);n2.push(ArgumentList(t,x));break}default:t.unget();return n}n=n2}return n}function ArgumentList(t,x){var n,n2;n=new Node(t,{type:LIST});if(t.match(RIGHT_PAREN,true)){n.end=t.token.end;return n}do{n2=AssignExpression(t,x);if(n2.type===YIELD&&!n2.parenthesized&&t.peek()===COMMA)throw t.newSyntaxError("Yield expression must be parenthesized");if(t.match(FOR)){n2=GeneratorExpression(t,x,n2);if(n.children.length>1||t.peek(true)===COMMA)throw t.newSyntaxError("Generator expression must be parenthesized")}n.push(n2)}while(t.match(COMMA));t.mustMatch(RIGHT_PAREN);n.end=t.token.end;return n}function PrimaryExpression(t,x){var n,n2,tt=t.get(true);switch(tt){case FUNCTION:n=FunctionDefinition(t,x,false,EXPRESSED_FORM);break;case LEFT_BRACKET:n=new Node(t,{type:ARRAY_INIT});while((tt=t.peek(true))!==RIGHT_BRACKET){if(tt===COMMA){t.get();n.push(null);continue}n.push(AssignExpression(t,x));if(tt!==COMMA&&!t.match(COMMA))break}if(n.children.length===1&&t.match(FOR)){n2=new Node(t,{type:ARRAY_COMP,expression:n.children[0],tail:ComprehensionTail(t,x)});n=n2}t.mustMatch(RIGHT_BRACKET);n.end=t.token.end;break;case LEFT_CURLY:var id,fd;n=new Node(t,{type:OBJECT_INIT});object_init:if(!t.match(RIGHT_CURLY)){do{tt=t.get();if((t.token.value==="get"||t.token.value==="set")&&t.peek()===IDENTIFIER){if(x.ecma3OnlyMode)throw t.newSyntaxError("Illegal property accessor");n.push(FunctionDefinition(t,x,true,EXPRESSED_FORM))}else{switch(tt){case IDENTIFIER:case NUMBER:case STRING:id=new Node(t,{type:IDENTIFIER});break;case RIGHT_CURLY:if(x.ecma3OnlyMode)throw t.newSyntaxError("Illegal trailing ,");break object_init;default:if(t.token.value in definitions.keywords){id=new Node(t,{type:IDENTIFIER});break}throw t.newSyntaxError("Invalid property name")}if(t.match(COLON)){n2=new Node(t,{type:PROPERTY_INIT});n2.push(id);n2.push(AssignExpression(t,x));n.push(n2)}else{if(t.peek()!==COMMA&&t.peek()!==RIGHT_CURLY)throw t.newSyntaxError("missing : after property");n.push(id)}}}while(t.match(COMMA));t.mustMatch(RIGHT_CURLY)}n.end=t.token.end;break;case LEFT_PAREN:var start=t.token.start;n=ParenExpression(t,x);t.mustMatch(RIGHT_PAREN);n.start=start;n.end=t.token.end;n.parenthesized=true;break;case LET:n=LetBlock(t,x,false);break;case NULL:case THIS:case TRUE:case FALSE:case IDENTIFIER:case NUMBER:case STRING:case REGEXP:n=new Node(t);break;default:throw t.newSyntaxError("missing operand");break}return n}function parse(s,f,l){var t=new lexer.Tokenizer(s,f,l);var n=Script(t,false);if(!t.done)throw t.newSyntaxError("Syntax error");return n}function parseStdin(s,ln){for(;;){try{var t=new lexer.Tokenizer(s,"stdin",ln.value);var n=Script(t,false);ln.value=t.lineno;return n}catch(e){if(!t.unexpectedEOF)throw e;var more=readline();if(!more)throw e;s+="\n"+more}}}return{parse:parse,parseStdin:parseStdin,Node:Node,DECLARED_FORM:DECLARED_FORM,EXPRESSED_FORM:EXPRESSED_FORM,STATEMENT_FORM:STATEMENT_FORM,Tokenizer:lexer.Tokenizer,FunctionDefinition:FunctionDefinition}}();Narcissus.decompiler=function(){const parser=Narcissus.parser;const definitions=Narcissus.definitions;const tokens=definitions.tokens;eval(definitions.consts);function indent(n,s){var ss="",d=true;for(var i=0,j=s.length;i<j;i++){if(d)for(var k=0;k<n;k++)ss+=" ";ss+=s[i];d=s[i]==="\n"}return ss}function isBlock(n){return n&&n.type===BLOCK}function isNonEmptyBlock(n){return isBlock(n)&&n.children.length>0}function nodeStr(n){return'"'+n.value.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"'}function pp(n,d,inLetHead){var topScript=false;if(!n)return"";if(!(n instanceof Object))return n;if(!d){topScript=true;d=1}var p="";if(n.parenthesized)p+="(";switch(n.type){case FUNCTION:case GETTER:case SETTER:if(n.type===FUNCTION)p+="function";else if(n.type===GETTER)p+="get";else p+="set";p+=(n.name?" "+n.name:"")+"(";for(var i=0,j=n.params.length;i<j;i++)p+=(i>0?", ":"")+pp(n.params[i],d);p+=") "+pp(n.body,d);break;case SCRIPT:case BLOCK:var nc=n.children;if(topScript){for(var i=0,j=nc.length;i<j;i++){if(i>0)p+="\n";p+=pp(nc[i],d);var eoc=p[p.length-1];if(eoc!=";")p+=";"}break}p+="{";if(n.id!==undefined)p+=" /* "+n.id+" */";p+="\n";for(var i=0,j=nc.length;i<j;i++){if(i>0)p+="\n";p+=indent(4,pp(nc[i],d));var eoc=p[p.length-1];if(eoc!=";")p+=";"}p+="\n}";break;case LET_BLOCK:p+="let ("+pp(n.variables,d,true)+") ";if(n.expression)p+=pp(n.expression,d);else p+=pp(n.block,d);break;case IF:p+="if ("+pp(n.condition,d)+") ";var tp=n.thenPart,ep=n.elsePart;var b=isBlock(tp)||isBlock(ep);if(!b)p+="{\n";p+=(b?pp(tp,d):indent(4,pp(tp,d)))+"\n";if(ep){if(!b)p+="} else {\n";else p+=" else ";p+=(b?pp(ep,d):indent(4,pp(ep,d)))+"\n"}if(!b)p+="}";break;case SWITCH:p+="switch ("+pp(n.discriminant,d)+") {\n";for(var i=0,j=n.cases.length;i<j;i++){var ca=n.cases[i];if(ca.type===CASE)p+="  case "+pp(ca.caseLabel,d)+":\n";else p+="  default:\n";ps=pp(ca.statements,d);p+=ps.slice(2,ps.length-2)+"\n"}p+="}";break;case FOR:p+="for ("+pp(n.setup,d)+"; "+pp(n.condition,d)+"; "+pp(n.update,d)+") ";var pb=pp(n.body,d);if(!isBlock(n.body))p+="{\n"+indent(4,pb)+";\n}";else if(n.body)p+=pb;break;case WHILE:p+="while ("+pp(n.condition,d)+") ";var pb=pp(n.body,d);if(!isBlock(n.body))p+="{\n"+indent(4,pb)+";\n}";else p+=pb;break;case FOR_IN:var u=n.varDecl;p+=n.isEach?"for each (":"for (";p+=(u?pp(u,d):pp(n.iterator,d))+" in "+pp(n.object,d)+") ";var pb=pp(n.body,d);if(!isBlock(n.body))p+="{\n"+indent(4,pb)+";\n}";else if(n.body)p+=pb;break;case DO:p+="do "+pp(n.body,d);p+=" while ("+pp(n.condition,d)+");";break;case BREAK:p+="break"+(n.label?" "+n.label:"")+";";break;case CONTINUE:p+="continue"+(n.label?" "+n.label:"")+";";break;case TRY:p+="try ";p+=pp(n.tryBlock,d);for(var i=0,j=n.catchClauses.length;i<j;i++){var t=n.catchClauses[i];p+=" catch ("+pp(t.varName,d)+(t.guard?" if "+pp(t.guard,d):"")+") ";p+=pp(t.block,d)}if(n.finallyBlock){p+=" finally ";p+=pp(n.finallyBlock,d)}break;case THROW:p+="throw "+pp(n.exception,d);break;case RETURN:p+="return";if(n.value)p+=" "+pp(n.value,d);break;case YIELD:p+="yield";if(n.value.type)p+=" "+pp(n.value,d);break;case GENERATOR:p+=pp(n.expression,d)+" "+pp(n.tail,d);break;case WITH:p+="with ("+pp(n.object,d)+") ";p+=pp(n.body,d);break;case LET:case VAR:case CONST:var nc=n.children;if(!inLetHead){p+=tokens[n.type]+" "}for(var i=0,j=nc.length;i<j;i++){if(i>0)p+=", ";var u=nc[i];p+=pp(u.name,d);if(u.initializer)p+=" = "+pp(u.initializer,d)}break;case DEBUGGER:p+="debugger\n";break;case SEMICOLON:if(n.expression){p+=pp(n.expression,d)+";"}break;case LABEL:p+=n.label+":\n"+pp(n.statement,d);break;case COMMA:case LIST:var nc=n.children;for(var i=0,j=nc.length;i<j;i++){if(i>0)p+=", ";p+=pp(nc[i],d)}break;case ASSIGN:var nc=n.children;var t=n.assignOp;p+=pp(nc[0],d)+" "+(t?tokens[t]:"")+"="+" "+pp(nc[1],d);break;case HOOK:var nc=n.children;p+="("+pp(nc[0],d)+" ? "+pp(nc[1],d)+" : "+pp(nc[2],d);p+=")";break;case OR:case AND:var nc=n.children;p+="("+pp(nc[0],d)+" "+tokens[n.type]+" "+pp(nc[1],d);p+=")";break;case BITWISE_OR:case BITWISE_XOR:case BITWISE_AND:case EQ:case NE:case STRICT_EQ:case STRICT_NE:case LT:case LE:case GE:case GT:case IN:case INSTANCEOF:case LSH:case RSH:case URSH:case PLUS:case MINUS:case MUL:case DIV:case MOD:var nc=n.children;p+="("+pp(nc[0],d)+" "+tokens[n.type]+" "+pp(nc[1],d)+")";break;case DELETE:case VOID:case TYPEOF:p+=tokens[n.type]+" "+pp(n.children[0],d);break;case NOT:case BITWISE_NOT:p+=tokens[n.type]+pp(n.children[0],d);break;case UNARY_PLUS:p+="+"+pp(n.children[0],d);break;case UNARY_MINUS:p+="-"+pp(n.children[0],d);break;case INCREMENT:case DECREMENT:if(n.postfix){p+=pp(n.children[0],d)+tokens[n.type]}else{p+=tokens[n.type]+pp(n.children[0],d)}break;case DOT:var nc=n.children;p+=pp(nc[0],d)+"."+pp(nc[1],d);break;case INDEX:var nc=n.children;p+=pp(nc[0],d)+"["+pp(nc[1],d)+"]";break;case CALL:var nc=n.children;p+=pp(nc[0],d)+"("+pp(nc[1],d)+")";break;case NEW:case NEW_WITH_ARGS:var nc=n.children;p+="new "+pp(nc[0],d);if(nc[1])p+="("+pp(nc[1],d)+")";break;case ARRAY_INIT:p+="[";var nc=n.children;for(var i=0,j=nc.length;i<j;i++){if(nc[i])p+=pp(nc[i],d);p+=","}p+="]";break;case ARRAY_COMP:p+="["+pp(n.expression,d)+" ";p+=pp(n.tail,d);p+="]";break;case COMP_TAIL:var nc=n.children;for(var i=0,j=nc.length;i<j;i++){if(i>0)p+=" ";p+=pp(nc[i],d)}if(n.guard)p+=" if ("+pp(n.guard,d)+")";break;case OBJECT_INIT:var nc=n.children;if(nc[0]&&nc[0].type===PROPERTY_INIT)p+="{\n";else p+="{";for(var i=0,j=nc.length;i<j;i++){if(i>0){p+=",\n"}var t=nc[i];if(t.type===PROPERTY_INIT){var tc=t.children;var l;if(typeof tc[0].value==="string"&&!/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(tc[0].value)){l=nodeStr(tc[0])}else{l=pp(tc[0],d)}p+=indent(4,l)+": "+indent(4,pp(tc[1],d)).substring(4)}else{p+=indent(4,pp(t,d))}}p+="\n}";break;case NULL:p+="null";break;case THIS:p+="this";break;case TRUE:p+="true";break;case FALSE:p+="false";break;case IDENTIFIER:case NUMBER:case REGEXP:if(n.value.isOctal)p+="0"+n.value.toString(8);else p+=n.value;break;case STRING:p+=nodeStr(n);break;case GROUP:p+="("+pp(n.children[0],d)+")";break;default:throw"PANIC: unknown operation "+tokens[n.type]+" "+n.toSource()}if(n.parenthesized)p+=")";return p}return{pp:pp}}();"use strict";(function(exports){exports.version="0.10.8"})(typeof exports!=="undefined"?exports:Streamline.version=Streamline.version||{});"use strict";(function(){var sourceMap;if(typeof exports!=="undefined"){var req=srequire;try{sourceMap=req("source-map")}catch(ex){}}if(!sourceMap){sourceMap={SourceNode:function(lineno,column,source,content){this.children=content?[content]:[]}};sourceMap.SourceNode.prototype.add=function(elt){if(Array.isArray(elt))this.children=this.children.concat(elt);else this.children.push(elt);return this};sourceMap.SourceNode.prototype.prepend=function(elt){if(Array.isArray(elt))this.children=elt.concat(this.children.concat);else this.children.unshift(elt);return this};sourceMap.SourceNode.prototype.toString=function(){var str="";this.walk(function(chunk){str+=chunk});return str};sourceMap.SourceNode.prototype.walk=function(f){this.children.forEach(function(n){if(n instanceof sourceMap.SourceNode)n.walk(f);else f(n)});return this}}(function(module){function SourceNode(){sourceMap.SourceNode.apply(this,arguments)}SourceNode.prototype=Object.create(sourceMap.SourceNode.prototype,{constructor:{value:SourceNode,enumerable:false,writable:true,configurable:true},length:{get:function(){var len=0;this.walk(function(str){len+=str.length});return len}}});SourceNode.prototype.stripPrefix=function(offset){var _len;while(this.children.length>0&&offset>0&&(_len=this.children[0].length)<=offset){this.children.shift();offset-=_len}if(this.children.length==0||offset==0)return this;if(typeof this.children[0]=="string"){this.children[0]=this.children[0].substring(offset)}else{this.children[0].stripPrefix(offset)}return this};SourceNode.prototype.stripSuffix=function(offset){var _len,chlen;while((chlen=this.children.length)>0&&offset>0&&(_len=this.children[chlen-1].length)<=offset){this.children.pop();offset-=_len}if(chlen==0||offset==0)return this;if(typeof this.children[chlen-1]=="string"){this.children[chlen-1]=this.children[0].slice(0,-offset)}else{this.children[chlen-1].stripSuffix(offset)}return this};SourceNode.prototype.map=function(f){this.children=this.children.map(function(chunk){if(chunk instanceof sourceMap.SourceNode){return chunk.map(f)}else{return f(chunk)}});return this};SourceNode.prototype.lastChar=function(){for(var i=this.children.length;i--;){var ret;if(typeof this.children[i]=="string"){ret=this.children[i].slice(-1)}else{ret=this.children[i].lastChar()}if(ret)return ret}return""};module.exports=Object.create(sourceMap,{SourceNode:{value:SourceNode}})})(typeof exports!=="undefined"?module:Streamline.sourceMap=Streamline.sourceMap||{})})();if(typeof exports!=="undefined"){var Narcissus=srequire("streamline/deps/narcissus")}var sourceMap=srequire("streamline/lib/util/source-map");(function(exports){eval(Narcissus.definitions.consts);var tokens=Narcissus.definitions.tokens;exports.format=function(node,linesOpt){var result="";var ppOut=_pp(node);if(linesOpt=="sourcemap"){return ppOut.source}ppOut.source=ppOut.source.toString();if(linesOpt=="ignore")return ppOut.source;var lineMap=ppOut.lineMap;var lines=ppOut.source.split("\n");if(linesOpt=="preserve"){var outputLineNo=1,bol=true;for(var i=0;i<lines.length;i++){var sourceNodes=(lineMap[i]||[]).filter(function(n){return n._isSourceNode});if(sourceNodes.length>0){var sourceLineNo=sourceNodes[0].lineno;while(outputLineNo<sourceLineNo){result+="\n";outputLineNo+=1;bol=true}}result+=bol?lines[i]:lines[i].replace(/^\s+/," ");bol=false}result+="\n"}else if(linesOpt=="mark"){for(var i=0;i<lines.length;i++){var line=lines[i];var sourceNodes=(lineMap[i]||[]).filter(function(n){return n._isSourceNode});var linePrefix="            ";if(sourceNodes.length>0){var sourceLineNo=""+sourceNodes[0].lineno;linePrefix="/* ";for(var j=sourceLineNo.length;j<5;j++)linePrefix+=" ";linePrefix+=sourceLineNo+" */ "}result+=linePrefix+line+"\n"}}else throw new Error("bad --lines option: "+linesOpt);return result};function _pp(node){var curLineNo=0;var lineNodeMap={};var src=pp(node);return{source:src,lineMap:lineNodeMap};function countNewline(s){curLineNo+=1;return s}function indent(n,s){var dent=new Array(n+1).join(" ");s.map(function(str){return str.replace(/\n/g,"\n"+dent)});s.prepend(new sourceMap.SourceNode(null,null,null,dent));return s}function isBlock(n){return n&&n.type===BLOCK}function isNonEmptyBlock(n){return isBlock(n)&&n.children.length>0}var lines;function sourceNodeFromNode(n,content){var lineno,column,source=n.tokenizer&&n.tokenizer.filename;source=source||void 0;var start=n.start,end=n.end;var sourceString=n.tokenizer&&n.tokenizer.source;if(!source||!start||!end||!sourceString){return new sourceMap.SourceNode(void 0,void 0,void 0,content)}if(source&&!lines){lines=[];lines[-1]=0;var lineno=1;for(var index=sourceString.indexOf("\n");index>=0;index=sourceString.indexOf("\n",index+1)){lines[index]=lineno;lineno++}}while(start<end&&" \n	;{}".indexOf(sourceString[start])>=0)start++;if(start<end){var fragment=sourceString.substring(start,end);var newline=sourceString.lastIndexOf("\n",start);lineno=lines[newline]+1;column=start-(newline+1)}else{source=void 0}return new sourceMap.SourceNode(lineno,column,source,content)}function nodeStr(n){return sourceNodeFromNode(n,'"'+n.value.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"')}function pp(n,d,inLetHead){var topScript=false;if(!n)return"";if(!(n instanceof Object))return""+n;if(!d){topScript=true;d=1}if(!lineNodeMap[curLineNo])lineNodeMap[curLineNo]=[];lineNodeMap[curLineNo].push(n);var p=sourceNodeFromNode(n);if(n.parenthesized)p.add("(");switch(n.type){case FUNCTION:case GETTER:case SETTER:if(n.type===FUNCTION)p.add("function");else if(n.type===GETTER)p.add("get");else p.add("set");if(n.name){p.add([" ",sourceNodeFromNode(n,n.name)])}p.add("(");for(var i=0,j=n.params.length;i<j;i++){p.add([i>0?", ":"",pp(n.params[i],d)])}p.add([") ",pp(n.body,d)]);break;case SCRIPT:case BLOCK:var nc=n.children;if(topScript){for(var i=0,j=nc.length;i<j;i++){if(i>0)p.add(countNewline("\n"));p.add(pp(nc[i],d));if(p.lastChar()!=";")p.add(";")}break}p.add("{");if(n.id!==undefined)p.add(" /* "+n.id+" */");p.add(countNewline("\n"));for(var i=0,j=nc.length;i<j;i++){if(i>0)p.add(countNewline("\n"));p.add(indent(2,pp(nc[i],d)));if(p.lastChar()!=";")p.add(";")}p.add(countNewline("\n}"));break;case LET_BLOCK:p.add(["let (",pp(n.variables,d,true),") "]);if(n.expression)p.add(pp(n.expression,d));else p.add(pp(n.block,d));break;case IF:p.add(["if (",pp(n.condition,d),") "]);var tp=n.thenPart,ep=n.elsePart;var b=isBlock(tp)||isBlock(ep);if(!b)p.add(countNewline("{\n"));p.add(b?pp(tp,d):indent(2,pp(tp,d)));if(ep&&";}".indexOf(p.lastChar())<0)p.add(";");p.add(countNewline("\n"));if(ep){if(!b)p.add(countNewline("} else {\n"));else p.add(" else ");p.add([b?pp(ep,d):indent(2,pp(ep,d)),countNewline("\n")])}if(!b)p.add("}");break;case SWITCH:p.add(["switch (",pp(n.discriminant,d),countNewline(") {\n")]);for(var i=0,j=n.cases.length;i<j;i++){var ca=n.cases[i];if(ca.type===CASE)p.add(["case ",pp(ca.caseLabel,d),countNewline(":\n")]);else p.add(countNewline("  default:\n"));p.add([pp(ca.statements,d).stripPrefix(2).stripSuffix(2),countNewline("\n")]);curLineNo-=2}p.add("}");break;case FOR:p.add(["for (",pp(n.setup,d),"; ",pp(n.condition,d),"; ",pp(n.update,d),") "]);var pb=pp(n.body,d);if(!isBlock(n.body)){p.add([countNewline("{\n"),indent(2,pb),countNewline(";\n}")])}else if(n.body)p.add(pb);break;case WHILE:p.add(["while (",pp(n.condition,d),") "]);var pb=pp(n.body,d);if(!isBlock(n.body)){p.add([countNewline("{\n"),indent(2,pb),countNewline(";\n}")])}else p.add(pb);break;case FOR_IN:var u=n.varDecl;p.add([n.isEach?"for each (":"for (",u?pp(u,d):pp(n.iterator,d)," in ",pp(n.object,d),") "]);var pb=pp(n.body,d);if(!isBlock(n.body)){p.add([countNewline("{\n"),indent(2,pb),countNewline(";\n}")])}else if(n.body)p.add(pb);break;case DO:p.add(["do ",pp(n.body,d)," while (",pp(n.condition,d),");"]);break;case BREAK:p.add(["break",n.label?" "+n.label:"",";"]);break;case CONTINUE:p.add(["continue",n.label?" "+n.label:"",";"]);break;case TRY:p.add(["try ",pp(n.tryBlock,d)]);for(var i=0,j=n.catchClauses.length;i<j;i++){var t=n.catchClauses[i];p.add([" catch (",pp(t.varName,d),t.guard?" if "+pp(t.guard,d):"",") ",pp(t.block,d)])}if(n.finallyBlock){p.add([" finally ",pp(n.finallyBlock,d)])}break;case THROW:p.add(["throw ",pp(n.exception,d)]);break;case RETURN:p.add("return");if(n.value){p.add([" ",pp(n.value,d)])}break;case YIELD:p.add("yield");if(n.value.type){p.add([" ",pp(n.value,d)])}break;case GENERATOR:p.add([pp(n.expression,d)," ",pp(n.tail,d)]);break;case WITH:p.add(["with (",pp(n.object,d),") ",pp(n.body,d)]);break;case LET:case VAR:case CONST:var nc=n.children;if(!inLetHead){p.add([tokens[n.type]," "])}for(var i=0,j=nc.length;i<j;i++){if(i>0)p.add(", ");var u=nc[i];p.add(pp(u.name,d));if(u.initializer){p.add([" = ",pp(u.initializer,d)])}}break;case DEBUGGER:p.add(countNewline("debugger\n"));break;case SEMICOLON:if(n.expression){p.add([pp(n.expression,d),";"])}break;case LABEL:p.add([n.label,countNewline(":\n"),pp(n.statement,d)]);break;case COMMA:case LIST:var nc=n.children;for(var i=0,j=nc.length;i<j;i++){if(i>0)p.add(", ");p.add(pp(nc[i],d))}break;case ASSIGN:var nc=n.children;var t=n.assignOp;p.add([pp(nc[0],d)," ",t?tokens[t]:"","="," ",pp(nc[1],d)]);break;case HOOK:var nc=n.children;p.add(["(",pp(nc[0],d)," ? ",pp(nc[1],d)," : ",pp(nc[2],d),")"]);break;case OR:case AND:var nc=n.children;p.add(["(",pp(nc[0],d)," ",tokens[n.type]," ",pp(nc[1],d),")"]);break;case BITWISE_OR:case BITWISE_XOR:case BITWISE_AND:case EQ:case NE:case STRICT_EQ:case STRICT_NE:case LT:case LE:case GE:case GT:case IN:case INSTANCEOF:case LSH:case RSH:case URSH:case PLUS:case MINUS:case MUL:case DIV:case MOD:var nc=n.children;p.add(["(",pp(nc[0],d)," ",tokens[n.type]," ",pp(nc[1],d),")"]);break;case DELETE:case VOID:case TYPEOF:p.add([tokens[n.type]," ",pp(n.children[0],d)]);break;case NOT:case BITWISE_NOT:p.add([tokens[n.type],pp(n.children[0],d)]);break;case UNARY_PLUS:p.add(["+",pp(n.children[0],d)]);break;case UNARY_MINUS:p.add(["-",pp(n.children[0],d)]);break;case INCREMENT:case DECREMENT:if(n.postfix){p.add([pp(n.children[0],d),tokens[n.type]])}else{p.add([tokens[n.type],pp(n.children[0],d)])}break;case DOT:var nc=n.children;p.add([pp(nc[0],d),".",pp(nc[1],d)]);break;case INDEX:var nc=n.children;p.add([pp(nc[0],d),"[",pp(nc[1],d),"]"]);break;case CALL:var nc=n.children;p.add([pp(nc[0],d),"(",pp(nc[1],d),")"]);break;case NEW:case NEW_WITH_ARGS:var nc=n.children;p.add("new ");p.add(pp(nc[0],d));if(nc[1]){p.add(["(",pp(nc[1],d),")"])}break;case ARRAY_INIT:p.add("[");var nc=n.children;for(var i=0,j=nc.length;i<j;i++){if(nc[i])p.add(pp(nc[i],d));p.add(",")}p.add("]");break;case ARRAY_COMP:p.add(["[",pp(n.expression,d)," ",pp(n.tail,d),"]"]);break;case COMP_TAIL:var nc=n.children;for(var i=0,j=nc.length;i<j;i++){if(i>0)p.add(" ");p.add(pp(nc[i],d))}if(n.guard){p.add([" if (",pp(n.guard,d),")"])}break;case OBJECT_INIT:var nc=n.children;if(nc[0]&&nc[0].type===PROPERTY_INIT)p.add(countNewline("{\n"));else p.add("{");for(var i=0,j=nc.length;i<j;i++){if(i>0){p.add(countNewline(",\n"))}var t=nc[i];if(t.type===PROPERTY_INIT){var tc=t.children;var l;if(typeof tc[0].value==="string"&&!/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(tc[0].value)){l=nodeStr(tc[0]);p.add(l)}else{l=pp(tc[0],d);p.add(indent(2,l))}p.add([": ",indent(2,pp(tc[1],d)).stripPrefix(2)])}else{p.add(indent(2,pp(t,d)))}}p.add(countNewline("\n}"));break;case NULL:p.add("null");break;case THIS:p.add("this");break;case TRUE:p.add("true");break;case FALSE:p.add("false");break;case IDENTIFIER:case NUMBER:case REGEXP:if(n.value.isOctal)p.add("0"+n.value.toString(8));else p.add(""+n.value);break;case STRING:p.add(nodeStr(n));break;case GROUP:p.add(["(",pp(n.children[0],d),")"]);break;default:throw"PANIC: unknown operation "+tokens[n.type]+" "+n.toSource()}if(n.parenthesized)p.add(")");return p}}})(typeof exports!=="undefined"?exports:window.Streamline=window.Streamline||{});if(typeof exports!=="undefined"){var Narcissus=srequire("../../deps/narcissus");var format=srequire("./format").format}else{var format=Streamline.format}(function(exports){exports.version=srequire("streamline/lib/version").version+" (callbacks)";var parse=Narcissus.parser.parse;var pp=Narcissus.decompiler.pp;var definitions=Narcissus.definitions;eval(definitions.consts.replace(/const /g,"var "));function _assert(cond){if(!cond)throw new Error("Assertion failed!")}function _tag(node){if(!node||!node.type)return"*NOT_A_NODE*";var t=definitions.tokens[node.type];return/^\W/.test(t)?definitions.opTypeNames[t]:t.toUpperCase()}function originalLine(options,line,col){if(!options.prevMap)return line;if(col==null)col=1e3;var r=options.prevMap.originalPositionFor({line:line,column:col}).line;return r==null?line:r}function originalCol(options,line,col){if(!options.prevMap)return col;return options.prevMap.originalPositionFor({line:line,column:col}).column||0}function _node(ref,type,children){return{_scope:ref&&ref._scope,_async:ref&&ref._async,type:type,children:children}}function _identifier(name,initializer){return{_scope:initializer&&initializer._scope,type:IDENTIFIER,name:name,value:name,initializer:initializer}}function _number(val){return{type:NUMBER,value:val}}function _string(val){return{type:STRING,value:val}}function _return(node){return{type:RETURN,_scope:node._scope,value:node}}function _semicolon(node){var stmt=_node(node,SEMICOLON);stmt.expression=node;return stmt}function _safeName(precious,name){if(name.substring(0,2)==="__")while(precious[name])name+="A";return name}function _flatten(node){if(node.type==BLOCK||node.type==SCRIPT){do{var found=false;var children=[];node.children.forEach(function(child){if(child._isFunctionReference||child.type==SEMICOLON&&(child.expression==null||child.expression._isFunction))return;node._async|=child._async;if(child.type==BLOCK||child.type==SCRIPT){children=children.concat(child.children);found=true}else children.push(child)});node.children=children}while(found)}return node}function _propagate(node,fn,doAll,clone){var result=clone?clone:node;for(var prop in node){if(node.hasOwnProperty(prop)&&prop.indexOf("Decls")<0&&(doAll||prop!="target")&&prop[0]!="_"){var child=node[prop];if(child!=null){if(Array.isArray(child)){if(clone)result[prop]=child=[].concat(child);var undef=false;for(var i=0;i<child.length;i++){if(doAll||child[i]&&child[i].type){child[i]=fn(child[i],node);undef|=typeof child[i]==="undefined"}}if(undef){result[prop]=child.filter(function(elt){return typeof elt!=="undefined"})}}else{if(doAll||child&&child.type)result[prop]=fn(child,node)}}}}return result}function _clone(node){var lastId=0;var clones={};function cloneOne(child){if(!child||!child.type)return child;var cloneId=child._cloneId;if(!cloneId)cloneId=child._cloneId=++lastId;var clone=clones[cloneId];if(clone)return clone;clones[cloneId]=clone={_cloneId:cloneId};return _propagate(child,cloneOne,true,clone)}return _propagate(node,cloneOne,true,{})}function Template(pass,str,isExpression,createScope){var _root=parse("function _t(){"+str+"}").children[0].body;if(_root.children.length==1)_root=_root.children[0];else _root=_node(_root.children[0],BLOCK,_root.children);this.generate=function(scopeNode,bindings){var scope=scopeNode._scope;_assert(scope!=null);bindings=bindings||{};var fn=null;function gen(node){if(node.type!=SCRIPT&&node.type!=BLOCK)node._pass=pass;if(node.type==FUNCTION&&createScope){_assert(fn==null);fn=node}if(!node||!node.type){if(node=="_")return scope.options.callback;if(typeof node==="string"){if(node[0]==="$")return bindings[node];return _safeName(scope.options.precious,node)}return node}node._scope=scope;var ident=node.type==SEMICOLON?node.expression:node;if(ident&&ident.type==IDENTIFIER&&ident.value[0]==="$"){var result=bindings[ident.value];if(ident.initializer){result.initializer=gen(ident.initializer);if(result.initializer._async)result._async=true}return result}else{node=_propagate(node,function(child){child=gen(child);if(child&&(child._async||child===scope.options.callback&&createScope)&&node.type!==FUNCTION)node._async=true;return child},true);node=_flatten(node);return node}}var result=gen(_clone(_root));if(fn){fn.parenthesized=true;var scope=new Scope(fn.body,fn._scope.options);scope.name=fn._scope.name;scope.line=fn._scope.line;scope.last=fn._scope.last;_assert(fn.params[0]===fn._scope.options.callback);scope.cbIndex=0;function _changeScope(node,parent){if(node.type==FUNCTION)return node;node._scope=scope;return _propagate(node,_changeScope)}_propagate(fn,_changeScope)}return isExpression?result.value:result};this.root=isExpression?_root.value:_root}function Scope(script,options){this.script=script;this.line=0;this.last=0;this.vars=[];this.functions=[];this.options=options;this.cbIndex=-1;this.isAsync=function(){return this.cbIndex>=0}}function _genId(node){return _safeName(node._scope.options.precious,"__"+ ++node._scope.last)}function _removeFast(node,options){function _isMarker(node){return node.type===IDENTIFIER&&node.value===options.callback}function _isStar(node){return node.type===CALL&&_isMarker(node.children[0])&&node.children[1].children.length===2}if(node.type===BITWISE_NOT&&_isMarker(node.children[0])){options.needsTransform=true;return node.children[0]}if(node.type===ARRAY_INIT&&node.children.length===1&&_isMarker(node.children[0])){options.needsTransform=true;node.children[0]._returnArray=true;return node.children[0]}if(node.type===RSH&&_isMarker(node.children[0])){options.needsTransform=true;return node.children[1]}if(node.type===LSH&&_isMarker(node.children[0])){options.needsTransform=true;return node.children[1]}if(node.type===NOT&&_isMarker(node.children[0])){options.needsTransform=true;node.type=FALSE;node.children=[];return node}if(_isStar(node)){node._isStar=true;options.needsTransform=true;node.children[0].value=_safeName(options.precious,"__rt")+".streamlinify";return node}return node}function _markSource(node,options){function _markOne(node){if(typeof node.value==="string")options.precious[node.value]=true;node.params&&node.params.forEach(function(param){options.precious[param]=true});node._isSourceNode=true;_propagate(node,function(child){child=_removeFast(child,options);_markOne(child);return child})}_markOne(node)}function _isScriptAsync(script,options){var async=false;function _doIt(node,parent){switch(node.type){case FUNCTION:return node;case IDENTIFIER:if(node.value==options.callback){async=true}else{_propagate(node,_doIt)}return node;case CALL:var fn=node.children[0],args=node.children[1],ident;if(fn.type===DOT&&(ident=fn.children[1]).value==="call"&&(fn=fn.children[0]).type===FUNCTION&&fn.params.length===0&&!fn.name&&args.children.length===1&&args.children[0].type===THIS){_propagate(fn.body,_doIt);return node}default:if(!async){_propagate(node,_doIt)}return node}}_propagate(script,_doIt);if(async&&options.verbose)console.log("WARNING: async calls found at top level in "+script.filename);return async}var _rootTemplate=new Template("root","(function main(_){ $script }).call(this, __trap);");function _canonTopLevelScript(script,options){script._scope=new Scope(script,options);if(_isScriptAsync(script,options))return _rootTemplate.generate(script,{$script:script});else return script}var _assignTemplate=new Template("canon","$lhs = $rhs;");function _guessName(node,parent){function _sanitize(name){name=name.replace(/[^A-Z0-9_$]/gi,"_o_");return name&&!/^\d/.test(name)?name:"_o_"+name}var id=_genId(node),n,nn;if(parent.type===IDENTIFIER)return _sanitize(parent.value)+id;if(parent.type===ASSIGN){n=parent.children[0];var s="";while(n.type===DOT&&(nn=n.children[1]).type===IDENTIFIER||n.type===INDEX&&(nn=n.children[1]).type===STRING){s=s?nn.value+"_"+s:nn.value;n=n.children[0]}if(n.type===IDENTIFIER)s=s?n.value+"_"+s:n.value;if(s)return _sanitize(s)+id}else if(parent.type==PROPERTY_INIT){n=parent.children[0];if(n.type===IDENTIFIER||n.type===STRING)return _sanitize(n.value)+id}return id}function _canonScopes(node,options){function _doIt(node,parent){var scope=parent._scope;node._scope=scope;var async=scope.isAsync();if(!async&&node.type!==FUNCTION){if(node.type===IDENTIFIER&&node.value===options.callback&&!parent._isStar){throw new Error(node.filename+": Function contains async calls but does not have _ parameter: "+node.name+" at line "+node.lineno)}return _propagate(node,_doIt)}if(node.type===TRY)node._async=true;switch(node.type){case FUNCTION:var result=node;var cbIndex=node.params.reduce(function(index,param,i){if(param!=options.callback)return index;if(index<0)return i;else throw new Error("duplicate _ parameter")},-1);if(cbIndex>=0){if(_isFatArrow(node))return node;options.needsTransform=true;if(!node.name)node.name=_guessName(node,parent)}if(async&&(parent.type===SCRIPT||parent.type===BLOCK)){scope.functions.push(node);result=undefined}var bodyScope=new Scope(node.body,options);
node.body._scope=bodyScope;bodyScope.name=node.name;bodyScope.cbIndex=cbIndex;bodyScope.line=node.lineno;node.body=_propagate(node.body,_doIt);if(cbIndex>=0)bodyScope.functions.push(_string("BEGIN_BODY"));node.body.children=bodyScope.functions.concat(node.body.children);if(bodyScope.hasThis&&!node._inhibitThis){bodyScope.vars.push(_identifier(_safeName(options.precious,"__this"),_node(node,THIS)))}if(bodyScope.hasArguments&&!node._inhibitArguments){bodyScope.vars.push(_identifier(_safeName(options.precious,"__arguments"),_identifier("arguments")))}if(bodyScope.vars.length>0){node.body.children.splice(0,0,_node(node,VAR,bodyScope.vars))}return result;case VAR:var children=node.children.map(function(child){if(!scope.vars.some(function(elt){return elt.value==child.value})){scope.vars.push(_identifier(child.value))}if(!child.initializer)return null;child=_assignTemplate.generate(parent,{$lhs:_identifier(child.value),$rhs:child.initializer});if(parent.type===FOR)child=child.expression;return child}).filter(function(child){return child!=null});if(children.length==0){return}var type=parent.type==BLOCK||parent.type===SCRIPT?BLOCK:COMMA;var result=_node(parent,type,children);result=_propagate(result,_doIt);parent._async|=result._async;return result;case THIS:scope.hasThis=true;return _identifier(_safeName(options.precious,"__this"));case IDENTIFIER:if(node.value==="arguments"){scope.hasArguments=true;return _identifier(_safeName(options.precious,"__arguments"))}node=_propagate(node,_doIt);node._async|=node.value===options.callback;if(node._async&&!parent.isArgsList&&!(parent.type===PROPERTY_INIT&&node===parent.children[0])&&!(parent.type===DOT&&node===parent.children[1]))throw new Error("invalid usage of '_'");parent._async|=node._async;return node;case NEW_WITH_ARGS:var cbIndex=node.children[1].children.reduce(function(index,arg,i){if(arg.type!==IDENTIFIER||arg.value!==options.callback)return index;if(index<0)return i;else throw new Error("duplicate _ argument")},-1);if(cbIndex>=0){var constr=_node(node,CALL,[_identifier(_safeName(options.precious,"__construct")),_node(node,LIST,[node.children[0],_number(cbIndex)])]);node=_node(node,CALL,[constr,node.children[1]])}node.children[1].isArgsList=true;node=_propagate(node,_doIt);parent._async|=node._async;return node;case CALL:node.children[1].isArgsList=true;_convertCoffeeScriptCalls(node,options);_convertApply(node,options);node.children[1].isArgsList=true;default:node=_propagate(node,_doIt);_setBreaks(node);parent._async|=node._async;return node}}return _propagate(node,_doIt)}function _convertCoffeeScriptCalls(node,options){var fn=node.children[0];var args=node.children[1];if(fn.type===FUNCTION&&fn.params.length===0&&!fn.name&&args.children.length==0){fn._noFuture=true;fn.name="___closure";fn.params=[options.callback];args.children=[_identifier(options.callback)]}else if(fn.type===DOT){var ident=fn.children[1];fn=fn.children[0];if(fn.type===FUNCTION&&fn.params.length===0&&!fn.name&&ident.type===IDENTIFIER){if(ident.value==="call"&&args.children.length===1&&args.children[0].type===THIS){node.children[0]=fn;fn._noFuture=true;fn.name="___closure";fn.params=[options.callback];args.children=[_identifier(options.callback)];node._scope.hasThis=true;fn._inhibitThis=true}else if(ident.value==="apply"&&args.children.length===2&&args.children[0].type===THIS&&args.children[1].type===IDENTIFIER&&args.children[1].value==="arguments"){node.children[0]=fn;fn._noFuture=true;fn.name="___closure";fn.params=[options.callback];args.children=[_identifier(options.callback)];node._scope.hasThis=true;node._scope.hasArguments=true;fn._inhibitThis=true;fn._inhibitArguments=true}}}}function _isFatArrow(node){if(node.body.children.length!==1)return false;var n=node.body.children[0];if(n.type!==RETURN||!n.value)return false;n=n.value;if(n.type!==CALL)return false;var args=n.children[1].children;var target=n.children[0];if(args.length!==2||args[0].value!=="_this"||args[1].value!=="arguments")return false;if(target.type!==DOT||target.children[1].value!=="apply")return false;target=target.children[0];if(target.type!==DOT||target.children[1].type!==IDENTIFIER)return false;target=target.children[0];if(target.type!==DOT||target.children[1].value!=="prototype")return false;target=target.children[0];if(target.type!==IDENTIFIER)return false;node.params=[];return true}function _convertApply(node,options){var dot=node.children[0];var args=node.children[1];if(dot.type===DOT){var ident=dot.children[1];if(ident.type===IDENTIFIER&&ident.value==="apply"&&args.children.length===2&&args.children[0].type===THIS&&args.children[1].type===IDENTIFIER&&args.children[1].value==="arguments"){var f=dot.children[0];node.children[0]=_identifier("__apply");args.children=[_identifier(options.callback),f,_identifier("__this"),_identifier("__arguments"),_number(node._scope.cbIndex)];node._scope.hasThis=true;node._scope.hasArguments=true}}}var _switchVarTemplate=new Template("canon","{ var $v = true; }");var _switchIfTemplate=new Template("canon","if ($v) { $block; }");function _setBreaks(node){switch(node.type){case IF:node._breaks=node.thenPart._breaks&&node.elsePart&&node.elsePart._breaks;break;case SWITCH:for(var i=0;i<node.cases.length;i++){var stmts=node.cases[i].statements;if(node._async&&stmts.children.length>0&&!stmts._breaks){if(i==node.cases.length-2&&node.cases[i+1].type===DEFAULT&&node.cases[i+1].statements.children.length===1&&node.cases[i+1].statements.children[0].type===SEMICOLON&&node.cases[i+1].statements.children[0].expression==null){stmts.children.push(_node(node,BREAK));stmts._breaks=true}else if(i===node.cases.length-1){stmts.children.push(_node(node,BREAK));stmts._breaks=true}else{var v=_identifier(_genId(node));node.cases[i].statements=_switchVarTemplate.generate(node.cases[i],{$v:v});var ifStmt=_switchIfTemplate.generate(node.cases[i],{$v:v,$block:stmts});node.cases[i+1].statements.children.splice(0,0,ifStmt)}}}break;case TRY:node._breaks=node.tryBlock._breaks&&node.catchClauses[0]&&node.catchClauses[0].block._breaks;break;case BLOCK:case SCRIPT:node.children.forEach(function(child){node._breaks|=child._breaks});break;case RETURN:case THROW:case BREAK:node._breaks=true;break}}function _statementify(exp){if(!exp)return exp;var block=_node(exp,BLOCK,[]);function uncomma(node){if(node.type===COMMA){node.children.forEach(uncomma)}else{block.children.push(node.type==SEMICOLON?node:_semicolon(node))}}uncomma(exp);return block}function _blockify(node){if(!node||node.type==BLOCK)return node;if(node.type==COMMA)return _statementify(node);var block=_node(node,BLOCK,[node]);block._async=node._async;return block}var _flowsTemplates={WHILE:new Template("flows","{"+"	for (; $condition;) {"+"		$body;"+"	}"+"}"),DO:new Template("flows","{"+"	var $firstTime = true;"+"	for (; $firstTime || $condition;) {"+"		$firstTime = false;"+"		$body;"+"	}"+"}"),FOR:new Template("flows","{"+"	$setup;"+"	for (; $condition; $update) {"+"		$body;"+"	}"+"}"),FOR_IN:new Template("flows","{"+"	var $array = __forIn($object);"+"	var $i = 0;"+"	for (; $i < $array.length;) {"+"		$iter = $array[$i++];"+"		$body;"+"	}"+"}"),TRY:new Template("flows",""+"try {"+"	try { $try; }"+"	catch ($ex) { $catch; }"+"}"+"finally { $finally; }"),AND:new Template("flows",""+"return (function $name(_){"+"	var $v = $op1;"+"	if (!$v) {"+"		return $v;"+"	}"+"	return $op2;"+"})(_)",true,true),OR:new Template("flows",""+"return (function $name(_){"+"	var $v = $op1;"+"	if ($v) {"+"		return $v;"+"	}"+"	return $op2;"+"})(_)",true,true),HOOK:new Template("flows",""+"return (function $name(_){"+"	var $v = $condition;"+"	if ($v) {"+"		return $true;"+"	}"+"	return $false;"+"})(_);",true,true),COMMA:new Template("flows",""+"return (function $name(_){"+"	$body;"+"	return $result;"+"})(_);",true,true),CONDITION:new Template("flows",""+"return (function $name(_){"+"	return $condition;"+"})(_);",true,true),UPDATE:new Template("flows",""+"return (function $name(_){"+"	$update;"+"})(_);",true,true)};function _canonFlows(node,options){function _doIt(node,parent,force){var scope=node._scope;function _doAsyncFor(node){if(node.condition&&node.condition._async&&node.condition.type!==CALL)node.condition=_flowsTemplates.CONDITION.generate(node,{$name:"__$"+node._scope.name,$condition:_doIt(node.condition,node,true)});if(node.update&&node.update._async)node.update=_flowsTemplates.UPDATE.generate(node,{$name:"__$"+node._scope.name,$update:_statementify(node.update)})}if(node.type==FOR&&node._pass==="flows")_doAsyncFor(node);if(!scope||!scope.isAsync()||!force&&node._pass==="flows")return _propagate(node,_doIt);switch(node.type){case IF:node.thenPart=_blockify(node.thenPart);node.elsePart=_blockify(node.elsePart);break;case SWITCH:if(node._async){var def=node.cases.filter(function(n){return n.type==DEFAULT})[0];if(!def){def=_node(node,DEFAULT);def.statements=_node(node,BLOCK,[]);node.cases.push(def)}if(!def._breaks){def.statements.children.push(_node(node,BREAK))}}break;case WHILE:node.body=_blockify(node.body);if(node._async){node=_flowsTemplates.WHILE.generate(node,{$condition:node.condition,$body:node.body})}break;case DO:node.body=_blockify(node.body);if(node._async){node=_flowsTemplates.DO.generate(node,{$firstTime:_identifier(_genId(node)),$condition:node.condition,$body:node.body})}break;case FOR:node.condition=node.condition||_number(1);node.body=_blockify(node.body);if(node._async){if(node.setup){node=_flowsTemplates.FOR.generate(node,{$setup:_statementify(node.setup),$condition:node.condition,$update:node.update,$body:node.body})}else{if(node._pass!=="flows"){node._pass="flows";_doAsyncFor(node)}}}break;case FOR_IN:node.body=_blockify(node.body);if(node._async){if(node.iterator.type!=IDENTIFIER){throw new Error("unsupported 'for ... in' syntax: type="+_tag(node.iterator))}node=_flowsTemplates.FOR_IN.generate(node,{$array:_identifier(_genId(node)),$i:_identifier(_genId(node)),$object:node.object,$iter:node.iterator,$body:node.body})}break;case TRY:if(node.tryBlock&&node.catchClauses[0]&&node.finallyBlock){node=_flowsTemplates.TRY.generate(node,{$try:node.tryBlock,$catch:node.catchClauses[0].block,$ex:node.catchClauses[0].varName,$finally:node.finallyBlock})}break;case AND:case OR:if(node._async){node=_flowsTemplates[_tag(node)].generate(node,{$name:"__$"+node._scope.name,$v:_identifier(_genId(node)),$op1:node.children[0],$op2:node.children[1]})}break;case HOOK:if(node._async){node=_flowsTemplates.HOOK.generate(node,{$name:"__$"+node._scope.name,$v:_identifier(_genId(node)),$condition:node.children[0],$true:node.children[1],$false:node.children[2]})}break;case COMMA:if(node._async){node=_flowsTemplates.COMMA.generate(node,{$name:"__$"+node._scope.name,$body:_node(node,BLOCK,node.children.slice(0,node.children.length-1).map(_semicolon)),$result:node.children[node.children.length-1]})}break}return _propagate(node,_doIt)}return _propagate(node,_doIt)}function _split(node,prop){var exp=node[prop];if(!exp||!exp._async)return node;var id=_genId(node);var v=_identifier(id,exp);node[prop]=_identifier(id);return _node(node,BLOCK,[_node(node,VAR,[v]),node])}function _disassemble(node,options){function _disassembleIt(node,parent,noResult){if(!node._async)return _propagate(node,_scanIt);node=_propagate(node,_disassembleIt);if(node.type===CALL){if(node.children[0].type===IDENTIFIER&&node.children[0].value.indexOf("__wrap")==0){node._isWrapper=true;return node}var args=node.children[1];if(args.children.some(function(arg){return arg.type===IDENTIFIER&&arg.value===options.callback||arg._isWrapper})){if(noResult){node._scope.disassembly.push(_statementify(node));return}else{if(parent.type==IDENTIFIER&&parent.value.indexOf("__")===0){node._skipDisassembly=true;return node}var id=_genId(node);var v=_identifier(id,node);node=_node(node,VAR,[v]);node._scope.disassembly.push(node);return _identifier(id)}}}return node}function _scanIt(node,parent){var scope=node._scope;if(!scope||!scope.isAsync()||!node._async)return _propagate(node,_scanIt);switch(node.type){case IF:node=_split(node,"condition");break;case SWITCH:node=_split(node,"discriminant");break;case FOR:break;case RETURN:node=_split(node,"value");break;case THROW:node=_split(node,"exception");break;case VAR:_assert(node.children.length===1);var ident=node.children[0];scope.disassembly=[];ident.initializer=_disassembleIt(ident.initializer,ident);node._async=ident.initializer._skipDisassembly;scope.disassembly.push(node);return _node(parent,BLOCK,scope.disassembly);case SEMICOLON:scope.disassembly=[];node.expression=_disassembleIt(node.expression,node,true);if(node.expression){node._async=false;scope.disassembly.push(node)}return _node(parent,BLOCK,scope.disassembly)}return _propagate(node,_scanIt)}return _propagate(node,_scanIt)}var _cbTemplates={FUNCTION:new Template("cb","{"+"	$decls;"+"	var __frame = { name: $fname, line: $line };"+"	return __func(_, this, arguments, $fn, $index, __frame, function $name(){"+"		$body;"+"		_();"+"	});"+"}"),FUNCTION_INTERNAL:new Template("cb","{ $decls; $body; _(); }"),RETURN:new Template("cb","return _(null, $value);"),RETURN_UNDEFINED:new Template("cb","return _(null);"),THROW:new Template("cb","return _($exception);"),IF:new Template("cb",""+"return (function $name(__then){"+"	if ($condition) { $then; __then(); }"+"	else { $else; __then(); }"+"})(function $name(){ $tail; });"),SWITCH:new Template("cb",""+"return (function $name(__break){"+"	$statement;"+"})(function $name(){ $tail; });"),LABEL:new Template("cb",""+"$statement;"+"$tail;"),BREAK:new Template("cb","return __break();"),LABELLED_BREAK:new Template("cb","return $break();"),CONTINUE:new Template("cb",""+"while (__more) { __loop(); } __more = true;"+"return;"),LABELLED_CONTINUE:new Template("cb",""+"while ($more.get()) { $loop(); } $more.set(true);"+"return;"),LOOP1:new Template("cb",""+"if ($v) {"+"	$body;"+"	while (__more) { __loop(); } __more = true;"+"}"+"else { __break(); }"),LOOP2:new Template("temp","var $v = $condition; $loop1;"),LOOP2_UPDATE:new Template("temp",""+"if ($beenHere) { $update; } else { $beenHere = true; }"+"var $v = $condition; $loop1;"),FOR:new Template("cb",""+"return (function ___(__break){"+"	var __more;"+"	var __loop = __cb(_, __frame, 0, 0, function $name(){"+"		__more = false;"+"		$loop2"+"	});"+"	do { __loop(); } while (__more); __more = true;"+"})(function $name(){ $tail;});"),LABELLED_FOR:new Template("cb",""+"return (function ___(__break){"+"	var __more, $more = { get: function() { return __more; }, set: function(v) { __more = v; }};"+"	var __loop = __cb(_, __frame, 0, 0, function $name(){"+"		var $break = __break, $loop = __loop;"+"		__more = false;"+"		$loop2"+"	});"+"	do { __loop(); } while (__more); __more = true;"+"})(function $name(){ $tail;});"),FOR_UPDATE:new Template("cb",""+"var $beenHere = false;"+"return (function ___(__break){"+"	var __more;"+"	var __loop = __cb(_, __frame, 0, 0, function $name(){"+"		__more = false;"+"		$loop2"+"	});"+"	do { __loop(); } while (__more); __more = true;"+"})(function $name(){ $tail; });"),LABELLED_FOR_UPDATE:new Template("cb",""+"var $beenHere = false;"+"return (function ___(__break){"+"	var __more, $more = { get: function() { return __more; }, set: function(v) { __more = v; }};"+"	var __loop = __cb(_, __frame, 0, 0, function $name(){"+"		var $break = __break, $loop = __loop;"+"		__more = false;"+"		$loop2"+"	});"+"	do { __loop(); } while (__more); __more = true;"+"})(function $name(){ $tail; });"),CATCH:new Template("cb",""+"return (function ___(__then){"+"	(function ___(_){"+"		__tryCatch(_, function $name(){ $try; __then(); });"+"	})(function ___($ex, __result){"+"		__catch(function $name(){"+"			if ($ex) { $catch; __then(); }"+"			else { _(null, __result); }"+"		});"+"	});"+"})(function ___(){"+"	__tryCatch(_, function $name(){ $tail; });"+"});"),FINALLY:new Template("cb",""+"return (function ___(__then){"+"	(function ___(_){"+"		__tryCatch(_, function $name(){ $try; _(null, null, true); });"+"	})(function ___(__e, __r, __cont){"+"		(function ___(__then){"+"			__tryCatch(_, function $name(){ $finally; __then(); });"+"		})(function ___(){"+"			__tryCatch(_, function ___(){"+"				if (__cont) __then(); else _(__e, __r);"+"			});"+"		})"+"	});"+"})(function ___(){"+"	__tryCatch(_, function $name(){ $tail; });"+"});"),CALL_VOID:new Template("cb","return __cb(_, __frame, $offset, $col, function $name(){ $tail; }, true, $returnArray)",true),CALL_TMP:new Template("cb","return __cb(_, __frame, $offset, $col, function ___(__0, $result){ $tail }, true, $returnArray)",true),CALL_RESULT:new Template("cb",""+"return __cb(_, __frame, $offset, $col, function $name(__0, $v){"+"	var $result = $v;"+"	$tail"+"}, true, $returnArray)",true)};function _callbackify(node,options){var label;function _scanIt(node,parent){node=_flatten(node);if(!node._scope||!node._scope.isAsync()||node._pass==="cb")return _propagate(node,_scanIt);switch(node.type){case SCRIPT:if(parent._pass!=="cb"){var decls;for(var cut=0;cut<node.children.length;cut++){var child=node.children[cut];if(child.type===STRING&&child.value==="BEGIN_BODY"){decls=node.children.splice(0,cut);node.children.splice(0,1);break}}var template=parent._noFuture||parent._pass==="flows"?_cbTemplates.FUNCTION_INTERNAL:_cbTemplates.FUNCTION;node=template.generate(node,{$fn:parent.name,$name:"__$"+node._scope.name,$fname:_string(parent.name),$line:_number(originalLine(options,node._scope.line)),$index:_number(node._scope.cbIndex),$decls:_node(node,BLOCK,decls||[]),$body:node})}node.type=SCRIPT;case BLOCK:for(var i=0;i<node.children.length;i++){node.children[i]=_restructureIt(node,i)}return node}return _propagate(node,_scanIt)}function _extractTail(parent,i){return _node(parent,BLOCK,parent.children.splice(i+1,parent.children.length-i-1))}function _restructureIt(parent,i){var node=parent.children[i];if(node._pass==="cb")return _propagate(node,_scanIt);switch(node.type){case RETURN:_extractTail(parent,i);var template=node.value?_cbTemplates.RETURN:_cbTemplates.RETURN_UNDEFINED;node=template.generate(node,{$value:node.value});break;case THROW:_extractTail(parent,i);node=_cbTemplates.THROW.generate(node,{$exception:node.exception});break;case BREAK:if(node.target&&!node.target._async){break}_extractTail(parent,i);if(node.label){node=_cbTemplates.LABELLED_BREAK.generate(node,{$break:_safeName(options.precious,"__break__"+node.label)})}else{node=_cbTemplates.BREAK.generate(node,{})}break;case CONTINUE:if(node.target&&!node.target._async){break}_extractTail(parent,i);if(node.label){node=_cbTemplates.LABELLED_CONTINUE.generate(node,{$loop:_safeName(options.precious,"__loop__"+node.label),$more:_safeName(options.precious,"__more__"+node.label)})}else{node=_cbTemplates.CONTINUE.generate(node,{})}break;case TRY:var tail=_extractTail(parent,i);if(node.catchClauses[0]){node=_cbTemplates.CATCH.generate(node,{$name:"__$"+node._scope.name,$try:node.tryBlock,$catch:node.catchClauses[0].block,$ex:node.catchClauses[0].varName,$tail:tail})}else{node=_cbTemplates.FINALLY.generate(node,{$name:"__$"+node._scope.name,$try:node.tryBlock,$finally:node.finallyBlock,$tail:tail})}break;default:if(node._async){var tail=_extractTail(parent,i);switch(node.type){case IF:node=_cbTemplates.IF.generate(node,{$name:"__$"+node._scope.name,$condition:node.condition,$then:node.thenPart,$else:node.elsePart||_node(node,BLOCK,[]),$tail:tail});break;case SWITCH:node._pass="cb";node=_cbTemplates.SWITCH.generate(node,{$name:"__$"+node._scope.name,$statement:node,$tail:tail});break;case LABEL:var l=label;label=node.label;node=_cbTemplates.LABEL.generate(node,{$name:"__$"+node._scope.name,$statement:node.statement,$tail:tail});node=_scanIt(node,parent);label=l;return node;case FOR:var v=_identifier(_genId(node));var loop1=_cbTemplates.LOOP1.generate(node,{$v:v,$body:node.body});var update=node.update;var beenHere=update&&_identifier(_genId(node));var loop2=(update?_cbTemplates.LOOP2_UPDATE:_cbTemplates.LOOP2).generate(node,{$v:v,$condition:node.condition,$beenHere:beenHere,$update:_statementify(update),$loop1:loop1});node=(update?label?_cbTemplates.LABELLED_FOR_UPDATE:_cbTemplates.FOR_UPDATE:label?_cbTemplates.LABELLED_FOR:_cbTemplates.FOR).generate(node,{$name:"__$"+node._scope.name,$loop:_identifier(_safeName(options.precious,"__loop__"+label)),$break:_identifier(_safeName(options.precious,"__break__"+label)),$more:_identifier(_safeName(options.precious,"__more__"+label)),$beenHere:beenHere,$loop2:loop2,$tail:tail});break;case VAR:_assert(node.children.length==1);var ident=node.children[0];_assert(ident.type===IDENTIFIER);var call=ident.initializer;delete ident.initializer;_assert(call&&call.type===CALL);return _restructureCall(call,tail,ident.value);case SEMICOLON:var call=node.expression;_assert(call.type===CALL);return _restructureCall(call,tail);default:throw new Error("internal error: bad node type: "+_tag(node)+": "+pp(node))}}}return _scanIt(node,parent);function _restructureCall(node,tail,result){var args=node.children[1];function _cbIndex(args){return args.children.reduce(function(index,arg,i){if(arg.type==IDENTIFIER&&arg.value===options.callback||arg._isWrapper)return i;else return index},-1)}var i=_cbIndex(args);_assert(i>=0);var returnArray=args.children[i]._returnArray;if(args.children[i]._isWrapper){args=args.children[i].children[1];i=_cbIndex(args)}var identifier=node.children[0];while(identifier.type==DOT){identifier=identifier.children[1]}var bol=options.source.lastIndexOf("\n",identifier.start)+1;var col=identifier.start-bol;args.children[i]=(result?result.indexOf("__")===0?_cbTemplates.CALL_TMP:_cbTemplates.CALL_RESULT:_cbTemplates.CALL_VOID).generate(node,{$v:_genId(node),$frameName:_string(node._scope.name),$offset:_number(originalLine(options,identifier.lineno,col)-originalLine(options,node._scope.line)),$col:_number(originalCol(options,identifier.lineno,col)),$name:"__$"+node._scope.name,$returnArray:returnArray,$result:result,$tail:tail});node=_propagate(node,_scanIt);var stmt=_node(node,RETURN,[]);stmt.value=node;stmt._pass="cb";return stmt}}return _propagate(node,_scanIt)}function _checkUsed(val,used){if(typeof val==="string"&&val.substring(0,2)==="__")used[val]=true}var _optims={function__0$fn:new Template("simplify","return function ___(__0) { $fn(); }",true).root,function$return:new Template("simplify","return function $fn1() { return $fn2(); }",true).root,function__0$arg1return_null$arg2:new Template("simplify","return function ___(__0, $arg1) { return _(null, $arg2); }",true).root,__cb__:new Template("simplify","return __cb(_, $frameVar, $line, $col, _)",true).root,__cbt__:new Template("simplify","return __cb(_, $frameVar, $line, $col, _, true)",true).root,function$fn:new Template("simplify","return function $fn1() { $fn2(); }",true).root,closure:new Template("simplify","return (function ___closure(_){ $body; })(__cb(_,$frameVar,$line,$col,function $fnName(){_();},true))",true).root,safeParam:new Template("simplify","return (function $fnName($param){ $body; })(function $fnName(){_();})",true).root};function _simplify(node,options,used){if(node._simplified)return node;node._simplified=true;_propagate(node,function(child){return _simplify(child,options,used)});_checkUsed(node.value,used);function _match(prop,v1,v2,result){var ignored=["parenthesized","lineno","start","end","tokenizer","hasReturnWithValue"];if(prop.indexOf("_")==0||ignored.indexOf(prop)>=0)return true;if(v1==v2)return true;if(v1==null||v2==null){if(prop=="children"&&v1&&v1.length===0)return true;return false}if(Array.isArray(v1)){if(v1.length!=v2.length)return false;for(var i=0;i<v1.length;i++){if(!_match(prop,v1[i],v2[i],result))return false}return true}if(v1.type===IDENTIFIER&&v1.value[0]==="$"&&v2.type===NUMBER){result[v1.value]=v2.value;return true}if(typeof v1=="string"&&v1[0]=="$"&&typeof v2=="string"){result[v1]=v2;return true}if(v1.type){var exp;if(v1.type==SCRIPT&&v1.children[0]&&(exp=v1.children[0].expression)&&typeof exp.value=="string"&&exp.value[0]=="$"){result[exp.value]=v2;return true}if(v1.type!=v2.type)return false;if(v1.type==IDENTIFIER&&v1.value=="$"){result[v1.value]=v2.value;return true}for(var prop in v1){if(v1.hasOwnProperty(prop)&&prop.indexOf("Decls")<0&&prop!="target"){if(!_match(prop,v1[prop],v2[prop],result))return false}}return true}return false}var result={};if(_match("",_optims.function__0$fn,node,result))return _identifier(result.$fn);if(_match("",_optims.function$return,node,result)&&(result.$fn1==="___"||result.$fn1.indexOf("__$")===0)&&result.$fn2==="__break")return _identifier(result.$fn2);if(_match("",_optims.function__0$arg1return_null$arg2,node,result)&&result.$arg1==result.$arg2)return _identifier("_");if(options.optimize&&_match("",_optims.__cb__,node,result))return _identifier("_");if(options.optimize&&_match("",_optims.__cbt__,node,result))return _identifier("_");if(_match("",_optims.function$fn,node,result)&&(result.$fn1==="___"||result.$fn1.indexOf("__$")===0)&&(result.$fn2==="__then"||result.$fn2==="__loop"))return _identifier(result.$fn2);if(_match("",_optims.closure,node,result))node.children[1]=_identifier("_");if(_match("",_optims.safeParam,node,result)&&(result.$param==="__then"||result.$param==="__break"))node.children[1]=_identifier("_");_flatten(node);return node}function _extend(obj,other){for(var i in other){obj[i]=other[i]}return obj}function _cl(obj){return _extend({},obj)}exports.transform=function(source,options){try{source=source.replace(/\r\n/g,"\n");options=options?_extend({},options):{};var sourceOptions=/streamline\.options\s*=\s*(\{.*\})/.exec(source);if(sourceOptions){_extend(options,JSON.parse(sourceOptions[1]))}options.source=source;options.callback=options.callback||"_";options.lines=options.lines||"preserve";options.precious={};var node=parse(source+"\n",options.sourceName);var strict=node.children[0]&&node.children[0].expression&&node.children[0].expression.value=="use strict";strict&&node.children.splice(0,1);_markSource(node,options);node=_canonTopLevelScript(node,options);node=_canonScopes(node,options);if(!options.needsTransform)return source;node=_canonFlows(node,options);node=_disassemble(node,options);node=_callbackify(node,options);var used={};node=_simplify(node,options,used);var result=format(node,options.lines);if(!options.noHelpers){var s=exports.helpersSource(options,used,strict);if(options.lines=="sourcemap"){result.prepend(s)}else{result=s+result}}return result}catch(err){var message="error streamlining "+(options.sourceName||"source")+": "+err.message;if(err.source&&err.cursor){var line=1;for(var i=0;i<err.cursor;i++){if(err.source[i]==="\n")line+=1}message+=" on line "+line}else if(err.stack){message+="\nSTACK:\n"+err.stack}throw new Error(message)}};exports.transform.version=exports.version;function _trim(fn){return fn.toString().replace(/\s+/g," ")}function include(mod,modules){var source=modules+"['"+mod+"']=(mod={exports:{}});";source+="(function(module, exports){";var req=srequire;source+=req("fs").readFileSync(__dirname+"/../"+mod+".js","utf8").replace(/(\/\/[^"\n]*\n|\/\*[\s\S]*?\*\/|\n)[ \t]*/g,"");source+="})(mod, mod.exports);";return source}function requireRuntime(options){if(!options.standalone)return"srequire('streamline/lib/callbacks/runtime').runtime(__filename, "+!!options.oldStyleFutures+")";var modules=_safeName(options.precious,"__modules");var s="(function(){var "+modules+"={},mod;";s+="function srequire(p){var m="+modules+"[p.substring(15)]; return m && m.exports};";s+=include("globals",modules);s+=include("util/future",modules);s+=include("callbacks/runtime",modules);if(["funnel","forEach_","map_","filter_","every_","some_","reduce_","reduceRight_","sort_","apply_"].some(function(name){return options.precious[name]}))s+=include("callbacks/builtins",modules);s+="return "+modules+"['callbacks/runtime'].exports.runtime('"+options.sourceName+"', "+!!options.oldStyleFutures+");";s+="})()";return s}exports.helpersSource=function(options,used,strict){var srcName=""+options.sourceName;var i=srcName.indexOf("node_modules/");if(i==-1&&typeof process==="object"&&typeof process.cwd==="function")i=process.cwd().length;srcName=i>=0?srcName.substring(i+13):srcName;var sep=options.lines=="preserve"?" ":"\n";strict=strict?'"use strict";'+sep:"";var s=sep+strict;var keys=["__g","__func","__cb","__future","__propagate","__trap","__catch","__tryCatch","__forIn","__apply","__construct","__setEF"];var __rt=_safeName(options.precious,"__rt");s+="var "+__rt+"="+requireRuntime(options);keys.forEach(function(key){var k=_safeName(options.precious,key);if(used[k])s+=","+k+"="+__rt+"."+key});s+=";"+sep;return s}})(typeof exports!=="undefined"?exports:window.Streamline=window.Streamline||{});(function(exports){exports.future=function(fn,args,i){var err,result,done,q=[],self=this;args=Array.prototype.slice.call(args);args[i]=function(e,r){err=e,result=r,done=true;q&&q.forEach(function(f){f.call(self,e,r)});q=null};fn.apply(this,args);return function F(cb){if(typeof cb!=="function"){if(cb!==false&&!srequire("streamline/lib/globals").oldStyleFutures)throw new Error("no callback given (argument #0). If you're a Streamline user, more info: https://github.com/Sage/streamlinejs/blob/master/FAQ.md#no-callback-given-error");return F}if(done)cb.call(self,err,result);else q.push(cb)}};exports.streamlinify=function(fn,idx){return function(){if(!arguments[idx])return exports.future.call(this,fn,arguments,idx);else return fn.apply(this,arguments)}}})(typeof exports!=="undefined"?exports:Streamline.future=Streamline.future||{});(function(exports){var __g=srequire("streamline/lib/globals");__g.runtime="callbacks";var __fut=srequire("streamline/lib/util/future");__g.context=__g.context||{};__g.depth=__g.depth||0;__g.trampoline=function(){var q=[];return{queue:function(fn){q.push(fn)},flush:function(){__g.depth++;try{var fn;while(fn=q.shift())fn()}finally{__g.depth--}}}}();exports.runtime=function(filename,oldStyleFutures){__g.oldStyleFutures=oldStyleFutures;function __func(_,__this,__arguments,fn,index,frame,body){if(typeof _!=="function"){if(_!==false&&!__g.oldStyleFutures)throw new Error("no callback given (argument #"+index+"). If you're a Streamline user, more info: https://github.com/Sage/streamlinejs/blob/master/FAQ.md#no-callback-given-error");return __fut.future.call(__this,fn,__arguments,index)}frame.file=filename;frame.prev=__g.frame;__g.frame=frame;__g.depth===0&&__g.emitter&&__g.emitter.emit("resume");__g.depth++;try{frame.active=true;body()}catch(e){__propagate(_,e)}finally{frame.active=false;__g.frame=frame.prev;if(--__g.depth===0&&__g.trampoline)__g.trampoline.flush();__g.depth===0&&__g.emitter&&__g.emitter.emit("yield")}}return{__g:__g,__func:__func,__cb:__cb,__future:__fut.future,__propagate:__propagate,__trap:__trap,__tryCatch:__tryCatch,__catch:__catch,__forIn:__forIn,__apply:__apply,__construct:__construct,__setEF:__setEF,streamlinify:__fut.streamlinify}};function __cb(_,frame,offset,col,fn,trampo,returnArray){frame.offset=offset;frame.col=col;var ctx=__g.context;return function ___(err,result){if(returnArray)result=Array.prototype.slice.call(arguments,1);returnArray=false;var oldFrame=__g.frame;__g.frame=frame;__g.context=ctx;__g.depth===0&&__g.emitter&&__g.emitter.emit("resume");__g.depth++;try{if(trampo&&frame.active&&__g.trampoline){__g.trampoline.queue(function(){return ___(err,result)})}else{___.dispatched=true;if(err){__setEF(err,frame);return _(err)}frame.active=true;return fn(null,result)}}catch(ex){return __propagate(_,ex)}finally{frame.active=false;__g.frame=oldFrame;if(--__g.depth===0&&__g.trampoline)__g.trampoline.flush();__g.depth===0&&__g.emitter&&__g.emitter.emit("yield")}}}function __propagate(_,err){try{_(err)}catch(ex){__trap(ex)}}function __trap(err){if(err){if(__g.context&&__g.context.errorHandler)__g.context.errorHandler(err);else process.nextTick(function(){throw err})}}function __tryCatch(_,fn){try{fn()}catch(e){try{_(e)}catch(ex){__trap(ex)}}}function __catch(fn){var frame=__g.frame,context=__g.context;__g.trampoline.queue(function(){var oldFrame=__g.frame,oldContext=__g.context;
__g.frame=frame;__g.context=context;try{fn()}finally{__g.frame=oldFrame;__g.context=oldContext}})}function __forIn(object){var array=[];for(var obj in object){array.push(obj)}return array}function __apply(cb,fn,thisObj,args,index){if(cb==null)return __fut.future(__apply,arguments,0);args=Array.prototype.slice.call(args,0);args[index!=null?index:args.length]=cb;return fn.apply(thisObj,args)}function __construct(constructor,i){var key="__async"+i,f;return constructor[key]||(constructor[key]=function(){var args=arguments;function F(){var self=this;var cb=args[i];args[i]=function(e,r){cb(e,self)};return constructor.apply(self,args)}F.prototype=constructor.prototype;return new F})}function __setEF(e,f){function formatStack(e,raw){var ff=typeof navigator==="object"&&navigator.userAgent.toLowerCase().indexOf("firefox")>-1;if(ff)raw="Error: "+e.message+"\n"+raw;var s=raw,f,skip;if(s){var lines=s.split("\n");s=lines[0]+"\n    <<< async stack >>>\n"+lines.slice(1).map(function(l){var ffOffset=typeof navigator==="object"&&typeof srequire==="function"&&srequire.async?11:0;var m=/([^@]*)\@(.*?)\:(\d+)(?:\:(\d+))?$/.exec(l);l=m?"    at "+m[1]+" ("+m[2]+":"+(parseInt(m[3])-ffOffset)+":"+(m[4]||"0")+")":l;var i=l.indexOf("__$");if(i>=0&&!skip){skip=true;return l.substring(0,i)+l.substring(i+3)}return skip?"":l}).filter(function(l){return l}).join("\n");for(var f=e.__frame;f;f=f.prev){if(f.offset>=0)s+="\n    at "+f.name+" ("+f.file+":"+(f.line+f.offset)+":"+(f.col+1)+")"}}var nl=raw.indexOf("\n");s+="\n    <<< raw stack >>>"+(nl>=0?raw.substring(nl):raw);return s}e.__frame=e.__frame||f;if(exports.stackTraceEnabled&&e.__lookupGetter__&&e.__lookupGetter__("rawStack")==null){var getter=e.__lookupGetter__("stack");if(!getter){var raw=e.stack||"raw stack unavailable";getter=function(){return raw}}e.__defineGetter__("rawStack",getter);e.__defineGetter__("stack",function(){return formatStack(e,getter())})}}exports.stackTraceEnabled=true})(typeof exports!=="undefined"?exports:Streamline.runtime=Streamline.runtime||{});srequire&&srequire("streamline/lib/callbacks/builtins");var __rt=srequire("streamline/lib/callbacks/runtime").runtime(__filename,false),__func=__rt.__func,__cb=__rt.__cb;(function(exports){"use strict";var VERSION=3;var future=function(fn,args,i){var err,result,done,q=[],self=this;args=Array.prototype.slice.call(args);args[i]=function(e,r){err=e,result=r,done=true;q&&q.forEach(function(f){f.call(self,e,r)});q=null};fn.apply(this,args);return function F(cb){if(!cb){return F}if(done){cb.call(self,err,result)}else{q.push(cb)}}};exports.funnel=function(max){max=max==null?-1:max;if(max===0){max=funnel.defaultSize}if(typeof max!=="number"){throw new Error("bad max number: "+max)}var queue=[],active=0,closed=false;var funCb=function(callback,fn){if(callback==null){return future(funCb,arguments,0)}if(max<0||max==Infinity){return fn(callback)}queue.push({fn:fn,cb:callback});function _doOne(){var current=queue.splice(0,1)[0];if(!current.cb){return current.fn()}active++;current.fn(function(err,result){active--;if(!closed){current.cb(err,result);while(active<max&&queue.length>0){_doOne()}}})}while(active<max&&queue.length>0){_doOne()}};var fun=__rt.streamlinify(funCb,0);fun.close=function(){queue=[],closed=true};return fun};var funnel=exports.funnel;funnel.defaultSize=4;function _parallel(options){if(typeof options==="number"){return options}if(typeof options.parallel==="number"){return options.parallel}return options.parallel?-1:1}if(Array.prototype.forEach_&&Array.prototype.forEach_.version_>=VERSION){return}try{Object.defineProperty({},"x",{})}catch(e){return}var has=Object.prototype.hasOwnProperty;delete Array.prototype.forEach_;Object.defineProperty(Array.prototype,"forEach_",{configurable:true,writable:true,enumerable:false,value:function value__1(_,options,fn,thisObj){var par,len,i,__this=this;var __frame={name:"value__1",line:124};return __func(_,this,arguments,value__1,0,__frame,function __$value__1(){if(typeof options==="function"){thisObj=fn,fn=options,options=1}par=_parallel(options);thisObj=thisObj!==undefined?thisObj:__this;len=__this.length;return function __$value__1(__then){if(par===1||len<=1){i=0;var __2=false;return function ___(__break){var __more;var __loop=__cb(_,__frame,0,0,function __$value__1(){__more=false;if(__2){i++}else{__2=true}var __1=i<len;if(__1){return function __$value__1(__then){if(has.call(__this,i)){return fn.call(thisObj,__cb(_,__frame,7,31,__then,true),__this[i],i)}else{__then()}}(function __$value__1(){while(__more){__loop()}__more=true})}else{__break()}});do{__loop()}while(__more);__more=true}(__then)}else{return __this.map_(__cb(_,__frame,10,9,__then,true),par,fn,thisObj)}}(function __$value__1(){return _(null,__this)})})}});Array.prototype.forEach_.version_=VERSION;delete Array.prototype.map_;Object.defineProperty(Array.prototype,"map_",{configurable:true,writable:true,enumerable:false,value:function value__2(_,options,fn,thisObj){var par,len,result,i,fun,__this=this;var __frame={name:"value__2",line:147};return __func(_,this,arguments,value__2,0,__frame,function __$value__2(){if(typeof options==="function"){thisObj=fn,fn=options,options=1}par=_parallel(options);thisObj=thisObj!==undefined?thisObj:__this;len=__this.length;return function __$value__2(__then){if(par===1||len<=1){result=new Array(len);i=0;var __4=false;return function ___(__break){var __more;var __loop=__cb(_,__frame,0,0,function __$value__2(){__more=false;if(__4){i++}else{__4=true}var __3=i<len;if(__3){return function __$value__2(__then){if(has.call(__this,i)){return fn.call(thisObj,__cb(_,__frame,9,43,function ___(__0,__1){result[i]=__1;__then()},true),__this[i],i)}else{__then()}}(function __$value__2(){while(__more){__loop()}__more=true})}else{__break()}});do{__loop()}while(__more);__more=true}(__then)}else{fun=funnel(par);result=__this.map(function(elt,i){return fun(false,function __1(_){var __frame={name:"__1",line:161};return __func(_,this,arguments,__1,0,__frame,function __$__1(){return fn.call(thisObj,__cb(_,__frame,1,16,_,true),elt,i)})})});i=0;var __7=false;return function ___(__break){var __more;var __loop=__cb(_,__frame,0,0,function __$value__2(){__more=false;if(__7){i++}else{__7=true}var __6=i<len;if(__6){return function __$value__2(__then){if(has.call(__this,i)){return result[i](__cb(_,__frame,19,40,function ___(__0,__2){result[i]=__2;__then()},true))}else{__then()}}(function __$value__2(){while(__more){__loop()}__more=true})}else{__break()}});do{__loop()}while(__more);__more=true}(__then)}}(function __$value__2(){return _(null,result)})})}});delete Array.prototype.filter_;Object.defineProperty(Array.prototype,"filter_",{configurable:true,writable:true,enumerable:false,value:function value__3(_,options,fn,thisObj){var par,result,len,i,elt,__this=this;var __frame={name:"value__3",line:179};return __func(_,this,arguments,value__3,0,__frame,function __$value__3(){if(typeof options==="function"){thisObj=fn,fn=options,options=1}par=_parallel(options);thisObj=thisObj!==undefined?thisObj:__this;result=[];len=__this.length;return function __$value__3(__then){if(par===1||len<=1){i=0;var __4=false;return function ___(__break){var __more;var __loop=__cb(_,__frame,0,0,function __$value__3(){__more=false;if(__4){i++}else{__4=true}var __3=i<len;if(__3){return function __$value__3(__then){if(has.call(__this,i)){elt=__this[i];return fn.call(thisObj,__cb(_,__frame,10,13,function ___(__0,__2){return function __$value__3(__then){if(__2){result.push(elt);__then()}else{__then()}}(__then)},true),elt)}else{__then()}}(function __$value__3(){while(__more){__loop()}__more=true})}else{__break()}});do{__loop()}while(__more);__more=true}(__then)}else{return __this.map_(__cb(_,__frame,14,9,__then,true),par,function __1(_,elt){var __frame={name:"__1",line:193};return __func(_,this,arguments,__1,0,__frame,function __$__1(){return fn.call(thisObj,__cb(_,__frame,1,12,function ___(__0,__1){return function __$__1(__then){if(__1){result.push(elt);__then()}else{__then()}}(_)},true),elt)})},thisObj)}}(function __$value__3(){return _(null,result)})})}});delete Array.prototype.every_;Object.defineProperty(Array.prototype,"every_",{configurable:true,writable:true,enumerable:false,value:function value__4(_,options,fn,thisObj){var par,len,i,fun,futures,__this=this;var __frame={name:"value__4",line:207};return __func(_,this,arguments,value__4,0,__frame,function __$value__4(){if(typeof options==="function"){thisObj=fn,fn=options,options=1}par=_parallel(options);thisObj=thisObj!==undefined?thisObj:__this;len=__this.length;return function __$value__4(__then){if(par===1||len<=1){i=0;var __6=false;return function ___(__break){var __more;var __loop=__cb(_,__frame,0,0,function __$value__4(){__more=false;if(__6){i++}else{__6=true}var __5=i<len;if(__5){return function __$value__4(_){var __1=has.call(__this,i);if(!__1){return _(null,__1)}return fn.call(thisObj,__cb(_,__frame,8,34,function ___(__0,__3){var __2=!__3;return _(null,__2)},true),__this[i])}(__cb(_,__frame,-206,17,function ___(__0,__3){return function __$value__4(__then){if(__3){return _(null,false)}else{__then()}}(function __$value__4(){while(__more){__loop()}__more=true})},true))}else{__break()}});do{__loop()}while(__more);__more=true}(__then)}else{fun=funnel(par);futures=__this.map(function(elt){return fun(false,function __1(_){var __frame={name:"__1",line:220};return __func(_,this,arguments,__1,0,__frame,function __$__1(){return fn.call(thisObj,__cb(_,__frame,1,16,_,true),elt)})})});i=0;var __9=false;return function ___(__break){var __more;var __loop=__cb(_,__frame,0,0,function __$value__4(){__more=false;if(__9){i++}else{__9=true}var __8=i<len;if(__8){return function __$value__4(_){var __2=has.call(__this,i);if(!__2){return _(null,__2)}return futures[i](__cb(_,__frame,18,31,function ___(__0,__4){var __3=!__4;return _(null,__3)},true))}(__cb(_,__frame,-206,17,function ___(__0,__4){return function __$value__4(__then){if(__4){fun.close();return _(null,false)}else{__then()}}(function __$value__4(){while(__more){__loop()}__more=true})},true))}else{__break()}});do{__loop()}while(__more);__more=true}(__then)}}(function __$value__4(){return _(null,true)})})}});delete Array.prototype.some_;Object.defineProperty(Array.prototype,"some_",{configurable:true,writable:true,enumerable:false,value:function value__5(_,options,fn,thisObj){var par,len,i,fun,futures,__this=this;var __frame={name:"value__5",line:241};return __func(_,this,arguments,value__5,0,__frame,function __$value__5(){if(typeof options==="function"){thisObj=fn,fn=options,options=1}par=_parallel(options);thisObj=thisObj!==undefined?thisObj:__this;len=__this.length;return function __$value__5(__then){if(par===1||len<=1){i=0;var __6=false;return function ___(__break){var __more;var __loop=__cb(_,__frame,0,0,function __$value__5(){__more=false;if(__6){i++}else{__6=true}var __5=i<len;if(__5){return function __$value__5(_){var __1=has.call(__this,i);if(!__1){return _(null,__1)}return fn.call(thisObj,__cb(_,__frame,7,33,_,true),__this[i])}(__cb(_,__frame,-240,17,function ___(__0,__3){return function __$value__5(__then){if(__3){return _(null,true)}else{__then()}}(function __$value__5(){while(__more){__loop()}__more=true})},true))}else{__break()}});do{__loop()}while(__more);__more=true}(__then)}else{fun=funnel(par);futures=__this.map(function(elt){return fun(false,function __1(_){var __frame={name:"__1",line:253};return __func(_,this,arguments,__1,0,__frame,function __$__1(){return fn.call(thisObj,__cb(_,__frame,1,16,_,true),elt)})})});i=0;var __9=false;return function ___(__break){var __more;var __loop=__cb(_,__frame,0,0,function __$value__5(){__more=false;if(__9){i++}else{__9=true}var __8=i<len;if(__8){return function __$value__5(_){var __2=has.call(__this,i);if(!__2){return _(null,__2)}return futures[i](__cb(_,__frame,17,30,_,true))}(__cb(_,__frame,-240,17,function ___(__0,__4){return function __$value__5(__then){if(__4){fun.close();return _(null,true)}else{__then()}}(function __$value__5(){while(__more){__loop()}__more=true})},true))}else{__break()}});do{__loop()}while(__more);__more=true}(__then)}}(function __$value__5(){return _(null,false)})})}});delete Array.prototype.reduce_;Object.defineProperty(Array.prototype,"reduce_",{configurable:true,writable:true,enumerable:false,value:function value__6(_,fn,v,thisObj){var len,i,__this=this;var __frame={name:"value__6",line:274};return __func(_,this,arguments,value__6,0,__frame,function __$value__6(){thisObj=thisObj!==undefined?thisObj:__this;len=__this.length;i=0;var __3=false;return function ___(__break){var __more;var __loop=__cb(_,__frame,0,0,function __$value__6(){__more=false;if(__3){i++}else{__3=true}var __2=i<len;if(__2){return function __$value__6(__then){if(has.call(__this,i)){return fn.call(thisObj,__cb(_,__frame,4,34,function ___(__0,__1){v=__1;__then()},true),v,__this[i],i,__this)}else{__then()}}(function __$value__6(){while(__more){__loop()}__more=true})}else{__break()}});do{__loop()}while(__more);__more=true}(function __$value__6(){return _(null,v)})})}});delete Array.prototype.reduceRight_;Object.defineProperty(Array.prototype,"reduceRight_",{configurable:true,writable:true,enumerable:false,value:function value__7(_,fn,v,thisObj){var len,i,__this=this;var __frame={name:"value__7",line:290};return __func(_,this,arguments,value__7,0,__frame,function __$value__7(){thisObj=thisObj!==undefined?thisObj:__this;len=__this.length;i=len-1;var __3=false;return function ___(__break){var __more;var __loop=__cb(_,__frame,0,0,function __$value__7(){__more=false;if(__3){i--}else{__3=true}var __2=i>=0;if(__2){return function __$value__7(__then){if(has.call(__this,i)){return fn.call(thisObj,__cb(_,__frame,4,34,function ___(__0,__1){v=__1;__then()},true),v,__this[i],i,__this)}else{__then()}}(function __$value__7(){while(__more){__loop()}__more=true})}else{__break()}});do{__loop()}while(__more);__more=true}(function __$value__7(){return _(null,v)})})}});delete Array.prototype.sort_;Object.defineProperty(Array.prototype,"sort_",{configurable:true,writable:true,enumerable:false,value:function value__8(_,compare,beg,end){var array,__this=this;function _qsort(_,beg,end){var tmp,mid,o,nbeg,nend;var __frame={name:"_qsort",line:313};return __func(_,this,arguments,_qsort,0,__frame,function __$_qsort(){if(beg>=end){return _(null)}return function __$_qsort(__then){if(end==beg+1){return compare(__cb(_,__frame,4,9,function ___(__0,__4){var __3=__4>0;return function __$_qsort(__then){if(__3){tmp=array[beg];array[beg]=array[end];array[end]=tmp;__then()}else{__then()}}(function __$_qsort(){return _(null)})},true),array[beg],array[end])}else{__then()}}(function __$_qsort(){mid=Math.floor((beg+end)/2);o=array[mid];nbeg=beg;nend=end;return function ___(__break){var __more;var __loop=__cb(_,__frame,0,0,function __$_qsort(){__more=false;var __6=nbeg<=nend;if(__6){return function ___(__break){var __more;var __loop=__cb(_,__frame,0,0,function __$_qsort(){__more=false;return function __$_qsort(_){return function __$_qsort(_){var __1=nbeg<end;if(!__1){return _(null,__1)}return compare(__cb(_,__frame,18,26,function ___(__0,__3){var __2=__3<0;return _(null,__2)},true),array[nbeg],o)}(__cb(_,__frame,-312,17,_,true))}(__cb(_,__frame,-312,17,function ___(__0,__7){if(__7){nbeg++;while(__more){__loop()}__more=true}else{__break()}},true))});do{__loop()}while(__more);__more=true}(function __$_qsort(){return function ___(__break){var __more;var __loop=__cb(_,__frame,0,0,function __$_qsort(){__more=false;return function __$_qsort(_){return function __$_qsort(_){var __2=beg<nend;if(!__2){return _(null,__2)}return compare(__cb(_,__frame,19,26,function ___(__0,__4){var __3=__4<0;return _(null,__3)},true),o,array[nend])}(__cb(_,__frame,-312,17,_,true))}(__cb(_,__frame,-312,17,function ___(__0,__9){if(__9){nend--;while(__more){__loop()}__more=true}else{__break()}},true))});do{__loop()}while(__more);__more=true}(function __$_qsort(){if(nbeg<=nend){tmp=array[nbeg];array[nbeg]=array[nend];array[nend]=tmp;nbeg++;nend--}while(__more){__loop()}__more=true})})}else{__break()}});do{__loop()}while(__more);__more=true}(function __$_qsort(){return function __$_qsort(__then){if(nbeg<end){return _qsort(__cb(_,__frame,30,20,__then,true),nbeg,end)}else{__then()}}(function __$_qsort(){return function __$_qsort(__then){if(beg<nend){return _qsort(__cb(_,__frame,31,20,__then,true),beg,nend)}else{__then()}}(_)})})})})}var __frame={name:"value__8",line:308};return __func(_,this,arguments,value__8,0,__frame,function __$value__8(){array=__this;beg=beg||0;end=end==null?array.length-1:end;return _qsort(__cb(_,__frame,38,3,function __$value__8(){return _(null,array)},true),beg,end)})}});delete Function.prototype.apply_;Object.defineProperty(Function.prototype,"apply_",{configurable:true,writable:true,enumerable:false,value:function(callback,thisObj,args,index){args=Array.prototype.slice.call(args,0);args.splice(index!=null&&index>=0?index:args.length,0,callback);return this.apply(thisObj,args)}})})(typeof exports!=="undefined"?exports:Streamline.builtins=Streamline.builtins||{});var MAP;"\n**********************************************************************\n\n  A RapydScript to JavaScript compiler.\n  https://github.com/atsepkov/RapydScript2\n\n  -------------------------------- (C) ---------------------------------\n\n                       Author: Alexander Tsepkov\n                         <atsepkov@pyjeon.com>\n                         http://www.pyjeon.com\n\n  Distributed under Apache 2.0 license:\n    Copyright 2013 (c) Alexander Tsepkov <atsepkov@pyjeon.com>\n\n  RapydScript source code is originally based on UglifyJS2 (covered\n  by BSD license). UglifyJS2 was written by Mihai Bazon\n  <mihai.bazon@gmail.com>, who is its respective copyright holder.\n\n    Redistribution and use in source and binary forms, with or without\n    modification, are permitted provided that the following conditions\n    are met:\n\n        * Redistributions of source code must retain the above\n          copyright notice, this list of conditions and the following\n          disclaimer.\n\n        * Redistributions in binary form must reproduce the above\n          copyright notice, this list of conditions and the following\n          disclaimer in the documentation and/or other materials\n          provided with the distribution.\n\n    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER “AS IS” AND ANY\n    EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n    IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n    PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER BE\n    LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,\n    OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n    PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n    PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR\n    TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF\n    THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF\n    SUCH DAMAGE.\n\n **********************************************************************\n";"use strict";function array_to_hash(a){var ret,i;ret=Object.create(null);for(i=0;i<len(a);i++){ret[a[i]]=true}return ret}function slice(a,start){return Array.prototype.slice.call(a,start||0)}function characters(str_){return str_.split("")}function member(name,array){var i;for(i=array.length-1;i>-1;i-=1){if(array[i]===name){return true}}return false}function find_if(func,array){var i;for(i=0;i<len(array);i++){if(func(array[i])){return array[i]}}}function repeat_string(str_,i){var d;if(i<=0){return""}if(i===1){return str_}d=repeat_string(str_,i>>1);d+=d;if(i&1){d+=str_}return d}function DefaultsError(msg,defs){this.msg=msg;this.defs=defs}function defaults(args,defs,croak){var ret,i;if(args===true){args={}}ret=args||{};if(croak){for(i in ret){if(ret.hasOwnProperty(i)&&!defs.hasOwnProperty(i)){throw new DefaultsError("`"+i+"` is not a supported option",defs)}}}for(i in defs){if(defs.hasOwnProperty(i)){ret[i]=args&&args.hasOwnProperty(i)?args[i]:defs[i]}}return ret}function merge(obj,ext){var i;for(i in ext){if(ext.hasOwnProperty(i)){obj[i]=ext[i]}}return obj}function noop(){}MAP=function(){var skip;function MAP(a,f,backwards){var ret,top,i;ret=[];top=[];function doit(){var is_last,val;val=f(a[i],i);is_last=val instanceof Last;if(is_last){val=val.v}if(val instanceof AtTop){val=val.v;if(val instanceof Splice){top.push.apply(top,backwards?val.v.slice().reverse():val.v)}else{top.push(val)}}else if(val!==skip){if(val instanceof Splice){ret.push.apply(ret,backwards?val.v.slice().reverse():val.v)}else{ret.push(val)}}return is_last}if(a instanceof Array){if(backwards){for(i=a.length-1;i>-1;i-=1){if(doit()){break}}ret.reverse();top.reverse()}else{for(i=0;i<len(a);i++){if(doit()){break}}}}else{for(i in a){if(a.hasOwnProperty(i)){if(doit()){break}}}}return top.concat(ret)}MAP.at_top=function(val){return new AtTop(val)};MAP.splice=function(val){return new Splice(val)};MAP.last=function(val){return new Last(val)};skip=MAP.skip={};function AtTop(val){this.v=val}function Splice(val){this.v=val}function Last(val){this.v=val}return MAP}.call(this);function push_uniq(array,el){if(array.indexOf(el)<0){array.push(el)}}function string_template(text,props){return text.replace(/\{(.+?)\}/g,function(str_,p){return props[p]})}function remove(array,el){var i;for(i=array.length-1;i>-1;i-=1){if(array[i]===el){array.splice(i,1)}}}function mergeSort(array,cmp){if(array.length<2){return array.slice()}function merge(a,b){var r,ai,bi,i;r=[];ai=0;bi=0;i=0;while(ai<a.length&&bi<b.length){if(cmp(a[ai],b[bi])<=0){r[i]=a[ai];ai+=1}else{r[i]=b[bi];bi+=1}i+=1}if(ai<a.length){r.push.apply(r,a.slice(ai))}if(bi<b.length){r.push.apply(r,b.slice(bi))}return r}function _ms(a){var m,left,right;if(a.length<=1){return a}m=Math.floor(a.length/2);left=a.slice(0,m);right=a.slice(m);left=_ms(left);right=_ms(right);return merge(left,right)}return _ms(array)}function set_difference(a,b){return a.filter(function(el){return b.indexOf(el)<0})}function set_intersection(a,b){return a.filter(function(el){return b.indexOf(el)>=0})}function makePredicate(words){var cats,skip,j,cat,i,f;if(!(words instanceof Array)){words=words.split(" ")}f="";cats=[];for(i=0;i<len(words);i++){skip=false;for(j=0;j<len(cats);j++){if(cats[j][0].length===words[i].length){cats[j].push(words[i]);skip=true;break}}if(!skip){cats.push([words[i]])}}function compareTo(arr){var i;if(arr.length===1){return f+="return str === "+JSON.stringify(arr[0])+";"}f+="switch(str){";for(i=0;i<len(arr);i++){f+="case "+JSON.stringify(arr[i])+":"}f+="return true}return false;"}if(cats.length>3){cats.sort(function(a,b){return b.length-a.length});f+="switch(str.length){";for(i=0;i<len(cats);i++){cat=cats[i];f+="case "+cat[0].length+":";compareTo(cat)}f+="}"}else{compareTo(words)}return new Function("str",f)}function Dictionary(){this._values=Object.create(null);this._size=0}Dictionary.prototype={set:function(key,val){if(!this.has(key)){this._size+=1}this._values["$"+key]=val;return this},add:function(key,val){if(this.has(key)){this.get(key).push(val)}else{this.set(key,[val])}return this},get:function(key){return this._values["$"+key]},del_:function(key){if(this.has(key)){this._size-=1;delete this._values["$"+key]}return this},has:function(key){return _$rapyd$_in("$"+key,this._values)},each:function(f){var i;for(i in this._values){f(this._values[i],i.substr(1))}},size:function(){return this._size},map:function(f){var ret,i;ret=[];for(i in this._values){ret.push(f(this._values[i],i.substr(1)))}return ret}};var AST_Token,AST_Node,AST_Statement,AST_Debugger,AST_Directive,AST_SimpleStatement,AST_Block,AST_BlockStatement,AST_EmptyStatement,AST_StatementWithBody,AST_LabeledStatement,AST_DWLoop,AST_Do,AST_While,AST_ForIn,AST_ListComprehension,AST_With,AST_Scope,AST_Toplevel,AST_Import,AST_Decorator,AST_Lambda,AST_Accessor,AST_Function,AST_Class,AST_Module,AST_Method,AST_Jump,AST_Exit,AST_Return,AST_Throw,AST_LoopControl,AST_Break,AST_Continue,AST_If,AST_Switch,AST_SwitchBranch,AST_Default,AST_Case,AST_Try,AST_Catch,AST_Except,AST_Finally,AST_Definitions,AST_Var,AST_Const,AST_VarDef,AST_BaseCall,AST_Call,AST_ClassCall,AST_New,AST_Seq,AST_PropAccess,AST_Dot,AST_Sub,AST_Unary,AST_UnaryPrefix,AST_UnaryPostfix,AST_Binary,AST_Conditional,AST_Assign,AST_Array,AST_TupleUnpack,AST_Object,AST_ObjectProperty,AST_ObjectKeyVal,AST_ObjectSetter,AST_ObjectGetter,AST_Symbol,AST_SymbolAccessor,AST_SymbolDeclaration,AST_SymbolVar,AST_SymbolConst,AST_SymbolFunarg,AST_SymbolDefun,AST_SymbolLambda,AST_SymbolCatch,AST_Label,AST_SymbolRef,AST_LabelRef,AST_This,AST_Constant,AST_String,AST_Verbatim,AST_Number,AST_RegExp,AST_Atom,AST_Null,AST_NaN,AST_Undefined,AST_Hole,AST_Infinity,AST_Boolean,AST_False,AST_True;"\n**********************************************************************\n\n  A RapydScript to JavaScript compiler.\n  https://github.com/atsepkov/RapydScript2\n\n  -------------------------------- (C) ---------------------------------\n\n                       Author: Alexander Tsepkov\n                         <atsepkov@pyjeon.com>\n                         http://www.pyjeon.com\n\n  Distributed under Apache 2.0 license:\n    Copyright 2013 (c) Alexander Tsepkov <atsepkov@pyjeon.com>\n\n  RapydScript source code is originally based on UglifyJS2 (covered\n  by BSD license). UglifyJS2 was written by Mihai Bazon\n  <mihai.bazon@gmail.com>, who is its respective copyright holder.\n\n    Redistribution and use in source and binary forms, with or without\n    modification, are permitted provided that the following conditions\n    are met:\n\n        * Redistributions of source code must retain the above\n          copyright notice, this list of conditions and the following\n          disclaimer.\n\n        * Redistributions in binary form must reproduce the above\n          copyright notice, this list of conditions and the following\n          disclaimer in the documentation and/or other materials\n          provided with the distribution.\n\n    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER “AS IS” AND ANY\n    EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n    IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n    PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER BE\n    LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,\n    OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n    PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n    PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR\n    TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF\n    THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF\n    SUCH DAMAGE.\n\n **********************************************************************\n";"use strict";function DEFNODE(type,props,methods,base){var self_props,proto,code,ctor,i;if(arguments.length<4){base=AST_Node}if(!props){props=[]}else{props=props.split(/\s+/)}self_props=props;if(base&&base.PROPS){props=props.concat(base.PROPS)}code="return function AST_"+type+"(props){ if (props) { ";for(i=props.length-1;i>-1;i-=1){code+="this."+props[i]+" = props."+props[i]+";"}proto=base&&new base;if(proto&&proto.initialize||methods&&methods.initialize){code+="this.initialize();"}code+="}}";ctor=new Function(code)();if(proto){ctor.prototype=proto;ctor.BASE=base}if(base){base.SUBCLASSES.push(ctor)}ctor.prototype.CTOR=ctor;ctor.PROPS=props||null;ctor.SELF_PROPS=self_props;ctor.SUBCLASSES=[];if(type){ctor.prototype.TYPE=ctor.TYPE=type}if(methods){for(i in methods){if(methods.hasOwnProperty(i)){if(/^\$/.test(i)){ctor[i.substr(1)]=methods[i]}else{ctor.prototype[i]=methods[i]}}}}ctor.DEFMETHOD=function(name,method){this.prototype[name]=method};return ctor}AST_Token=DEFNODE("Token","type value line col pos endpos nlb comments_before file",{},null);AST_Node=DEFNODE("Node","start end",{clone:function(){return new this.CTOR(this)},$documentation:"Base class of all AST nodes",$propdoc:{start:"[AST_Token] The first token of this node",end:"[AST_Token] The last token of this node"},_walk:function(visitor){return visitor._visit(this)},walk:function(visitor){return this._walk(visitor)}},null);AST_Node.warn_function=null;AST_Node.warn=function(txt,props){if(AST_Node.warn_function){AST_Node.warn_function(string_template(txt,props))}};AST_Statement=DEFNODE("Statement",null,{$documentation:"Base class of all statements"});AST_Debugger=DEFNODE("Debugger",null,{$documentation:"Represents a debugger statement"},AST_Statement);AST_Directive=DEFNODE("Directive","value scope",{$documentation:'Represents a directive, like "use strict";',$propdoc:{value:"[string] The value of this directive as a plain string (it's not an AST_String!)",scope:"[AST_Scope/S] The scope that this directive affects"}},AST_Statement);AST_SimpleStatement=DEFNODE("SimpleStatement","body",{$documentation:"A statement consisting of an expression, i.e. a = 1 + 2",$propdoc:{body:"[AST_Node] an expression node (should not be instanceof AST_Statement)"},_walk:function(visitor){return visitor._visit(this,function(){this.body._walk(visitor)})}},AST_Statement);function walk_body(node,visitor){if(node.body instanceof AST_Statement){node.body._walk(visitor)}else{node.body.forEach(function(stat){stat._walk(visitor)})}}AST_Block=DEFNODE("Block","body",{$documentation:"A body of statements (usually bracketed)",$propdoc:{body:"[AST_Statement*] an array of statements"},_walk:function(visitor){return visitor._visit(this,function(){walk_body(this,visitor)})}},AST_Statement);AST_BlockStatement=DEFNODE("BlockStatement",null,{$documentation:"A block statement"},AST_Block);AST_EmptyStatement=DEFNODE("EmptyStatement",null,{$documentation:"The empty statement (empty block or simply a semicolon)",_walk:function(visitor){return visitor._visit(this)}},AST_Statement);AST_StatementWithBody=DEFNODE("StatementWithBody","body",{$documentation:"Base class for all statements that contain one nested body: `For`, `ForIn`, `Do`, `While`, `With`",$propdoc:{body:"[AST_Statement] the body; this should always be present, even if it's an AST_EmptyStatement"},_walk:function(visitor){return visitor._visit(this,function(){this.body._walk(visitor)})}},AST_Statement);AST_LabeledStatement=DEFNODE("LabeledStatement","label",{$documentation:"Statement with a label",$propdoc:{label:"[AST_Label] a label definition"},_walk:function(visitor){return visitor._visit(this,function(){this.label._walk(visitor);this.body._walk(visitor)})}},AST_StatementWithBody);AST_DWLoop=DEFNODE("DWLoop","condition",{$documentation:"Base class for do/while statements",$propdoc:{condition:"[AST_Node] the loop condition.  Should not be instanceof AST_Statement"},_walk:function(visitor){return visitor._visit(this,function(){this.condition._walk(visitor);this.body._walk(visitor)})}},AST_StatementWithBody);AST_Do=DEFNODE("Do",null,{$documentation:"A `do` statement"},AST_DWLoop);AST_While=DEFNODE("While",null,{$documentation:"A `while` statement"},AST_DWLoop);AST_ForIn=DEFNODE("ForIn","init name object",{$documentation:"A `for ... in` statement",$propdoc:{init:"[AST_Node] the `for/in` initialization code",name:"[AST_SymbolRef?] the loop variable, only if `init` is AST_Var",object:"[AST_Node] the object that we're looping through"},_walk:function(visitor){return visitor._visit(this,function(){this.init._walk(visitor);this.object._walk(visitor);this.body._walk(visitor)})}},AST_StatementWithBody);AST_ListComprehension=DEFNODE("ListComprehension","condition statement",{$documentation:"A list comprehension expression",$propdoc:{condition:"[AST_Node] the `if` condition",statement:"[AST_Node] statement to perform on each element before returning it"}},AST_ForIn);AST_With=DEFNODE("With","expression",{$documentation:"A `with` statement",$propdoc:{expression:"[AST_Node] the `with` expression"},_walk:function(visitor){return visitor._visit(this,function(){this.expression._walk(visitor);
this.body._walk(visitor)})}},AST_StatementWithBody);AST_Scope=DEFNODE("Scope","directives variables localvars functions uses_with uses_eval parent_scope enclosed cname",{$documentation:"Base class for all statements introducing a lexical scope",$propdoc:{directives:"[string*/S] an array of directives declared in this scope",variables:"[Object/S] a map of name -> SymbolDef for all variables/functions defined in this scope",localvars:"[SymbolDef*] list of variables local to this scope",functions:"[Object/S] like `variables`, but only lists function declarations",uses_with:"[boolean/S] tells whether this scope uses the `with` statement",uses_eval:"[boolean/S] tells whether this scope contains a direct call to the global `eval`",parent_scope:"[AST_Scope?/S] link to the parent scope",enclosed:"[SymbolDef*/S] a list of all symbol definitions that are accessed from this scope or any subscopes",cname:"[integer/S] current index for mangling variables (used internally by the mangler)"}},AST_Block);AST_Toplevel=DEFNODE("Toplevel","globals baselib imports strict shebang",{$documentation:"The toplevel scope",$propdoc:{globals:"[Object/S] a map of name -> SymbolDef for all undeclared names",baselib:"[Object/s] a collection of used parts of baselib",imports:"[AST_Import*] a collection of all imported modules",strict:"[boolean/S] true if strict directive is in scope",shebang:"[string] If #! line is present, it will be stored here"},wrap_enclose:function(arg_parameter_pairs){var self,args,parameters,wrapped_tl;self=this;args=[];parameters=[];arg_parameter_pairs.forEach(function(pair){var split;split=pair.split(":");args.push(split[0]);parameters.push(split[1])});wrapped_tl="(function("+parameters.join(",")+"){ '$ORIG'; })("+args.join(",")+")";wrapped_tl=parse(wrapped_tl);wrapped_tl=wrapped_tl.transform(new TreeTransformer(function before(node){if(node instanceof AST_Directive&&node.value==="$ORIG"){return MAP.splice(self.body)}}));return wrapped_tl},wrap_commonjs:function(name,export_all){var self,to_export,wrapped_tl;self=this;to_export=[];if(export_all){self.figure_out_scope();self.walk(new TreeWalker(function(node){if(node instanceof AST_SymbolDeclaration&&node.definition().global){if(!find_if(function(n){return n.name===node.name},to_export)){to_export.push(node)}}}))}wrapped_tl="(function(exports, global){ global['"+name+"'] = exports; '$ORIG'; '$EXPORTS'; }({}, (function(){return this}())))";wrapped_tl=parse(wrapped_tl);wrapped_tl=wrapped_tl.transform(new TreeTransformer(function before(node){var tmp_,body;if(node instanceof AST_SimpleStatement){node=node.body;if(node instanceof AST_String){tmp_=node.getValue();if(tmp_==="$ORIG"){return MAP.splice(self.body)}else if(tmp_==="$EXPORTS"){body=[];to_export.forEach(function(sym){body.push(new AST_SimpleStatement({body:new AST_Assign({left:new AST_Sub({expression:new AST_SymbolRef({name:"exports"}),property:new AST_String({value:sym.name})}),operator:"=",right:new AST_SymbolRef(sym)})}))});return MAP.splice(body)}}}}));return wrapped_tl}},AST_Scope);AST_Import=DEFNODE("Import","module argnames variables body",{$documentation:"Container for imported files",$propdoc:{module:"[AST_SymbolVar] name of the module we're importing",argnames:"[AST_SymbolVar*] names of objects to be imported",variables:"[Object/S] a map of name -> SymbolDef for all variables/functions defined in this scope",body:"[AST_TopLevel] contents of the imported file"}},AST_Statement);AST_Decorator=DEFNODE("Decorator","name",{$documentation:"Class for function decorators",$propdoc:{name:"[string] decorator name"}});AST_Lambda=DEFNODE("Lambda","name argnames uses_arguments decorators",{$documentation:"Base class for functions",$propdoc:{name:"[AST_SymbolDeclaration?] the name of this function",argnames:"[AST_SymbolFunarg*] array of function arguments",uses_arguments:"[boolean/S] tells whether this function accesses the arguments array",decorators:"[AST_Decorator*] function decorators, if any"},_walk:function(visitor){return visitor._visit(this,function(){if(this.name){this.name._walk(visitor)}this.argnames.forEach(function(arg){arg._walk(visitor)});walk_body(this,visitor)})}},AST_Scope);AST_Accessor=DEFNODE("Accessor",null,{$documentation:"A setter/getter function"},AST_Lambda);AST_Function=DEFNODE("Function",null,{$documentation:"A function expression"},AST_Lambda);AST_Class=DEFNODE("Class","init name parent static external bound decorators modules",{$documentation:"A class declaration",$propdoc:{name:"[AST_SymbolDeclaration?] the name of this class",init:"[AST_Function] constructor for the class",parent:"[AST_Class?] parent class this class inherits from","static":"[string*] list of static methods",external:"[boolean] true if class is declared elsewhere, but will be within current scope at runtime",bound:"[string*] list of methods that need to be bound to behave correctly (function pointers)",decorators:"[AST_Decorator*] function decorators, if any",modules:"[string*] module stack that this class resides inside of, if any"},_walk:function(visitor){return visitor._visit(this,function(){this.name._walk(visitor);walk_body(this,visitor);this.parent._walk(visitor)})}},AST_Scope);AST_Module=DEFNODE("Module","name external decorators",{$documentation:"A module definition, meant to abstract a group of related classes and/or functions",$propdoc:{name:"[AST_SymbolDeclaration?] the name of this class",external:"[boolean] true if module is declared elsewhere, but will be within current scope at runtime",decorators:"[AST_Decorator*] module decorators, if any"}},AST_Scope);AST_Method=DEFNODE("Defun","static",{$documentation:"A class method definition",$propdoc:{"static":"[boolean] true if method is static"}},AST_Lambda);AST_Jump=DEFNODE("Jump",null,{$documentation:"Base class for “jumps” (for now that's `return`, `throw`, `break` and `continue`)"},AST_Statement);AST_Exit=DEFNODE("Exit","value",{$documentation:"Base class for “exits” (`return` and `throw`)",$propdoc:{value:"[AST_Node?] the value returned or thrown by this statement; could be null for AST_Return"},_walk:function(visitor){return visitor._visit(this,this.value&&function(){this.value._walk(visitor)})}},AST_Jump);AST_Return=DEFNODE("Return",null,{$documentation:"A `return` statement"},AST_Exit);AST_Throw=DEFNODE("Throw",null,{$documentation:"A `throw` statement"},AST_Exit);AST_LoopControl=DEFNODE("LoopControl","label",{$documentation:"Base class for loop control statements (`break` and `continue`)",$propdoc:{label:"[AST_LabelRef?] the label, or null if none"},_walk:function(visitor){return visitor._visit(this,this.label&&function(){this.label._walk(visitor)})}},AST_Jump);AST_Break=DEFNODE("Break",null,{$documentation:"A `break` statement"},AST_LoopControl);AST_Continue=DEFNODE("Continue",null,{$documentation:"A `continue` statement"},AST_LoopControl);AST_If=DEFNODE("If","condition alternative",{$documentation:"A `if` statement",$propdoc:{condition:"[AST_Node] the `if` condition",alternative:"[AST_Statement?] the `else` part, or null if not present"},_walk:function(visitor){return visitor._visit(this,function(){this.condition._walk(visitor);this.body._walk(visitor);if(this.alternative){this.alternative._walk(visitor)}})}},AST_StatementWithBody);AST_Switch=DEFNODE("Switch","expression",{$documentation:"A `switch` statement",$propdoc:{expression:"[AST_Node] the `switch` “discriminant”"},_walk:function(visitor){return visitor._visit(this,function(){this.expression._walk(visitor);walk_body(this,visitor)})}},AST_Block);AST_SwitchBranch=DEFNODE("SwitchBranch",null,{$documentation:"Base class for `switch` branches"},AST_Block);AST_Default=DEFNODE("Default",null,{$documentation:"A `default` switch branch"},AST_SwitchBranch);AST_Case=DEFNODE("Case","expression",{$documentation:"A `case` switch branch",$propdoc:{expression:"[AST_Node] the `case` expression"},_walk:function(visitor){return visitor._visit(this,function(){this.expression._walk(visitor);walk_body(this,visitor)})}},AST_SwitchBranch);AST_Try=DEFNODE("Try","bcatch bfinally",{$documentation:"A `try` statement",$propdoc:{bcatch:"[AST_Catch?] the catch block, or null if not present",bfinally:"[AST_Finally?] the finally block, or null if not present"},_walk:function(visitor){return visitor._visit(this,function(){walk_body(this,visitor);if(this.bcatch){this.bcatch._walk(visitor)}if(this.bfinally){this.bfinally._walk(visitor)}})}},AST_Block);AST_Catch=DEFNODE("Catch",null,{$documentation:"A `catch` node; only makes sense as part of a `try` statement",$propdoc:{},_walk:function(visitor){return visitor._visit(this,function(){this.argname._walk(visitor);walk_body(this,visitor)})}},AST_Block);AST_Except=DEFNODE("Except","argname errors",{$documentation:"An `except` node for RapydScript, which resides inside the catch block",$propdoc:{argname:"[AST_SymbolCatch] symbol for the exception",errors:"[AST_SymbolVar*] error classes to catch in this block"}},AST_Block);AST_Finally=DEFNODE("Finally",null,{$documentation:"A `finally` node; only makes sense as part of a `try` statement"},AST_Block);AST_Definitions=DEFNODE("Definitions","definitions",{$documentation:"Base class for `var` or `const` nodes (variable declarations/initializations)",$propdoc:{definitions:"[AST_VarDef*] array of variable definitions"},_walk:function(visitor){return visitor._visit(this,function(){this.definitions.forEach(function(def_){def_._walk(visitor)})})}},AST_Statement);AST_Var=DEFNODE("Var",null,{$documentation:"A `var` statement"},AST_Definitions);AST_Const=DEFNODE("Const",null,{$documentation:"A `const` statement"},AST_Definitions);AST_VarDef=DEFNODE("VarDef","name value",{$documentation:"A variable declaration; only appears in a AST_Definitions node",$propdoc:{name:"[AST_SymbolVar|AST_SymbolConst] name of the variable",value:"[AST_Node?] initializer, or null if there's no initializer"},_walk:function(visitor){return visitor._visit(this,function(){this.name._walk(visitor);if(this.value){this.value._walk(visitor)}})}});AST_BaseCall=DEFNODE("BaseCall","args",{$documentation:"A base class for function calls",$propdoc:{args:"[AST_Node*] array of arguments"}});AST_Call=DEFNODE("Call","expression",{$documentation:"A function call expression",$propdoc:{expression:"[AST_Node] expression to invoke as function"},_walk:function(visitor){return visitor._visit(this,function(){this.expression._walk(visitor);this.args.forEach(function(arg){arg._walk(visitor)})})}},AST_BaseCall);AST_ClassCall=DEFNODE("ClassCall","class method static",{$documentation:"A function call expression",$propdoc:{"class":"[string] name of the class method belongs to",method:"[string] class method being called","static":"[boolean] defines whether the method is static"},_walk:function(visitor){return visitor._visit(this,function(){this.expression._walk(visitor);this.args.forEach(function(arg){arg._walk(visitor)})})}},AST_BaseCall);AST_New=DEFNODE("New",null,{$documentation:"An object instantiation. Derives from a function call since it has exactly the same properties"},AST_Call);AST_Seq=DEFNODE("Seq","car cdr",{$documentation:"A sequence expression (two comma-separated expressions)",$propdoc:{car:"[AST_Node] first element in sequence",cdr:"[AST_Node] second element in sequence"},$cons:function(x,y){var seq;seq=new AST_Seq(x);seq.car=x;seq.cdr=y;return seq},$from_array:function(array){var list,i,p;if(array.length===0){return null}if(array.length===1){return array[0].clone()}list=null;for(i=array.length-1;i>-1;i-=1){list=AST_Seq.cons(array[i],list)}p=list;while(p){if(p.cdr&&!p.cdr.cdr){p.cdr=p.cdr.car;break}p=p.cdr}return list},to_array:function(){var a,p;p=this;a=[];while(p){a.push(p.car);if(p.cdr&&!(p.cdr instanceof AST_Seq)){a.push(p.cdr);break}p=p.cdr}return a},add:function(node){var cell,p;p=this;while(p){if(!(p.cdr instanceof AST_Seq)){cell=AST_Seq.cons(p.cdr,node);return p.cdr=cell}p=p.cdr}},_walk:function(visitor){return visitor._visit(this,function(){this.car._walk(visitor);if(this.cdr){this.cdr._walk(visitor)}})}});AST_PropAccess=DEFNODE("PropAccess","expression property",{$documentation:'Base class for property access expressions, i.e. `a.foo` or `a["foo"]`',$propdoc:{expression:"[AST_Node] the “container” expression",property:"[AST_Node|string] the property to access.  For AST_Dot this is always a plain string, while for AST_Sub it's an arbitrary AST_Node"}});AST_Dot=DEFNODE("Dot",null,{$documentation:"A dotted property access expression",_walk:function(visitor){return visitor._visit(this,function(){this.expression._walk(visitor)})}},AST_PropAccess);AST_Sub=DEFNODE("Sub",null,{$documentation:'Index-style property access, i.e. `a["foo"]`',_walk:function(visitor){return visitor._visit(this,function(){this.expression._walk(visitor);this.property._walk(visitor)})}},AST_PropAccess);AST_Unary=DEFNODE("Unary","operator expression",{$documentation:"Base class for unary expressions",$propdoc:{operator:"[string] the operator",expression:"[AST_Node] expression that this unary operator applies to"},_walk:function(visitor){return visitor._visit(this,function(){this.expression._walk(visitor)})}});AST_UnaryPrefix=DEFNODE("UnaryPrefix",null,{$documentation:"Unary prefix expression, i.e. `typeof i` or `++i`"},AST_Unary);AST_UnaryPostfix=DEFNODE("UnaryPostfix",null,{$documentation:"Unary postfix expression, i.e. `i++`"},AST_Unary);AST_Binary=DEFNODE("Binary","left operator right",{$documentation:"Binary expression, i.e. `a + b`",$propdoc:{left:"[AST_Node] left-hand side expression",operator:"[string] the operator",right:"[AST_Node] right-hand side expression"},_walk:function(visitor){return visitor._visit(this,function(){this.left._walk(visitor);this.right._walk(visitor)})}});AST_Conditional=DEFNODE("Conditional","condition consequent alternative",{$documentation:"Conditional expression using the ternary operator, i.e. `a ? b : c`",$propdoc:{condition:"[AST_Node]",consequent:"[AST_Node]",alternative:"[AST_Node]"},_walk:function(visitor){return visitor._visit(this,function(){this.condition._walk(visitor);this.consequent._walk(visitor);this.alternative._walk(visitor)})}});AST_Assign=DEFNODE("Assign",null,{$documentation:"An assignment expression — `a = b + 5`"},AST_Binary);AST_Array=DEFNODE("Array","elements",{$documentation:"An array literal",$propdoc:{elements:"[AST_Node*] array of elements"},_walk:function(visitor){return visitor._visit(this,function(){this.elements.forEach(function(el){el._walk(visitor)})})}});AST_TupleUnpack=DEFNODE("TupleUnpack","elements right",{$documentation:"An object used to represent tuple unpacking",$propdoc:{elements:"[AST_Node*] array of elements being assigned to",right:"[AST_Node] right-hand side expression"},_walk:function(visitor){return visitor._visit(this,function(){this.elements.forEach(function(el){el._walk(visitor)});this.right._walk(visitor)})}});AST_Object=DEFNODE("Object","properties",{$documentation:"An object literal",$propdoc:{properties:"[AST_ObjectProperty*] array of properties"},_walk:function(visitor){return visitor._visit(this,function(){this.properties.forEach(function(prop){prop._walk(visitor)})})}});AST_ObjectProperty=DEFNODE("ObjectProperty","key value quoted",{$documentation:"Base class for literal object properties",$propdoc:{key:"[string] the property name; it's always a plain string in our AST, no matter if it was a string, number or identifier in original code",value:"[AST_Node] property value.  For setters and getters this is an AST_Function.",quoted:"[true/false] keeps track whether the property was quoted in original code."},_walk:function(visitor){return visitor._visit(this,function(){this.value._walk(visitor)})}});AST_ObjectKeyVal=DEFNODE("ObjectKeyVal",null,{$documentation:"A key: value object property"},AST_ObjectProperty);AST_ObjectSetter=DEFNODE("ObjectSetter",null,{$documentation:"An object setter property"},AST_ObjectProperty);AST_ObjectGetter=DEFNODE("ObjectGetter",null,{$documentation:"An object getter property"},AST_ObjectProperty);AST_Symbol=DEFNODE("Symbol","scope name thedef",{$propdoc:{name:"[string] name of this symbol",scope:"[AST_Scope/S] the current scope (not necessarily the definition scope)",thedef:"[SymbolDef/S] the definition of this symbol"},$documentation:"Base class for all symbols"});AST_SymbolAccessor=DEFNODE("SymbolAccessor",null,{$documentation:"The name of a property accessor (setter/getter function)"},AST_Symbol);AST_SymbolDeclaration=DEFNODE("SymbolDeclaration","init",{$documentation:"A declaration symbol (symbol in var/const, function name or argument, symbol in catch)",$propdoc:{init:"[AST_Node*/S] array of initializers for this declaration."}},AST_Symbol);AST_SymbolVar=DEFNODE("SymbolVar",null,{$documentation:"Symbol defining a variable"},AST_SymbolDeclaration);AST_SymbolConst=DEFNODE("SymbolConst",null,{$documentation:"A constant declaration"},AST_SymbolDeclaration);AST_SymbolFunarg=DEFNODE("SymbolFunarg",null,{$documentation:"Symbol naming a function argument"},AST_SymbolVar);AST_SymbolDefun=DEFNODE("SymbolDefun",null,{$documentation:"Symbol defining a function"},AST_SymbolDeclaration);AST_SymbolLambda=DEFNODE("SymbolLambda",null,{$documentation:"Symbol naming a function expression"},AST_SymbolDeclaration);AST_SymbolCatch=DEFNODE("SymbolCatch",null,{$documentation:"Symbol naming the exception in catch"},AST_SymbolDeclaration);AST_Label=DEFNODE("Label","references",{$documentation:"Symbol naming a label (declaration)",$propdoc:{references:"[AST_LabelRef*] a list of nodes referring to this label"}},AST_Symbol);AST_SymbolRef=DEFNODE("SymbolRef",null,{$documentation:"Reference to some symbol (not definition/declaration)"},AST_Symbol);AST_LabelRef=DEFNODE("LabelRef",null,{$documentation:"Reference to a label symbol"},AST_Symbol);AST_This=DEFNODE("This",null,{$documentation:"The `this` symbol"},AST_Symbol);AST_Constant=DEFNODE("Constant",null,{$documentation:"Base class for all constants",getValue:function(){return this.value}});AST_String=DEFNODE("String","value",{$documentation:"A string literal",$propdoc:{value:"[string] the contents of this string"}},AST_Constant);AST_Verbatim=DEFNODE("Verbatim","value",{$documentation:"Raw JavaScript code",$propdoc:{value:"[string] A string of raw JS code"}},AST_Constant);AST_Number=DEFNODE("Number","value",{$documentation:"A number literal",$propdoc:{value:"[number] the numeric value"}},AST_Constant);AST_RegExp=DEFNODE("RegExp","value",{$documentation:"A regexp literal",$propdoc:{value:"[RegExp] the actual regexp"}},AST_Constant);AST_Atom=DEFNODE("Atom",null,{$documentation:"Base class for atoms"},AST_Constant);AST_Null=DEFNODE("Null",null,{$documentation:"The `null` atom",value:null},AST_Atom);AST_NaN=DEFNODE("NaN",null,{$documentation:"The impossible value",value:0/0},AST_Atom);AST_Undefined=DEFNODE("Undefined",null,{$documentation:"The `undefined` value",value:function(){}.call(this)},AST_Atom);AST_Hole=DEFNODE("Hole",null,{$documentation:"A hole in an array",value:function(){}.call(this)},AST_Atom);AST_Infinity=DEFNODE("Infinity",null,{$documentation:"The `Infinity` value",value:1/0},AST_Atom);AST_Boolean=DEFNODE("Boolean",null,{$documentation:"Base class for booleans"},AST_Atom);AST_False=DEFNODE("False",null,{$documentation:"The `false` atom",value:false},AST_Boolean);AST_True=DEFNODE("True",null,{$documentation:"The `true` atom",value:true},AST_Boolean);function TreeWalker(callback){this.visit=callback;this.stack=[]}TreeWalker.prototype={_visit:function(node,descend){var ret;this.stack.push(node);ret=this.visit(node,descend?function(){descend.call(node)}:noop);if(!ret&&descend){descend.call(node)}this.stack.pop();return ret},parent:function(n){return this.stack[this.stack.length-2-(n||0)]},push:function(node){this.stack.push(node)},pop:function(){return this.stack.pop()},self:function(){return this.stack[this.stack.length-1]},find_parent:function(type){var stack,x,i;stack=this.stack;for(i=stack.length-1;i>-1;i-=1){x=stack[i];if(x instanceof type){return x}}},in_boolean_context:function(){var stack,i,p,self;stack=this.stack;i=stack.length;self=stack[i-=1];while(i>0){p=stack[i-=1];if(p instanceof AST_If&&p.condition===self||p instanceof AST_Conditional&&p.condition===self||p instanceof AST_DWLoop&&p.condition===self||p instanceof AST_UnaryPrefix&&p.operator==="!"&&p.expression===self){return true}if(!(p instanceof AST_Binary&&(p.operator==="&&"||p.operator==="||"))){return false}self=p}},loopcontrol_target:function(label){var stack,x,i;stack=this.stack;if(label){for(i=stack.length-1;i>-1;i-=1){x=stack[i];if(x instanceof AST_LabeledStatement&&x.label.name===label.name){return x.body}}}else{for(i=stack.length-1;i>-1;i-=1){x=stack[i];if(x instanceof AST_Switch||x instanceof AST_ForIn||x instanceof AST_DWLoop){return x}}}}};"\n**********************************************************************\n\n  A RapydScript to JavaScript compiler.\n  https://github.com/atsepkov/RapydScript2\n\n  -------------------------------- (C) ---------------------------------\n\n                       Author: Alexander Tsepkov\n                         <atsepkov@pyjeon.com>\n                         http://www.pyjeon.com\n\n  Distributed under Apache 2.0 license:\n    Copyright 2013 (c) Alexander Tsepkov <atsepkov@pyjeon.com>\n\n  RapydScript source code is originally based on UglifyJS2 (covered\n  by BSD license). UglifyJS2 was written by Mihai Bazon\n  <mihai.bazon@gmail.com>, who is its respective copyright holder.\n\n    Redistribution and use in source and binary forms, with or without\n    modification, are permitted provided that the following conditions\n    are met:\n\n        * Redistributions of source code must retain the above\n          copyright notice, this list of conditions and the following\n          disclaimer.\n\n        * Redistributions in binary form must reproduce the above\n          copyright notice, this list of conditions and the following\n          disclaimer in the documentation and/or other materials\n          provided with the distribution.\n\n    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER “AS IS” AND ANY\n    EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n    IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n    PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER BE\n    LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,\n    OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n    PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n    PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR\n    TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF\n    THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF\n    SUCH DAMAGE.\n\n **********************************************************************\n";"use strict";function OutputStream(options){var indentation,current_col,current_line,current_pos,OUTPUT,IMPORTED,might_need_space,might_need_semicolon,last,requireSemicolonChars,space,indent,with_indent,newline,semicolon,add_mapping,stack;options=defaults(options,{indent_start:0,indent_level:4,quote_keys:false,space_colon:true,ascii_only:false,inline_script:false,width:80,max_line_len:32e3,ie_proof:true,beautify:false,source_map:null,bracketize:false,semicolons:true,comments:false,preserve_line:false,namespace_imports:false,omit_baselib:false,private_scope:true,screw_old_browsers:false,auto_bind:false},true);indentation=0;current_col=0;current_line=1;current_pos=0;OUTPUT="";IMPORTED={};function to_ascii(str_,identifier){return str_.replace(/[\u0080-\uffff]/g,function(ch){var code;code=ch.charCodeAt(0).toString(16);if(code.length<=2&&!identifier){while(code.length<2){code="0"+code}return"\\x"+code}else{while(code.length<4){code="0"+code}return"\\u"+code}})}function make_string(str_){var dq,sq;dq=0;sq=0;str_=str_.replace(/[\\\b\f\n\r\t\x22\x27\u2028\u2029\0]/g,function(s){var tmp_,dq,sq;tmp_=s;if(tmp_==="\\"){return"\\\\"}else if(tmp_==="\b"){return"\\b"}else if(tmp_==="\f"){return"\\f"}else if(tmp_==="\n"){return"\\n"}else if(tmp_==="	"){return"\\t"}else if(tmp_==="\r"){return"\\r"}else if(tmp_==="\u2028"){return"\\u2028"}else if(tmp_==="\u2029"){return"\\u2029"}else if(tmp_==='"'){dq+=1;return'"'}else if(tmp_==="'"){sq+=1;return"'"}else if(tmp_==="\x00"){return"\\0"}return s});if(options.ascii_only){str_=to_ascii(str_)}if(dq>sq){return"'"+str_.replace(/\x27/g,"\\'")+"'"}else{return'"'+str_.replace(/\x22/g,'\\"')+'"'}}function encode_string(str_){var ret;ret=make_string(str_);if(options.inline_script){ret=ret.replace(/<\x2fscript([>\/\t\n\f\r ])/gi,"<\\/script$1")}return ret}function make_name(name){name=name.toString();if(options.ascii_only){name=to_ascii(name,true)}return name}function make_indent(back){return repeat_string(" ",options.indent_start+indentation-back*options.indent_level)}might_need_space=false;might_need_semicolon=false;last=null;function last_char(){return last.charAt(last.length-1)}function maybe_newline(){if(options.max_line_len&&current_col>options.max_line_len){print_("\n")}}requireSemicolonChars=makePredicate("( [ + * / - , .");function print_(str_){var ch,target_line,prev,a,n;str_=String(str_);ch=str_.charAt(0);if(might_need_semicolon){if((!ch||";}".indexOf(ch)<0)&&!/[;]$/.test(last)){if(options.semicolons||requireSemicolonChars(ch)){OUTPUT+=";";current_col+=1;current_pos+=1}else{OUTPUT+="\n";current_pos+=1;current_line+=1;current_col=0}if(!options.beautify){might_need_space=false}}might_need_semicolon=false;maybe_newline()}if(!options.beautify&&options.preserve_line&&stack[stack.length-1]){target_line=stack[stack.length-1].start.line;while(current_line<target_line){OUTPUT+="\n";current_pos+=1;current_line+=1;current_col=0;might_need_space=false}}if(might_need_space){prev=last_char();if(is_identifier_char(prev)&&(is_identifier_char(ch)||ch==="\\")||/^[\+\-\/]$/.test(ch)&&ch===prev){OUTPUT+=" ";current_col+=1;current_pos+=1}might_need_space=false}a=str_.split(/\r?\n/);n=a.length-1;current_line+=n;if(n===0){current_col+=a[n].length}else{current_col=a[n].length}current_pos+=str_.length;last=str_;OUTPUT+=str_}space=options.beautify?function(){print_(" ")}:function(){might_need_space=true};indent=options.beautify?function(half){if(options.beautify){print_(make_indent(half?.5:0))}}:noop;with_indent=options.beautify?function(col,cont){var save_indentation,ret;if(col===true){col=next_indent()}save_indentation=indentation;indentation=col;ret=cont();indentation=save_indentation;return ret}:function(col,cont){return cont()};newline=options.beautify?function(){print_("\n")}:noop;semicolon=options.beautify?function(){print_(";")}:function(){might_need_semicolon=true};function force_semicolon(){might_need_semicolon=false;print_(";")}function next_indent(){return indentation+options.indent_level}function with_block(cont){var ret;ret=null;print_("{");newline();with_indent(next_indent(),function(){ret=cont()});indent();print_("}");return ret}function with_parens(cont){var ret;print_("(");ret=cont();print_(")");return ret}function with_square(cont){var ret;print_("[");ret=cont();print_("]");return ret}function comma(){print_(",");space()}function colon(){print_(":");if(options.space_colon){space()}}add_mapping=options.source_map?function(token,name){try{if(token){options.source_map.add(token.file||"?",current_line,current_col,token.line,token.col,!name&&token.type==="name"?token.value:name)}}catch(_$rapyd$_Exception){var ex=_$rapyd$_Exception;AST_Node.warn("Couldn't figure out mapping for {file}:{line},{col} → {cline},{ccol} [{name}]",{file:token.file,line:token.line,col:token.col,cline:current_line,ccol:current_col,name:name||""})}}:noop;function dump_baselib(key){var stmt_gen,line_gen,func_gen,lib;stmt_gen=function(item,i){if(i&&!item.call){space()}if(typeof item==="string"){print_(item)}else if(item.parens){with_parens(function(){item.parens.forEach(stmt_gen)})}else if(item.call){with_parens(function(){item.call.forEach(stmt_gen)})}else if(item.square){with_square(function(){item.square.forEach(stmt_gen)})}else if(item.block){with_block(function(){item.block.forEach(line_gen)})}else if(item.sequence){item.sequence.forEach(function(elem,i){if(i){comma()}print_(elem)})}};line_gen=function(item,i){indent();item.forEach(stmt_gen);if(!item.slice(-1)[0].block||item[0]==="="||item[0]==="return"){semicolon()}newline()};func_gen=function(name,data){indent();print_("function "+name);with_parens(function(){data.args.forEach(function(arg,i){if(i){comma()}print_(arg)})});space();with_block(function(){data.body.forEach(line_gen)});newline()};lib={abs:function(){return func_gen("abs",{args:["n"],body:[["return","Math.abs",{call:[{sequence:["n"]}]}]]})},bind:function(){return func_gen("_$rapyd$_bind",{args:["fn","thisArg"],body:[["if",{parens:["fn._orig"]},"fn","=","fn._orig"],["if",{parens:["thisArg","===","false"]},"return","fn"],["var","ret","=","fn.bind",{call:[{sequence:["thisArg"]}]}],["ret._orig","=","fn"],["return","ret"]]})},rebind_all:function(){return func_gen("_$rapyd$_rebindAll",{args:["thisArg","rebind"],body:[["if",{parens:["typeof","rebind","===",'"undefined"']},"rebind","=","true"],["for",{parens:["var","p","in","thisArg"]},{block:[["if",{parens:["thisArg[p]","&&","thisArg[p]._orig"]},{block:[["if",{parens:["rebind"]},"thisArg[p]","=","_$rapyd$_bind",{call:[{sequence:["thisArg[p]","thisArg"]}]}],["else","thisArg[p]","=","thisArg[p]._orig"]]}]]}]]})},dir:function(){return func_gen("dir",{args:["item"],body:[["var","arr","=","[]"],["for",{parens:["var","i","in","item"]},{block:[["arr.push",{call:["i"]}]]}],["return","arr"]]})},enumerate:function(){return func_gen("enumerate",{args:["item"],body:[["var","arr","=","[]"],["for",{parens:["var","i","=","0;","i","<","item.length;","i++"]},{block:[["arr[arr.length]","=",{square:[{sequence:["i","item[i]"]}]}]]}],["return","arr"]]})},"extends":function(){var body;if(options.screw_old_browsers){return func_gen("_$rapyd$_extends",{args:["child","parent"],body:[["child.prototype","=","Object.create",{call:["parent.prototype"]}],["child.prototype.constructor","=","child"]]})}else{body=[["child.prototype","=","new","parent"],["child.prototype.constructor","=","child"]];if(options.auto_bind){body.push(["_$rapyd$_rebindAll",{call:["child.prototype"]}])}return func_gen("_$rapyd$_extends",{args:["child","parent"],body:body})}},"in":function(){return func_gen("_$rapyd$_in",{args:["val","arr"],body:[["if",{parens:["arr","instanceof","Array","||","typeof","arr","===",'"string"']},"return","arr.indexOf(val)","!=","-1"],["else",{block:[["if",{parens:["arr.hasOwnProperty(val)"]},"return","true"],["return","false"]]}]]})},len:function(){return func_gen("len",{args:["obj"],body:[["if",{parens:["obj","instanceof","Array","||","typeof","obj","===",'"string"']},"return","obj.length"],["else",{block:[["var","count","=","0"],["for",{parens:["var","i","in","obj"]},{block:[["if",{parens:["obj.hasOwnProperty(i)"]},"count++"]]}],["return","count"]]}]]})},mixin:function(){return func_gen("_$rapyd$_mixin",{args:["target","source","overwrite"],body:[["for",{parens:["var","i","in","source"]},{block:[["if",{parens:["source.hasOwnProperty(i)","&&",{parens:["overwrite","||","typeof","target[i]","===",'"undefined"']}]},"target[i]","=","source[i]"]]}]]})},print:function(){return func_gen("_$rapyd$_print",{args:[],body:[["var",{sequence:["args","output"]}],["args","=","[].slice.call",{call:[{sequence:["arguments","0"]}]}],["output","=","JSON.stringify(args)"],["if",{parens:['"console"',"in","window"]},"console.log",{call:["output.substr",{call:[{sequence:["1","output.length-2"]}]}]}]]})},range:function(){return func_gen("range",{args:["start","stop","step"],body:[["if",{parens:["arguments.length","<=","1"]},{block:[["stop","=","start","||","0"],["start","=","0"]]}],["step","=","arguments[2]","||","1"],["var","length","=","Math.max",{parens:["Math.ceil",{parens:[{parens:["stop","-","start"]},"/","step"]},",","0"]}],["var","idx","=","0"],["var","range","=","new","Array(length)"],["while",{parens:["idx","<","length"]},{block:[["range[idx++]","=","start"],["start","+=","step"]]}],["return","range"]]})
},reversed:function(){return func_gen("reversed",{args:["arr"],body:[["var","tmp","=","[]"],["for",{parens:["var","i","=","arr.length","-","1;","i",">=","0;","i--"]},{block:[["tmp.push",{call:["arr[i]"]}]]}],["return","tmp"]]})},getattr:function(){return func_gen("getattr",{args:["obj","name"],body:[["return","obj[name]"]]})},setattr:function(){return func_gen("setattr",{args:["obj","name","value"],body:[["obj[name]","=","value"]]})},hasattr:function(){return func_gen("hasattr",{args:["obj","name"],body:[["return","name","in","obj"]]})}};lib[key]()}function prologue(module_){var lib;if(!options.omit_baselib){for(lib in module_.baselib){dump_baselib(lib)}}}function get(){return OUTPUT}function assign_var(name){if(typeof name==="string"){print_(name)}else{name.print(this)}space();print_("=");space()}stack=[];return{get:get,toString:get,indent:indent,indentation:function(){return indentation},current_width:function(){return current_col-indentation},should_break:function(){return options.width&&this.current_width()>=options.width},newline:newline,print:print_,space:space,comma:comma,colon:colon,last:function(){return last},semicolon:semicolon,force_semicolon:force_semicolon,to_ascii:to_ascii,print_name:function(name){print_(make_name(name))},print_string:function(str_){print_(encode_string(str_))},next_indent:next_indent,with_indent:with_indent,with_block:with_block,with_parens:with_parens,with_square:with_square,add_mapping:add_mapping,assign:assign_var,prologue:prologue,"import":function(module_){var key,should_import;key="";while(module_ instanceof AST_Dot){key="."+module_.property+key;module_=module_.expression}key=module_.name+key;should_import=!IMPORTED[key];IMPORTED[key]=true;return should_import},is_main:function(){return OUTPUT.length===0},option:function(opt){return options[opt]},line:function(){return current_line},col:function(){return current_col},pos:function(){return current_pos},push_node:function(node){stack.push(node)},pop_node:function(){return stack.pop()},stack:function(){return stack},parent:function(n){return stack[stack.length-2-(n||0)]}}}(function(){var SPECIAL_METHODS,INDEX_COUNTER;SPECIAL_METHODS={bind:"_$rapyd$_bind",rebind_all:"_$rapyd$_rebindAll",bool:"!!","float":"parseFloat","int":"parseInt",mixin:"_$rapyd$_mixin",print:"_$rapyd$_print"};INDEX_COUNTER=0;function DEFPRINT(nodetype,generator){nodetype.DEFMETHOD("_codegen",generator)}AST_Node.DEFMETHOD("print",function(stream,force_parens){var self,generator;self=this;generator=self._codegen;stream.push_node(self);if(force_parens||self.needs_parens(stream)){stream.with_parens(function(){self.add_comments(stream);self.add_source_map(stream);generator(self,stream)})}else{self.add_comments(stream);self.add_source_map(stream);generator(self,stream)}stream.pop_node()});AST_Node.DEFMETHOD("print_to_string",function(options){var s;s=OutputStream(options);this.print(s);return s.get()});AST_Node.DEFMETHOD("add_comments",function(output){var c,self,start,comments;c=output.option("comments");self=this;if(c){start=self.start;if(start&&!start._comments_dumped){start._comments_dumped=true;comments=start.comments_before;if(self instanceof AST_Exit&&self.value&&self.value.start.comments_before.length>0){comments=(comments||[]).concat(self.value.start.comments_before);self.value.start.comments_before=[]}if(c.test){comments=comments.filter(function(comment){return c.test(comment.value)})}else if(typeof c==="function"){comments=comments.filter(function(comment){return c(self,comment)})}comments.forEach(function(c){if(c.type==="comment1"){output.print("//"+c.value+"\n");output.indent()}else if(c.type==="comment2"){output.print("/*"+c.value+"*/");if(start.nlb){output.print("\n");output.indent()}else{output.space()}}})}}});function PARENS(nodetype,func){nodetype.DEFMETHOD("needs_parens",func)}PARENS(AST_Node,function(){return false});PARENS(AST_Function,function(output){return first_in_statement(output)});PARENS(AST_Object,function(output){return first_in_statement(output)});PARENS(AST_Unary,function(output){var p;p=output.parent();return p instanceof AST_PropAccess&&p.expression===this});PARENS(AST_Seq,function(output){var p;p=output.parent();return p instanceof AST_Unary||p instanceof AST_VarDef||p instanceof AST_Dot||p instanceof AST_ObjectProperty||p instanceof AST_Conditional});PARENS(AST_Binary,function(output){var p,po,pp,so,sp;p=output.parent();if(p instanceof AST_BaseCall&&p.expression===this){return true}if(p instanceof AST_Unary){return true}if(p instanceof AST_PropAccess&&p.expression===this){return true}if(p instanceof AST_Binary){po=p.operator;pp=PRECEDENCE[po];so=this.operator;sp=PRECEDENCE[so];if(pp>sp||pp===sp&&this===p.right&&!(so===po&&(so==="*"||so==="&&"||so==="||"))){return true}}});PARENS(AST_PropAccess,function(output){var p;p=output.parent();if(p instanceof AST_New&&p.expression===this){try{this.walk(new TreeWalker(function(node){if(node instanceof AST_BaseCall){throw p}}))}catch(_$rapyd$_Exception){var ex=_$rapyd$_Exception;if(ex!==p){throw ex}return true}}});PARENS(AST_BaseCall,function(output){var p;p=output.parent();return p instanceof AST_New&&p.expression===this});PARENS(AST_New,function(output){var p;p=output.parent();if(no_constructor_parens(this,output)&&(p instanceof AST_PropAccess||p instanceof AST_BaseCall&&p.expression===this)){return true}});PARENS(AST_Number,function(output){var p;p=output.parent();if(this.getValue()<0&&p instanceof AST_PropAccess&&p.expression===this){return true}});PARENS(AST_NaN,function(output){var p;p=output.parent();if(p instanceof AST_PropAccess&&p.expression===this){return true}});function assign_and_conditional_paren_rules(output){var p;p=output.parent();if(p instanceof AST_Unary){return true}if(p instanceof AST_Binary&&!(p instanceof AST_Assign)){return true}if(p instanceof AST_BaseCall&&p.expression===this){return true}if(p instanceof AST_Conditional&&p.condition===this){return true}if(p instanceof AST_PropAccess&&p.expression===this){return true}}PARENS(AST_Assign,assign_and_conditional_paren_rules);PARENS(AST_Conditional,assign_and_conditional_paren_rules);DEFPRINT(AST_Directive,function(self,output){output.print_string(self.value);output.semicolon()});DEFPRINT(AST_Debugger,function(self,output){output.print("debugger");output.semicolon()});function display_body(body,is_toplevel,output){var last;last=body.length-1;body.forEach(function(stmt,i){if(!(stmt instanceof AST_EmptyStatement)&&!(stmt instanceof AST_Definitions)){output.indent();stmt.print(output);if(!(i===last&&is_toplevel)){output.newline()}}})}function bind_methods(methods,output){var arg;for(arg in methods){output.indent();output.print("this.");output.assign(arg);output.print("_$rapyd$_bind");output.with_parens(function(){output.print("this.");output.print(arg);output.comma();output.print("this")});output.semicolon();output.newline()}}function display_complex_body(node,is_toplevel,output){var offset,arg;offset=0;if(node instanceof AST_Method&&!node.static){output.indent();output.print("var");output.space();output.assign(node.argnames[0]);output.print("this");output.semicolon();output.newline();offset+=1}if(node instanceof AST_Scope){if(node.argnames){if(node.argnames.starargs){node.argnames.forEach(function(arg,i){if(i>=offset){output.indent();output.print("var");output.space();output.assign(arg);output.print("arguments");output.with_square(function(){output.print(i-offset)});output.semicolon();output.newline()}});output.indent();output.print("var");output.space();output.assign(node.argnames.starargs);output.print("[].slice.call");output.with_parens(function(){output.print("arguments");output.comma();output.print(node.argnames.length-offset)});output.semicolon();output.newline()}for(arg in node.argnames.defaults){output.indent();output.print("if");output.space();output.with_parens(function(){output.print("typeof "+arg);output.space();output.print("===");output.space();output.print('"undefined"')});output.space();output.assign(arg);force_statement(node.argnames.defaults[arg],output);output.semicolon();output.newline()}}if(output.option("auto_bind")&&node.name&&node.name.name==="__init__"){output.indent();output.print("_$rapyd$_rebindAll");output.with_parens(function(){output.print("this");output.comma();output.print("true")});output.semicolon();output.newline();bind_methods(node.bound,output)}declare_vars(node.localvars,output)}else if(node instanceof AST_Except){if(node.argname){output.indent();output.print("var");output.space();output.assign(node.argname);output.print("_$rapyd$_Exception");output.semicolon();output.newline()}}display_body(node.body,is_toplevel,output)}function declare_vars(vars,output){if(vars.length){output.indent();output.print("var");output.space();vars.forEach(function(arg,i){if(i){output.comma()}arg.print(output)});output.semicolon();output.newline()}}function unpack_tuple(tuple,output,in_statement){tuple.elements.forEach(function(elem,i){output.indent();output.assign(elem);output.print("_$rapyd$_Unpack");output.with_square(function(){output.print(i)});if(!in_statement||i<tuple.elements.length-1){output.semicolon();output.newline()}})}AST_StatementWithBody.DEFMETHOD("_do_print_body",function(output){force_statement(this.body,output)});DEFPRINT(AST_Statement,function(self,output){self.body.print(output);output.semicolon()});DEFPRINT(AST_Toplevel,function(self,output){var is_main;is_main=output.is_main();if(is_main&&self.shebang){output.print(self.shebang);output.newline()}if(output.option("private_scope")&&is_main){output.with_parens(function(){output.print("function()");output.with_block(function(){output.prologue(self);display_complex_body(self,true,output);output.newline()})});output.print("();");output.print("")}else{if(is_main){output.prologue(self)}if(self.strict){declare_vars(self.localvars,output)}display_body(self.body,true,output)}});function print_module(self,variables,output){function print_var(name){if(typeof name==="string"){output.print(name)}else{name.print(output)}}output.with_parens(function(){output.print("function()");output.with_block(function(){display_complex_body(self,false,output);output.indent();output.print("return");output.space();output.with_block(function(){self.variables.forEach(function(arg,i){output.indent();print_var(arg);output.print(":");output.space();print_var(arg);if(i<self.variables.length-1){output.comma()}output.newline()})});output.semicolon();output.newline()})});output.print("()")}DEFPRINT(AST_Import,function(self,output){if(output.import(self.module)){if(!output.option("namespace_imports")){self.body.print(output)}else{output.print("var");output.space();output.assign(self.module);print_module(self.body,self.variables,output);output.semicolon();output.newline()}}if(output.option("namespace_imports")&&self.argnames){self.variables.forEach(function(arg){output.print("var");output.space();output.assign(arg);self.module.print(output);output.print(".");arg.print(output);output.semicolon();output.newline()})}});DEFPRINT(AST_LabeledStatement,function(self,output){self.label.print(output);output.colon();self.body.print(output)});DEFPRINT(AST_SimpleStatement,function(self,output){if(!(self.body instanceof AST_EmptyStatement)){self.body.print(output);output.semicolon()}});function print_bracketed(node,output,complex){if(node.body.length>0){output.with_block(function(){if(complex){display_complex_body(node,false,output)}else{display_body(node.body,false,output)}})}else{output.print("{}")}}DEFPRINT(AST_BlockStatement,function(self,output){print_bracketed(self,output)});DEFPRINT(AST_EmptyStatement,function(self,output){});DEFPRINT(AST_Do,function(self,output){output.print("do");output.space();self._do_print_body(output);output.space();output.print("while");output.space();output.with_parens(function(){self.condition.print(output)});output.semicolon()});DEFPRINT(AST_While,function(self,output){output.print("while");output.space();output.with_parens(function(){self.condition.print(output)});output.space();self._do_print_body(output)});function is_simple_for_in(self){if(self.object instanceof AST_BaseCall&&self.object.expression instanceof AST_SymbolRef&&self.object.expression.name==="dir"&&self.object.args.length===1){return true}return false}function is_simple_for(self){if(self.object instanceof AST_BaseCall&&self.object.expression instanceof AST_SymbolRef&&self.object.expression.name==="range"&&!(self.init instanceof AST_Array)&&(self.object.args.length<3||self.object.args.slice(-1)[0]instanceof AST_Number||self.object.args.slice(-1)[0]instanceof AST_Unary&&self.object.args.slice(-1)[0].operator==="-"&&self.object.args.slice(-1)[0].expression instanceof AST_Number)){return true}return false}AST_ForIn.DEFMETHOD("_do_print_body",function(output){var self;self=this;output.with_block(function(){if(!(is_simple_for(self)||is_simple_for_in(self))){output.indent();if(self.init instanceof AST_Array){output.assign("_$rapyd$_Unpack");output.print("_$rapyd$_Iter"+INDEX_COUNTER+"[_$rapyd$_Index"+INDEX_COUNTER+"];");output.newline();unpack_tuple(self.init,output)}else{output.assign(self.init);output.print("_$rapyd$_Iter"+INDEX_COUNTER+"[_$rapyd$_Index"+INDEX_COUNTER+"];");output.newline()}INDEX_COUNTER+=1}self.body.body.forEach(function(stmt,i){output.indent();stmt.print(output);output.newline()})})});DEFPRINT(AST_ForIn,function(self,output){var args,tmp_,start,end,increment;if(is_simple_for(self)){increment=null;args=self.object.args;tmp_=args.length;if(tmp_===1){start=0;end=args[0]}else if(tmp_===2){start=args[0];end=args[1]}else if(tmp_===3){start=args[0];end=args[1];increment=args[2]}output.print("for");output.space();output.with_parens(function(){output.assign(self.init);start.print?start.print(output):output.print(start);output.semicolon();output.space();self.init.print(output);output.space();increment instanceof AST_Unary?output.print(">"):output.print("<");output.space();end.print(output);output.semicolon();output.space();self.init.print(output);if(increment&&(!(increment instanceof AST_Unary)||increment.expression.value!=="1")){if(increment instanceof AST_Unary){output.print("-=");increment.expression.print(output)}else{output.print("+=");increment.print(output)}}else{if(increment instanceof AST_Unary){output.print("--")}else{output.print("++")}}})}else if(is_simple_for_in(self)){output.print("for");output.space();output.with_parens(function(){self.init.print(output);output.space();output.print("in");output.space();self.object.args[0].print(output)})}else{output.assign("var _$rapyd$_Iter"+INDEX_COUNTER);self.object.print(output);output.semicolon();output.newline();output.indent();output.print("for");output.space();output.with_parens(function(){output.print("var");output.space();output.assign("_$rapyd$_Index"+INDEX_COUNTER);output.print("0");output.semicolon();output.space();output.print("_$rapyd$_Index"+INDEX_COUNTER);output.space();output.print("<");output.space();output.print("_$rapyd$_Iter"+INDEX_COUNTER+".length");output.semicolon();output.space();output.print("_$rapyd$_Index"+INDEX_COUNTER+"++")})}output.space();self._do_print_body(output)});DEFPRINT(AST_ListComprehension,function(self,output){output.with_parens(function(){output.print("function");output.print("()");output.space();output.with_block(function(){output.indent();output.assign("var _$rapyd$_Iter");self.object.print(output);output.comma();output.assign("_$rapyd$_Result");output.print("[]");if(self.init instanceof AST_Array){self.init.elements.forEach(function(i){output.comma();i.print(output)})}else{output.comma();self.init.print(output)}output.semicolon();output.newline();output.indent();output.print("for");output.space();output.with_parens(function(){output.print("var");output.space();output.assign("_$rapyd$_Index");output.print("0");output.semicolon();output.space();output.print("_$rapyd$_Index");output.space();output.print("<");output.space();output.print("_$rapyd$_Iter.length");output.semicolon();output.space();output.print("_$rapyd$_Index++")});output.space();output.with_block(function(){var add_to_list;output.indent();if(self.init instanceof AST_Array){output.assign("_$rapyd$_Unpack");output.print("_$rapyd$_Iter[_$rapyd$_Index];");output.newline();unpack_tuple(self.init,output)}else{output.assign(self.init);output.print("_$rapyd$_Iter[_$rapyd$_Index];");output.newline()}add_to_list=function(){output.indent();output.print("_$rapyd$_Result.push");output.with_parens(function(){self.statement.print(output)});output.semicolon();output.newline()};if(self.condition){output.indent();output.print("if");output.space();output.with_parens(function(){self.condition.print(output)});output.space();output.with_block(function(){add_to_list()});output.newline()}else{add_to_list()}});output.newline();output.indent();output.print("return _$rapyd$_Result");output.semicolon();output.newline()})});output.print("()")});DEFPRINT(AST_With,function(self,output){output.print("with");output.space();output.with_parens(function(){self.expression.print(output)});output.space();self._do_print_body(output)});function decorate(node,output,internalsub){var wrap;wrap=function(d){if(d.length){output.print(d.slice(0)[0].name);output.with_parens(function(){wrap(d.slice(1))})}else{internalsub()}};wrap(node.decorators)}AST_Lambda.DEFMETHOD("_do_print",function(output,nokeyword){var self;self=this;function internalsub(){if(!nokeyword){output.print("function")}if(self.name){output.space();self.name.print(output)}output.with_parens(function(){if(!self.argnames.starargs){self.argnames.forEach(function(arg,i){if(i){output.comma()}arg.print(output)})}});output.space();print_bracketed(self,output,true)}if(self.decorators&&self.decorators.length){output.assign(self.name.name);decorate(self,output,internalsub);output.semicolon()}else{internalsub()}});DEFPRINT(AST_Lambda,function(self,output){self._do_print(output)});AST_Class.DEFMETHOD("_do_print",function(output){var self,class_def,define_method;self=this;if(self.external){return}class_def=function(method){output.indent();self.name.print(output);if(method&&self.static.indexOf(method)!==-1){output.assign("."+method)}else{output.assign(".prototype"+(method?"."+method:""))}};define_method=function(stmt){var name;name=stmt.name.name;class_def(name);function internalsub(){output.print("function");output.space();output.print(name);output.with_parens(function(){if(!stmt.argnames.starargs){stmt.argnames.forEach(function(arg,i){if(self.static.indexOf(name)!==-1){i+=1}if(i>1){output.comma()}if(i){arg.print(output)}})}});print_bracketed(stmt,output,true)}if(stmt.decorators&&stmt.decorators.length){decorate(stmt,output,internalsub)}else{internalsub()}output.semicolon();output.newline()};function internalsub(){if(self.init||self.parent){output.print("function");output.space();self.name.print(output);output.print("()");output.space();output.with_block(function(){bind_methods(self.bound,output);output.indent();if(self.init){output.print("this")}else{self.parent.print(output);output.print(".prototype")}output.print(".__init__.apply");output.with_parens(function(){output.print("this");output.comma();output.print("arguments")});output.semicolon();output.newline()})}else{output.print("function");output.space();self.name.print(output);output.print("()");output.space();output.with_block(function(){bind_methods(self.bound,output)})}}if(self.decorators&&self.decorators.length){output.print("var ");output.assign(self.name);decorate(self,output,internalsub);output.semicolon()}else{internalsub()}output.newline();if(self.parent){output.indent();output.print("_$rapyd$_extends");output.with_parens(function(){self.name.print(output);output.comma();self.parent.print(output)});output.semicolon();output.newline()}self.body.forEach(function(stmt,i){if(stmt instanceof AST_Method){define_method(stmt)}else if(stmt instanceof AST_Class){console.error("Nested classes aren't supported yet")}})});DEFPRINT(AST_Class,function(self,output){self._do_print(output)});AST_Module.DEFMETHOD("_do_print",function(output){var self;self=this;if(self.external){return}output.print("var");output.space();output.assign(self.name);function internalsub(){print_module(self,self.variables,output)}decorate(self,output,internalsub);output.semicolon();output.newline()});DEFPRINT(AST_Module,function(self,output){self._do_print(output)});AST_Exit.DEFMETHOD("_do_print",function(output,kind){var self;self=this;output.print(kind);if(self.value){output.space();self.value.print(output)}output.semicolon()});DEFPRINT(AST_Return,function(self,output){self._do_print(output,"return")});DEFPRINT(AST_Throw,function(self,output){self._do_print(output,"throw")});AST_LoopControl.DEFMETHOD("_do_print",function(output,kind){output.print(kind);if(this.label){output.space();this.label.print(output)}output.semicolon()});DEFPRINT(AST_Break,function(self,output){self._do_print(output,"break")});DEFPRINT(AST_Continue,function(self,output){self._do_print(output,"continue")});function make_then(self,output){var b;if(output.option("bracketize")){make_block(self.body,output);return}if(!self.body){return output.force_semicolon()}if(self.body instanceof AST_Do&&output.option("ie_proof")){make_block(self.body,output);return}b=self.body;while(true){if(b instanceof AST_If){if(!b.alternative){make_block(self.body,output);return}b=b.alternative}else if(b instanceof AST_StatementWithBody){b=b.body}else{break}}force_statement(self.body,output)}DEFPRINT(AST_If,function(self,output){output.print("if");output.space();output.with_parens(function(){self.condition.print(output)});output.space();if(self.alternative){make_then(self,output);output.space();output.print("else");output.space();force_statement(self.alternative,output)}else{self._do_print_body(output)}});DEFPRINT(AST_Switch,function(self,output){output.print("switch");output.space();output.with_parens(function(){self.expression.print(output)});output.space();if(self.body.length>0){output.with_block(function(){self.body.forEach(function(stmt,i){if(i){output.newline()}output.indent(true);stmt.print(output)})})}else{output.print("{}")}});AST_SwitchBranch.DEFMETHOD("_do_print_body",function(output){if(this.body.length>0){output.newline();this.body.forEach(function(stmt){output.indent();stmt.print(output);output.newline()})}});DEFPRINT(AST_Default,function(self,output){output.print("default:");self._do_print_body(output)});DEFPRINT(AST_Case,function(self,output){output.print("case");output.space();self.expression.print(output);output.print(":");self._do_print_body(output)});DEFPRINT(AST_Try,function(self,output){output.print("try");output.space();print_bracketed(self,output);if(self.bcatch){output.space();self.bcatch.print(output)}if(self.bfinally){output.space();self.bfinally.print(output)}});DEFPRINT(AST_Catch,function(self,output){output.print("catch");output.space();output.with_parens(function(){output.print("_$rapyd$_Exception")});output.space();if(self.body.length>1||self.body[0].errors.length){output.with_block(function(){var no_default;output.indent();no_default=true;self.body.forEach(function(exception,i){var no_default;if(i){output.print("else ")}if(exception.errors.length){output.print("if");output.space();output.with_parens(function(){exception.errors.forEach(function(err,i){if(i){output.newline();output.indent();output.print("||");output.space()}output.print("_$rapyd$_Exception");output.space();output.print("instanceof");output.space();err.print(output)})});output.space()}else{no_default=false}print_bracketed(exception,output,true);output.space()});if(no_default){output.print("else");output.space();output.with_block(function(){output.indent();output.print("throw");output.space();output.print("_$rapyd$_Exception");output.semicolon();output.newline()})}output.newline()})}else{print_bracketed(self.body[0],output,true)}});DEFPRINT(AST_Finally,function(self,output){output.print("finally");output.space();print_bracketed(self,output)});AST_Definitions.DEFMETHOD("_do_print",function(output,kind){var p,in_for,avoid_semicolon;output.print(kind);output.space();this.definitions.forEach(function(def_,i){if(i){output.comma()}def_.print(output)});p=output.parent();in_for=p instanceof AST_ForIn;avoid_semicolon=in_for&&p.init===this;if(!avoid_semicolon){output.semicolon()}});DEFPRINT(AST_Var,function(self,output){self._do_print(output,"var")});DEFPRINT(AST_Const,function(self,output){self._do_print(output,"const")});function parenthesize_for_noin(node,output,noin){if(!noin){node.print(output)}else{try{node.walk(new TreeWalker(function(node){if(node instanceof AST_Binary&&node.operator==="in"){throw output}}));node.print(output)}catch(_$rapyd$_Exception){var ex=_$rapyd$_Exception;if(ex!==output){throw ex}node.print(output,true)}}}DEFPRINT(AST_VarDef,function(self,output){var p,noin;self.name.print(output);if(self.value){output.assign("");p=output.parent(1);noin=p instanceof AST_ForIn;parenthesize_for_noin(self.value,output,noin)}});DEFPRINT(AST_BaseCall,function(self,output){var rename,output_kwargs,obj,last;if(self instanceof AST_ClassCall){if(self.static){self.class.print(output);output.print(".");output.print(self.method)}else{self.class.print(output);output.print(".prototype.");output.print(self.method);output.print(".call")}}else{rename=SPECIAL_METHODS.hasOwnProperty(self.expression.name)?SPECIAL_METHODS[self.expression.name]:undefined;if(rename){output.print(rename)}else{self.expression.print(output)}}if(self instanceof AST_New&&no_constructor_parens(self,output)){return}output_kwargs=function(){if(self.args.kwargs&&self.args.kwargs.length){if(self.args.length){output.comma()}output.print("{");self.args.kwargs.forEach(function(pair,i){if(i){output.comma()}pair[0].print(output);output.print(":");output.space();pair[1].print(output)});output.print("}")}};if(self.args.starargs){obj=self.expression.expression?self.expression.expression.name:"this";last=self.args.length-1;output.print(".apply");output.with_parens(function(){output.print(obj);output.comma();output.with_square(function(){self.args.forEach(function(expr,i){if(i!==last){if(i){output.comma()}expr.print(output)}});output_kwargs()});output.print(".concat");output.with_parens(function(){self.args[last].print(output)})})}else{output.with_parens(function(){self.args.forEach(function(expr,i){if(i){output.comma()}expr.print(output)});output_kwargs()})}});DEFPRINT(AST_New,function(self,output){output.print("new");output.space();AST_BaseCall.prototype._codegen(self,output)});AST_Seq.DEFMETHOD("_do_print",function(output){var self,p,print_seq;self=this;p=output.parent();print_seq=function(){self.car.print(output);if(self.cdr){output.comma();if(output.should_break()){output.newline();output.indent()}self.cdr.print(output)}};if(p instanceof AST_Binary||p instanceof AST_Return||p instanceof AST_Array||p instanceof AST_BaseCall||p instanceof AST_SimpleStatement){output.with_square(print_seq)}else{print_seq()}});DEFPRINT(AST_Seq,function(self,output){self._do_print(output)});DEFPRINT(AST_Dot,function(self,output){var expr;expr=self.expression;expr.print(output);if(expr instanceof AST_Number&&expr.getValue()>=0){if(!/[xa-f.]/i.test(output.last())){output.print(".")}}output.print(".");output.add_mapping(self.end);output.print_name(self.property)});DEFPRINT(AST_Sub,function(self,output){self.expression.print(output);output.print("[");if(self.property instanceof AST_Unary&&self.property.operator==="-"&&self.property.expression instanceof AST_Number){self.expression.print(output);output.print(".length")}self.property.print(output);output.print("]")});DEFPRINT(AST_UnaryPrefix,function(self,output){var op;op=self.operator;output.print(op);if(/^[a-z]/i.test(op)){output.space()}self.expression.print(output)});DEFPRINT(AST_UnaryPostfix,function(self,output){self.expression.print(output);output.print(self.operator)});DEFPRINT(AST_Binary,function(self,output){var comparators,function_ops,leftvar;comparators={"<":true,">":true,"<=":true,">=":true,"==":true,"!=":true};function_ops={"in":"_$rapyd$_in","**":"Math.pow"};if(_$rapyd$_in(self.operator,function_ops)){output.print(function_ops[self.operator]);output.with_parens(function(){self.left.print(output);output.comma();self.right.print(output)})}else if(comparators[self.operator]&&self.left instanceof AST_Binary&&comparators[self.left.operator]){if(self.left.right instanceof AST_Symbol){self.left.print(output);leftvar=self.left.right.name}else{self.left.left.print(output);output.space();output.print(self.left.operator);output.space();output.with_parens(function(){output.assign("_$rapyd$_Temp");self.left.right.print(output);leftvar="_$rapyd$_Temp"})}output.space();output.print("&&");output.space();output.print(leftvar);output.space();output.print(self.operator);output.space();self.right.print(output)}else{self.left.print(output);output.space();output.print(self.operator);output.space();self.right.print(output)}});DEFPRINT(AST_Assign,function(self,output){if(self.left instanceof AST_Array){output.print("_$rapyd$_Unpack")}else{self.left.print(output)}output.space();output.print(self.operator);output.space();self.right.print(output);if(self.left instanceof AST_Array){output.semicolon();output.newline();unpack_tuple(self.left,output,true)}});DEFPRINT(AST_Conditional,function(self,output){self.condition.print(output);output.space();output.print("?");output.space();self.consequent.print(output);output.space();output.colon();self.alternative.print(output)});DEFPRINT(AST_Array,function(self,output){output.with_square(function(){var a,len_;a=self.elements;len_=a.length;if(len_>0){output.space()}a.forEach(function(exp,i){if(i){output.comma()}exp.print(output)});if(len_>0){output.space()}})});DEFPRINT(AST_Object,function(self,output){if(self.properties.length>0){output.with_block(function(){self.properties.forEach(function(prop,i){if(i){output.print(",");output.newline()}output.indent();prop.print(output)});output.newline()})}else{output.print("{}")}});DEFPRINT(AST_ObjectKeyVal,function(self,output){var key;key=self.key;if(self.quoted){output.print_string(key+"")}else if((typeof key==="number"||!output.option("beautify")&&+key+""===key)&&parseFloat(key)>=0){output.print(make_num(key))}else if(!is_identifier(key)){output.print_string(key)}else{output.print_name(key)}output.colon();self.value.print(output)});DEFPRINT(AST_ObjectSetter,function(self,output){output.print("set");self.value._do_print(output,true)});DEFPRINT(AST_ObjectGetter,function(self,output){output.print("get");self.value._do_print(output,true)});AST_Symbol.DEFMETHOD("definition",function(){return this.thedef});DEFPRINT(AST_Symbol,function(self,output){var def_;def_=self.definition();output.print_name(def_?def_.mangled_name||def_.name:self.name)});DEFPRINT(AST_Undefined,function(self,output){output.print("void 0")});DEFPRINT(AST_Hole,noop);DEFPRINT(AST_Infinity,function(self,output){output.print("1/0")});DEFPRINT(AST_NaN,function(self,output){output.print("0/0")});DEFPRINT(AST_This,function(self,output){output.print("this")});DEFPRINT(AST_Constant,function(self,output){output.print(self.getValue())});DEFPRINT(AST_String,function(self,output){output.print_string(self.getValue())});DEFPRINT(AST_Verbatim,function(self,output){output.print(self.getValue())});DEFPRINT(AST_Number,function(self,output){output.print(make_num(self.getValue()))});DEFPRINT(AST_RegExp,function(self,output){var str_,p;str_=self.getValue().toString();if(output.option("ascii_only")){str_=output.to_ascii(str_)}output.print(str_);p=output.parent();if(p instanceof AST_Binary&&/^in/.test(p.operator)&&p.left===self){output.print(" ")}});function force_statement(stat,output){if(output.option("bracketize")){if(!stat||stat instanceof AST_EmptyStatement){output.print("{}")}else if(stat instanceof AST_BlockStatement){stat.print(output)}else{output.with_block(function(){output.indent();stat.print(output);output.newline()})}}else{if(!stat||stat instanceof AST_EmptyStatement){output.force_semicolon()}else{stat.print(output)}}}function first_in_statement(output){var a,i,node,p;a=output.stack();i=a.length;node=a[i-=1];p=a[i-=1];while(i>0){if(p instanceof AST_Statement&&p.body===node){return true
}if(p instanceof AST_Seq&&p.car===node||p instanceof AST_BaseCall&&p.expression===node||p instanceof AST_Dot&&p.expression===node||p instanceof AST_Sub&&p.expression===node||p instanceof AST_Conditional&&p.condition===node||p instanceof AST_Binary&&p.left===node||p instanceof AST_UnaryPostfix&&p.expression===node){node=p;p=a[i-=1]}else{return false}}}function no_constructor_parens(self,output){return self.args.length===0&&!output.option("beautify")}function best_of(a){var best,len_,i;best=a[0];len_=best.length;for(i=1;i<a.length;i++){if(a[i].length<len_){best=a[i];len_=best.length}}return best}function make_num(num){var str_,a,m;str_=num.toString(10);a=[str_.replace(/^0\./,".").replace("e+","e")];m=null;if(Math.floor(num)===num){if(num>=0){a.push("0x"+num.toString(16).toLowerCase(),"0"+num.toString(8))}else{a.push("-0x"+(-num).toString(16).toLowerCase(),"-0"+(-num).toString(8))}if(m=/^(.*?)(0+)$/.exec(num)){a.push(m[1]+"e"+m[2].length)}}else if(m=/^0?\.(0+)(.*)$/.exec(num)){a.push(m[2]+"e-"+(m[1].length+m[2].length),str_.substr(str_.indexOf(".")))}return best_of(a)}function make_block(stmt,output){if(stmt instanceof AST_BlockStatement){stmt.print(output);return}output.with_block(function(){output.indent();stmt.print(output);output.newline()})}function DEFMAP(nodetype,generator){nodetype.DEFMETHOD("add_source_map",function(stream){generator(this,stream)})}DEFMAP(AST_Node,noop);function basic_sourcemap_gen(self,output){output.add_mapping(self.start)}DEFMAP(AST_Directive,basic_sourcemap_gen);DEFMAP(AST_Debugger,basic_sourcemap_gen);DEFMAP(AST_Symbol,basic_sourcemap_gen);DEFMAP(AST_Jump,basic_sourcemap_gen);DEFMAP(AST_StatementWithBody,basic_sourcemap_gen);DEFMAP(AST_LabeledStatement,noop);DEFMAP(AST_Lambda,basic_sourcemap_gen);DEFMAP(AST_Switch,basic_sourcemap_gen);DEFMAP(AST_SwitchBranch,basic_sourcemap_gen);DEFMAP(AST_BlockStatement,basic_sourcemap_gen);DEFMAP(AST_Toplevel,noop);DEFMAP(AST_New,basic_sourcemap_gen);DEFMAP(AST_Try,basic_sourcemap_gen);DEFMAP(AST_Catch,basic_sourcemap_gen);DEFMAP(AST_Finally,basic_sourcemap_gen);DEFMAP(AST_Definitions,basic_sourcemap_gen);DEFMAP(AST_Constant,basic_sourcemap_gen);DEFMAP(AST_ObjectProperty,function(self,output){output.add_mapping(self.start,self.key)})})();var KEYWORDS,RESERVED_WORDS,KEYWORDS_BEFORE_EXPRESSION,KEYWORDS_ATOM,NATIVE_CLASSES,OPERATOR_CHARS,RE_HEX_NUMBER,RE_OCT_NUMBER,RE_DEC_NUMBER,OPERATORS,OP_MAP,WHITESPACE_CHARS,PUNC_BEFORE_EXPRESSION,PUNC_CHARS,REGEXP_MODIFIERS,UNICODE,IMPORTED,BASELIB,EX_EOF,UNARY_PREFIX,UNARY_POSTFIX,ASSIGNMENT,PRECEDENCE,STATEMENTS_WITH_LABELS,ATOMIC_START_TOKEN;"\n**********************************************************************\n\n  A RapydScript to JavaScript compiler.\n  https://github.com/atsepkov/RapydScript2\n\n  -------------------------------- (C) ---------------------------------\n\n                       Author: Alexander Tsepkov\n                         <atsepkov@pyjeon.com>\n                         http://www.pyjeon.com\n\n  Distributed under Apache 2.0 license:\n    Copyright 2013 (c) Alexander Tsepkov <atsepkov@pyjeon.com>\n\n  RapydScript source code is originally based on UglifyJS2 (covered\n  by BSD license). UglifyJS2 was written by Mihai Bazon\n  <mihai.bazon@gmail.com>, who is its respective copyright holder.\n\n    Redistribution and use in source and binary forms, with or without\n    modification, are permitted provided that the following conditions\n    are met:\n\n        * Redistributions of source code must retain the above\n          copyright notice, this list of conditions and the following\n          disclaimer.\n\n        * Redistributions in binary form must reproduce the above\n          copyright notice, this list of conditions and the following\n          disclaimer in the documentation and/or other materials\n          provided with the distribution.\n\n    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER “AS IS” AND ANY\n    EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n    IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n    PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER BE\n    LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,\n    OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n    PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n    PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR\n    TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF\n    THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF\n    SUCH DAMAGE.\n\n**********************************************************************\n";"use strict";KEYWORDS="as break case class const continue debugger default def del do elif else except finally for from if import in instanceof is module new nonlocal pass raise return switch til to try typeof var void while with or and not";KEYWORDS_ATOM="False None True";RESERVED_WORDS="abstract boolean byte char double enum export extends final float goto implements int interface long native package private protected public short static super synchronized this throws transient volatile"+" "+KEYWORDS_ATOM+" "+KEYWORDS;KEYWORDS_BEFORE_EXPRESSION="return new del raise elif else if";KEYWORDS=makePredicate(KEYWORDS);RESERVED_WORDS=makePredicate(RESERVED_WORDS);KEYWORDS_BEFORE_EXPRESSION=makePredicate(KEYWORDS_BEFORE_EXPRESSION);KEYWORDS_ATOM=makePredicate(KEYWORDS_ATOM);NATIVE_CLASSES={Image:{},RegExp:{},Error:{},Object:{"static":["getOwnPropertyNames","keys","create"]},String:{"static":["fromCharCode"]},Array:{"static":["isArray","from","of"]},Number:{"static":["isFinite","isNaN"]},Function:{},Date:{"static":["UTC","now","parse"]},Boolean:{},ArrayBuffer:{},DataView:{},Float32Array:{},Float64Array:{},Int16Array:{},Int32Array:{},Int8Array:{},Uint16Array:{},Uint32Array:{},Uint8Array:{},Uint8ClampedArray:{}};OPERATOR_CHARS=makePredicate(characters("+-*&%=<>!?|~^@"));RE_HEX_NUMBER=/^0x[0-9a-f]+$/i;RE_OCT_NUMBER=/^0[0-7]+$/;RE_DEC_NUMBER=/^\d*\.?\d*(?:e[+-]?\d*(?:\d\.?|\.?\d)\d*)?$/i;OPERATORS=makePredicate(["in","instanceof","typeof","new","void","del","++","--","+","-","not","~","&","|","^","**","*","/","%",">>","<<",">>>","<",">","<=",">=","==","===","is","!=","!==","?","=","+=","-=","/=","*=","%=",">>=","<<=",">>>=","|=","^=","&=","and","or","til","to","@"]);OP_MAP={or:"||",and:"&&",not:"!",del:"delete",None:"null",is:"===","==":"===","!=":"!=="};WHITESPACE_CHARS=makePredicate(characters("  \n\r	\f​᠎             　"));PUNC_BEFORE_EXPRESSION=makePredicate(characters("[{(,.;:"));PUNC_CHARS=makePredicate(characters("[]{}(),;:"));REGEXP_MODIFIERS=makePredicate(characters("gmsiy"));UNICODE={letter:new RegExp("[\\u0041-\\u005A\\u0061-\\u007A\\u00AA\\u00B5\\u00BA\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u0523\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0621-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971\\u0972\\u097B-\\u097F\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C33\\u0C35-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D28\\u0D2A-\\u0D39\\u0D3D\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC\\u0EDD\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8B\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10D0-\\u10FA\\u10FC\\u1100-\\u1159\\u115F-\\u11A2\\u11A8-\\u11F9\\u1200-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u1676\\u1681-\\u169A\\u16A0-\\u16EA\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u1900-\\u191C\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19A9\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u2094\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2183\\u2184\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2C6F\\u2C71-\\u2C7D\\u2C80-\\u2CE4\\u2D00-\\u2D25\\u2D30-\\u2D65\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005\\u3006\\u3031-\\u3035\\u303B\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31B7\\u31F0-\\u31FF\\u3400\\u4DB5\\u4E00\\u9FC3\\uA000-\\uA48C\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA65F\\uA662-\\uA66E\\uA67F-\\uA697\\uA717-\\uA71F\\uA722-\\uA788\\uA78B\\uA78C\\uA7FB-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA90A-\\uA925\\uA930-\\uA946\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAC00\\uD7A3\\uF900-\\uFA2D\\uFA30-\\uFA6A\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),non_spacing_mark:new RegExp("[\\u0300-\\u036F\\u0483-\\u0487\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u0610-\\u061A\\u064B-\\u065E\\u0670\\u06D6-\\u06DC\\u06DF-\\u06E4\\u06E7\\u06E8\\u06EA-\\u06ED\\u0711\\u0730-\\u074A\\u07A6-\\u07B0\\u07EB-\\u07F3\\u0816-\\u0819\\u081B-\\u0823\\u0825-\\u0827\\u0829-\\u082D\\u0900-\\u0902\\u093C\\u0941-\\u0948\\u094D\\u0951-\\u0955\\u0962\\u0963\\u0981\\u09BC\\u09C1-\\u09C4\\u09CD\\u09E2\\u09E3\\u0A01\\u0A02\\u0A3C\\u0A41\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A70\\u0A71\\u0A75\\u0A81\\u0A82\\u0ABC\\u0AC1-\\u0AC5\\u0AC7\\u0AC8\\u0ACD\\u0AE2\\u0AE3\\u0B01\\u0B3C\\u0B3F\\u0B41-\\u0B44\\u0B4D\\u0B56\\u0B62\\u0B63\\u0B82\\u0BC0\\u0BCD\\u0C3E-\\u0C40\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C62\\u0C63\\u0CBC\\u0CBF\\u0CC6\\u0CCC\\u0CCD\\u0CE2\\u0CE3\\u0D41-\\u0D44\\u0D4D\\u0D62\\u0D63\\u0DCA\\u0DD2-\\u0DD4\\u0DD6\\u0E31\\u0E34-\\u0E3A\\u0E47-\\u0E4E\\u0EB1\\u0EB4-\\u0EB9\\u0EBB\\u0EBC\\u0EC8-\\u0ECD\\u0F18\\u0F19\\u0F35\\u0F37\\u0F39\\u0F71-\\u0F7E\\u0F80-\\u0F84\\u0F86\\u0F87\\u0F90-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u102D-\\u1030\\u1032-\\u1037\\u1039\\u103A\\u103D\\u103E\\u1058\\u1059\\u105E-\\u1060\\u1071-\\u1074\\u1082\\u1085\\u1086\\u108D\\u109D\\u135F\\u1712-\\u1714\\u1732-\\u1734\\u1752\\u1753\\u1772\\u1773\\u17B7-\\u17BD\\u17C6\\u17C9-\\u17D3\\u17DD\\u180B-\\u180D\\u18A9\\u1920-\\u1922\\u1927\\u1928\\u1932\\u1939-\\u193B\\u1A17\\u1A18\\u1A56\\u1A58-\\u1A5E\\u1A60\\u1A62\\u1A65-\\u1A6C\\u1A73-\\u1A7C\\u1A7F\\u1B00-\\u1B03\\u1B34\\u1B36-\\u1B3A\\u1B3C\\u1B42\\u1B6B-\\u1B73\\u1B80\\u1B81\\u1BA2-\\u1BA5\\u1BA8\\u1BA9\\u1C2C-\\u1C33\\u1C36\\u1C37\\u1CD0-\\u1CD2\\u1CD4-\\u1CE0\\u1CE2-\\u1CE8\\u1CED\\u1DC0-\\u1DE6\\u1DFD-\\u1DFF\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2CEF-\\u2CF1\\u2DE0-\\u2DFF\\u302A-\\u302F\\u3099\\u309A\\uA66F\\uA67C\\uA67D\\uA6F0\\uA6F1\\uA802\\uA806\\uA80B\\uA825\\uA826\\uA8C4\\uA8E0-\\uA8F1\\uA926-\\uA92D\\uA947-\\uA951\\uA980-\\uA982\\uA9B3\\uA9B6-\\uA9B9\\uA9BC\\uAA29-\\uAA2E\\uAA31\\uAA32\\uAA35\\uAA36\\uAA43\\uAA4C\\uAAB0\\uAAB2-\\uAAB4\\uAAB7\\uAAB8\\uAABE\\uAABF\\uAAC1\\uABE5\\uABE8\\uABED\\uFB1E\\uFE00-\\uFE0F\\uFE20-\\uFE26]"),space_combining_mark:new RegExp("[\\u0903\\u093E-\\u0940\\u0949-\\u094C\\u094E\\u0982\\u0983\\u09BE-\\u09C0\\u09C7\\u09C8\\u09CB\\u09CC\\u09D7\\u0A03\\u0A3E-\\u0A40\\u0A83\\u0ABE-\\u0AC0\\u0AC9\\u0ACB\\u0ACC\\u0B02\\u0B03\\u0B3E\\u0B40\\u0B47\\u0B48\\u0B4B\\u0B4C\\u0B57\\u0BBE\\u0BBF\\u0BC1\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCC\\u0BD7\\u0C01-\\u0C03\\u0C41-\\u0C44\\u0C82\\u0C83\\u0CBE\\u0CC0-\\u0CC4\\u0CC7\\u0CC8\\u0CCA\\u0CCB\\u0CD5\\u0CD6\\u0D02\\u0D03\\u0D3E-\\u0D40\\u0D46-\\u0D48\\u0D4A-\\u0D4C\\u0D57\\u0D82\\u0D83\\u0DCF-\\u0DD1\\u0DD8-\\u0DDF\\u0DF2\\u0DF3\\u0F3E\\u0F3F\\u0F7F\\u102B\\u102C\\u1031\\u1038\\u103B\\u103C\\u1056\\u1057\\u1062-\\u1064\\u1067-\\u106D\\u1083\\u1084\\u1087-\\u108C\\u108F\\u109A-\\u109C\\u17B6\\u17BE-\\u17C5\\u17C7\\u17C8\\u1923-\\u1926\\u1929-\\u192B\\u1930\\u1931\\u1933-\\u1938\\u19B0-\\u19C0\\u19C8\\u19C9\\u1A19-\\u1A1B\\u1A55\\u1A57\\u1A61\\u1A63\\u1A64\\u1A6D-\\u1A72\\u1B04\\u1B35\\u1B3B\\u1B3D-\\u1B41\\u1B43\\u1B44\\u1B82\\u1BA1\\u1BA6\\u1BA7\\u1BAA\\u1C24-\\u1C2B\\u1C34\\u1C35\\u1CE1\\u1CF2\\uA823\\uA824\\uA827\\uA880\\uA881\\uA8B4-\\uA8C3\\uA952\\uA953\\uA983\\uA9B4\\uA9B5\\uA9BA\\uA9BB\\uA9BD-\\uA9C0\\uAA2F\\uAA30\\uAA33\\uAA34\\uAA4D\\uAA7B\\uABE3\\uABE4\\uABE6\\uABE7\\uABE9\\uABEA\\uABEC]"),connector_punctuation:new RegExp("[\\u005F\\u203F\\u2040\\u2054\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFF3F]")};IMPORTED={};BASELIB={};function is_letter(code){return code>=97&&code<=122||code>=65&&code<=90||code>=170&&UNICODE.letter.test(String.fromCharCode(code))}function is_digit(code){return code>=48&&code<=57}function is_alphanumeric_char(code){return is_digit(code)||is_letter(code)}function is_unicode_combining_mark(ch){return UNICODE.non_spacing_mark.test(ch)||UNICODE.space_combining_mark.test(ch)}function is_unicode_connector_punctuation(ch){return UNICODE.connector_punctuation.test(ch)}function is_identifier(name){return!RESERVED_WORDS(name)&&/^[a-z_$][a-z0-9_$]*$/i.test(name)}function is_identifier_start(code){return code===36||code===95||is_letter(code)}function is_identifier_char(ch){var code;code=ch.charCodeAt(0);return is_identifier_start(code)||is_digit(code)||code===8204||code===8205||is_unicode_combining_mark(ch)||is_unicode_connector_punctuation(ch)}function parse_js_number(num){if(RE_HEX_NUMBER.test(num)){return parseInt(num.substr(2),16)}else if(RE_OCT_NUMBER.test(num)){return parseInt(num.substr(1),8)}else if(RE_DEC_NUMBER.test(num)){return parseFloat(num)}}function JS_Parse_Error(message,line,col,pos){this.message=message;this.line=line;this.col=col;this.pos=pos;this.stack=(new Error).stack}JS_Parse_Error.prototype.toString=function(){return this.message+" (line: "+this.line+", col: "+this.col+", pos: "+this.pos+")"+"\n\n"+this.stack};function js_error(message,filename,line,col,pos){AST_Node.warn("ERROR: {message} [{file}:{line},{col}]",{message:message,file:filename,line:line,col:col});throw new JS_Parse_Error(message,line,col,pos)}function is_token(token,type,val){return token.type===type&&(val===null||val===undefined||token.value===val)}EX_EOF={};function tokenizer($TEXT,filename){var S,read_string,read_multiline_comment,read_regexp;S={text:$TEXT.replace(/\r\n?|[\n\u2028\u2029]/g,"\n").replace(/\uFEFF/g,""),filename:filename,pos:0,tokpos:0,line:1,tokline:0,col:0,tokcol:0,newline_before:false,regex_allowed:false,comments_before:[],whitespace_before:[],newblock:false,endblock:false,indentation_matters:[true],cached_whitespace:"",prev:undefined,index_or_slice:[false]};function peek(){return S.text.charAt(S.pos)}function prevChar(){return S.text.charAt(S.tokpos-1)}function next(signal_eof,in_string){var ch;ch=S.text.charAt(S.pos);S.pos+=1;if(signal_eof&&!ch){throw EX_EOF}if(ch==="\n"){S.newline_before=S.newline_before||!in_string;S.line+=1;S.col=0}else{S.col+=1}return ch}function find(what,signal_eof){var pos;pos=S.text.indexOf(what,S.pos);if(signal_eof&&pos===-1){throw EX_EOF}return pos}function start_token(){S.tokline=S.line;S.tokcol=S.col;S.tokpos=S.pos}function token(type,value,is_comment,keep_newline){var ret,i;S.regex_allowed=type==="operator"&&!UNARY_POSTFIX[value]||type==="keyword"&&KEYWORDS_BEFORE_EXPRESSION(value)||type==="punc"&&PUNC_BEFORE_EXPRESSION(value);if(type==="operator"&&value==="is"&&S.text.substr(S.pos).trimLeft().substr(0,4).trimRight()==="not"){next_token();value="!=="}if(type==="operator"&&OP_MAP[value]){value=OP_MAP[value]}ret={type:type,value:value,line:S.tokline,col:S.tokcol,pos:S.tokpos,endpos:S.pos,nlb:S.newline_before,file:filename};if(!is_comment){ret.comments_before=S.comments_before;S.comments_before=[];for(i=0;i<len(ret.comments_before);i++){ret.nlb=ret.nlb||ret.comments_before[i].nlb}}if(!keep_newline){S.newline_before=false}if(type==="punc"){if(value===":"&&!S.index_or_slice.slice(-1)[0]&&(!S.text.substring(S.pos+1,find("\n")).trim()||!S.text.substring(S.pos+1,find("#")).trim())){S.newblock=true;S.indentation_matters.push(true)}if(value==="["){if(S.prev&&S.prev.type==="name"){S.index_or_slice.push(true)}else{S.index_or_slice.push(false)}S.indentation_matters.push(false)}else if(value==="{"||value==="("){S.indentation_matters.push(false)}else if(value==="]"){S.index_or_slice.pop();S.indentation_matters.pop()}else if(value==="}"||value===")"){S.indentation_matters.pop()}}S.prev=new AST_Token(ret);return S.prev}function parse_whitespace(){var whitespace_exists,ch,leading_whitespace;leading_whitespace="";whitespace_exists=false;while(WHITESPACE_CHARS(peek())){whitespace_exists=true;ch=next();if(ch==="\n"){leading_whitespace=""}else{leading_whitespace+=ch}}if(peek()!=="#"){if(!whitespace_exists){leading_whitespace=S.cached_whitespace}else{S.cached_whitespace=leading_whitespace}if(S.newline_before||S.endblock){return test_indent_token(leading_whitespace)}}}function test_indent_token(leading_whitespace){var most_recent;most_recent=S.whitespace_before[S.whitespace_before.length-1]||"";S.endblock=false;if(S.indentation_matters.slice(-1)[0]&&leading_whitespace!==most_recent){if(S.newblock&&leading_whitespace&&leading_whitespace.indexOf(most_recent)===0){S.newblock=false;S.whitespace_before.push(leading_whitespace);return 1}else if(most_recent&&most_recent.indexOf(leading_whitespace)===0){S.endblock=true;S.whitespace_before.pop();return-1}else{parse_error("Inconsistent indentation")}}else{return 0}}function read_while(pred){var i,ret;ret="";i=0;while((ch=peek())&&pred(ch,i)){i+=1;ret+=next()}return ret}function parse_error(err){js_error(err,filename,S.tokline,S.tokcol,S.tokpos)}function read_num(prefix){var has_e,after_e,has_x,has_dot,num,valid;has_e=false;after_e=false;has_x=false;has_dot=prefix===".";num=read_while(function(ch,i){var code,tmp_;code=ch.charCodeAt(0);tmp_=code;if(tmp_===120||tmp_===88){return has_x?false:has_x=true}else if(tmp_===101||tmp_===69){return has_x?true:has_e?false:has_e=after_e=true}else if(tmp_===45){return after_e||i===0&&!prefix}else if(tmp_===43){return after_e}else if(tmp_===46){after_e=false;return!has_dot&&!has_x&&!has_e?has_dot=true:false}return is_alphanumeric_char(code)});if(prefix){num=prefix+num}valid=parse_js_number(num);if(!isNaN(valid)){return token("num",valid)}else{parse_error("Invalid syntax: "+num)}}function read_escaped_char(in_string,digester){var ch,tmp_;digester=digester||function(in_str){return next(true,in_str)};ch=digester(in_string);tmp_=ch.charCodeAt(0);if(tmp_===110){return"\n"}else if(tmp_===114){return"\r"}else if(tmp_===116){return"	"}else if(tmp_===98){return"\b"}else if(tmp_===118){return""}else if(tmp_===102){return"\f"}else if(tmp_===48){return"\x00"}else if(tmp_===120){return String.fromCharCode(hex_bytes(2,digester))}else if(tmp_===117){return String.fromCharCode(hex_bytes(4,digester))}else if(tmp_===10){return""}else{return ch}}function hex_bytes(n,digester){var digit,num,i;num=0;for(i=0;i<n;i++){digit=parseInt(digester(),16);if(isNaN(digit)){parse_error("Invalid hex-character pattern in string")}num=num<<4|digit}return num}read_string=with_eof_error("Unterminated string constant",function(){var quote,i,tmp,find_newlines,octal_len,first,ch,ret;quote=next();ret="";if(peek()===quote){next(true);if(peek()===quote){next(true);i=find(quote+quote+quote,true);if(i!==-1){tmp=S.text.substring(S.pos,i);S.pos=i+3;while(tmp.length){if(tmp[0]==="\\"){tmp=tmp.substr(1);ret+=read_escaped_char(true,function(){var ch;ch=tmp[0];tmp=tmp.substr(1);return ch})}else{ret+=tmp[0];tmp=tmp.substr(1)}}find_newlines=ret.match(/\n/g);if(find_newlines){S.line+=find_newlines.length}return token("string",ret)}}else{return token("string","")}}while(true){ch=next(true);if(ch==="\n"){parse_error("End of line while scanning string literal.")}if(ch==="\\"){octal_len=0;first=null;ch=read_while(function(ch){if(ch>="0"&&ch<="7"){if(!first){first=ch;return octal_len+=1}else if(first<="3"&&octal_len<=2){return octal_len+=1}else if(first>="4"&&octal_len<=1){return octal_len+=1}}return false});if(octal_len>0){ch=String.fromCharCode(parseInt(ch,8))}else if(peek()==="\n"){next(true);continue}else{ch=read_escaped_char(true)}}else if(ch===quote){break}ret+=ch}return token("string",ret)});function read_line_comment(shebang){if(typeof shebang==="undefined")shebang=false;var i,ret;if(!shebang){next()}i=find("\n");if(i===-1){ret=S.text.substr(S.pos);S.pos=S.text.length}else{ret=S.text.substring(S.pos,i);S.pos=i}return token(shebang?"shebang":"comment1",ret,true)}read_multiline_comment=with_eof_error("Unterminated multiline comment",function(){var i,text,a,n;next();i=find("*/",true);text=S.text.substring(S.pos,i);a=text.split("\n");n=a.length;S.pos=i+2;S.line+=n-1;if(n>1){S.col=a[n-1].length}else{S.col+=a[n-1].length}S.col+=2;S.newline_before=S.newline_before||text.indexOf("\n")>=0;return token("comment2",text,true)});function read_name(){var escaped,ch,backslash,hex,name;backslash=false;name="";escaped=false;while((ch=peek())!==null){if(!backslash){if(ch==="\\"){if(S.text.charAt(S.pos+1)==="\n"){S.pos+=2;continue}else{escaped=[backslash=true,next()]}}else if(is_identifier_char(ch)){name+=next()}else{break}}else{if(ch!=="u"){parse_error("Expecting UnicodeEscapeSequence -- uXXXX")}ch=read_escaped_char();if(!is_identifier_char(ch)){parse_error("Unicode char: "+ch.charCodeAt(0)+" is not valid in identifier")}name+=ch;backslash=false}}if(KEYWORDS(name)&&escaped){hex=name.charCodeAt(0).toString(16).toUpperCase();name="\\u"+"0000".substr(hex.length)+hex+name.slice(1)}return name}read_regexp=with_eof_error("Unterminated regular expression",function(regexp){var in_class,prev_backslash,mods;prev_backslash=false;in_class=false;while(ch=next(true)){if(prev_backslash){regexp+="\\"+ch;prev_backslash=false}else if(ch==="["){in_class=true;regexp+=ch}else if(ch==="]"&&in_class){in_class=false;regexp+=ch}else if(ch==="/"&&!in_class){break}else if(ch==="\\"){prev_backslash=true}else{regexp+=ch}}mods=read_name();return token("regexp",new RegExp(regexp,mods))});function read_operator(prefix){var op;function grow(op){var bigger;if(!peek()){return op}bigger=op+peek();if(OPERATORS(bigger)){next();return grow(bigger)}else{return op}}op=grow(prefix||next());if(_$rapyd$_in(op,["++","--","===","!=="])){parse_error("Invalid operator «"+op+"»")}return token("operator",op)}function handle_slash(){next();return S.regex_allowed?read_regexp(""):read_operator("/")}function handle_dot(){next();return is_digit(peek().charCodeAt(0))?read_num("."):token("punc",".")}function read_word(){var word;word=read_name();return KEYWORDS_ATOM(word)?token("atom",word):!KEYWORDS(word)?token("name",word):OPERATORS(word)&&prevChar()!=="."?token("operator",word):token("keyword",word)}function with_eof_error(eof_error,cont){return function(x){try{return cont(x)}catch(_$rapyd$_Exception){var ex=_$rapyd$_Exception;if(ex===EX_EOF){parse_error(eof_error)}else{throw _$rapyd$_Exception}}}}function next_token(force_regexp){var indent,ch,code,tmp_,regex_allowed;if(!_$rapyd$_in(force_regexp,[null,undefined])){return read_regexp(force_regexp)}indent=parse_whitespace();if(indent===-1){return token("punc","}",false,true)}start_token();ch=peek();if(!ch){return token("eof")}code=ch.charCodeAt(0);tmp_=code;if(tmp_===34||tmp_===39){return read_string()}else if(tmp_===35){if(S.pos===0&&S.text.charAt(1)==="!"){return read_line_comment(true)}regex_allowed=S.regex_allowed;S.comments_before.push(read_line_comment());S.regex_allowed=regex_allowed;return next_token()}else if(tmp_===46){return handle_dot()}else if(tmp_===47){return handle_slash()}if(is_digit(code)){return read_num()}if(PUNC_CHARS(ch)){return token("punc",next())}if(OPERATOR_CHARS(ch)){return read_operator()}if(code===92&&S.text.charAt(S.pos+1)==="\n"){next();next();S.newline_before=false;return next_token()}if(code===92||is_identifier_start(code)){return read_word()}parse_error("Unexpected character «"+ch+"»")}next_token.context=function(nc){if(nc){S=nc}return S};return next_token}UNARY_PREFIX=makePredicate(["typeof","void","delete","--","++","!","~","-","+","@"]);UNARY_POSTFIX=makePredicate(["--","++"]);ASSIGNMENT=makePredicate(["=","+=","-=","/=","*=","%=",">>=","<<=",">>>=","|=","^=","&="]);PRECEDENCE=function(a,ret){var b,j,i;for(i=0;i<a.length;i++){b=a[i];for(j=0;j<b.length;j++){ret[b[j]]=i+1}}return ret}.call(this,[["||"],["&&"],["|"],["^"],["&"],["==","===","!=","!=="],["<",">","<=",">=","in","instanceof"],[">>","<<",">>>"],["+","-"],["*","/","%"],["**"]],{});STATEMENTS_WITH_LABELS=array_to_hash(["for","do","while","switch"]);ATOMIC_START_TOKEN=array_to_hash(["atom","num","string","regexp","name"]);function parse($TEXT,options){var S,statement,import_,from_import_,ModuleTreeNode,module_,class_,function_,nonlocal_,const_,new_,expr_atom,array_,object_,subscripts,maybe_unary,expr_op,maybe_conditional,maybe_assign,expression;options=defaults(options,{strict:false,filename:null,auto_bind:false,toplevel:null});S={input:typeof $TEXT==="string"?tokenizer($TEXT,options.filename):$TEXT,token:null,prev:null,peeked:null,in_function:0,in_directives:true,in_loop:0,in_class:[false],classes:[{}],labels:[],decorators:[],module_tree:{},module_stack:[]};S.token=next();function is_(type,value){return is_token(S.token,type,value)}function peek(){return S.peeked||(S.peeked=S.input())}function next(){S.prev=S.token;if(S.peeked){S.token=S.peeked;S.peeked=null}else{S.token=S.input()}S.in_directives=S.in_directives&&(S.token.type==="string"||is_("punc",";"));return S.token}function prev(){return S.prev}function croak(msg,line,col,pos){var ctx;ctx=S.input.context();js_error(msg,ctx.filename,line!==undefined?line:ctx.tokline,col!==undefined?col:ctx.tokcol,pos!==undefined?pos:ctx.tokpos)}function token_error(token,msg){croak(msg,token.line,token.col)}function unexpected(token){if(token===undefined){token=S.token}token_error(token,"Unexpected token: "+token.type+" «"+token.value+"»")}function expect_token(type,val){if(is_(type,val)){return next()}token_error(S.token,"Unexpected token "+S.token.type+" «"+S.token.value+"»"+", expected "+type+" «"+val+"»")}function expect(punc){return expect_token("punc",punc)}function can_insert_semicolon(){return!options.strict&&(S.token.nlb||is_("eof")||is_("punc","}"))}function semicolon(){if(is_("punc",";")){next();S.token.nlb=true}}function parenthesised(){var exp;expect("(");exp=expression(true);expect(")");return exp}function embed_tokens(parser){return function(){var start,expr,end;start=S.token;expr=parser();end=prev();expr.start=start;expr.end=end;return expr}}function is_nested_comparison(stmt){var comparators;"\n        Check if the statement is a nested comparison\n        ";comparators={"<":true,">":true,"<=":true,">=":true,"==":true,"!=":true,"===":true,"!==":true};if(stmt instanceof AST_Binary&&_$rapyd$_in(stmt.operator,comparators)&&stmt.left instanceof AST_Binary&&_$rapyd$_in(stmt.left.operator,comparators)){return true}else{return false}}function scan_for_local_vars(body,is_module){var stmt,vars;"\n        Pick out all variables being assigned to from within this scope, we'll mark them as local\n\n        body        body to be scanned\n        is_module   if this body belongs to a module object and variables should be exposed\n        ";vars=[];if(body instanceof Array){for(stmt in body){if(body[stmt]instanceof AST_Scope){if(is_module&&body[stmt].name){vars.push(body[stmt].name)}continue}["body","alternative"].forEach(function(option){var opt;opt=body[stmt][option];if(opt){vars=vars.concat(scan_for_local_vars(opt,is_module))}if(opt instanceof AST_Assign&&!(opt.right instanceof AST_Scope)){vars=vars.concat(scan_for_local_vars(opt.right,is_module))}});if(!is_module){if(body[stmt]instanceof AST_ForIn){if(body[stmt].init instanceof AST_Array){vars.push("_$rapyd$_Unpack");body[stmt].init.elements.forEach(function(elem){if(vars.indexOf(elem.name)===-1){vars.push(elem.name)}})}else if(vars.indexOf(body[stmt].init.name)===-1){vars.push(body[stmt].init.name)}}else if(body[stmt]instanceof AST_DWLoop){vars=vars.concat(scan_for_local_vars(body[stmt],is_module))}else if(body[stmt]instanceof AST_If&&is_nested_comparison(body[stmt].condition)){vars.push("_$rapyd$_Temp")}else if(body[stmt]instanceof AST_Exit&&is_nested_comparison(body[stmt].value)){vars.push("_$rapyd$_Temp")}}}}else if(body.body){vars=vars.concat(scan_for_local_vars(body.body,is_module));if(body.alternative){vars=vars.concat(scan_for_local_vars(body.alternative,is_module))}}else if(body instanceof AST_Assign){if(body.left instanceof AST_Array){vars.push("_$rapyd$_Unpack");body.left.elements.forEach(function(elem){if(!(elem instanceof AST_PropAccess)&&vars.indexOf(elem.name)===-1){vars.push(elem.name)}})}else if(body.left.name&&vars.indexOf(body.left.name)===-1){vars.push(body.left.name)}if(is_nested_comparison(body.right)){vars.push("_$rapyd$_Temp")}else if(body.right instanceof AST_Conditional&&is_nested_comparison(body.right.condition)){vars.push("_$rapyd$_Temp")}}else if(body instanceof AST_Conditional&&is_nested_comparison(body.condition)){vars.push("_$rapyd$_Temp")}else if(is_nested_comparison(body)){vars.push("_$rapyd$_Temp")}return vars}function scan_for_nonlocal_defs(body){var stmt,vars;vars=[];if(body instanceof Array){for(stmt in body){if(body[stmt]instanceof AST_Scope){continue}if(body[stmt]instanceof AST_Definitions){body[stmt].definitions.forEach(function(vardef){vars.push(vardef.name.name)})}["body","alternative"].forEach(function(option){var opt;opt=body[stmt][option];if(opt){vars=vars.concat(scan_for_nonlocal_defs(opt))}})}}else if(body.body){vars=vars.concat(scan_for_nonlocal_defs(body.body));if(body.alternative){vars=vars.concat(scan_for_nonlocal_defs(body.alternative))}}return vars}function finalize_import(imp){var classes,c,key;classes=scan_for_classes(imp.body.body);for(c in classes){if(classes[c]instanceof ModuleTreeNode){S.module_tree[c]=classes[c]}else{S.classes[0][c]=classes[c]}}key="";while(imp instanceof AST_Dot){key="."+imp.property+key;
imp=imp.expression}key=imp.name+key;IMPORTED[key]=true;return imp}statement=embed_tokens(function(){var dir,stat,tmp_,start,func,chain,tmp;if(is_("operator","/")||is_("operator","/=")){S.peeked=null;S.token=S.input(S.token.value.substr(1))}tmp_=S.token.type;if(tmp_==="string"){dir=S.in_directives;stat=simple_statement();if(dir&&stat.body instanceof AST_String&&!is_("punc",",")){return new AST_Directive({value:stat.body.value})}return stat}else if(tmp_==="shebang"){tmp_=S.token.value;next();return new AST_Directive({value:tmp_})}else if(tmp_==="num"||tmp_==="regexp"||tmp_==="operator"||tmp_==="atom"){return simple_statement()}else if(tmp_==="punc"){tmp_=S.token.value;if(tmp_===":"){return new AST_BlockStatement({start:S.token,body:block_(),end:prev()})}else if(tmp_==="{"||tmp_==="["||tmp_==="("){return simple_statement()}else if(tmp_===";"){next();return new AST_EmptyStatement}else{unexpected()}}else if(tmp_==="name"){return is_token(peek(),"punc",":")?labeled_statement():simple_statement()}else if(tmp_==="keyword"){tmp_=S.token.value;next();if(tmp_==="break"){return break_cont(AST_Break)}else if(tmp_==="continue"){return break_cont(AST_Continue)}else if(tmp_==="debugger"){semicolon();return new AST_Debugger}else if(tmp_==="do"){return new AST_Do({body:in_loop(statement),condition:function(){var tmp;expect(".");expect_token("keyword","while");tmp=expression(true);semicolon();return tmp}.call(this)})}else if(tmp_==="while"){return new AST_While({condition:expression(true),body:in_loop(statement)})}else if(tmp_==="for"){return for_()}else if(tmp_==="from"){return finalize_import(from_import_())}else if(tmp_==="import"){return finalize_import(import_())}else if(tmp_==="class"){BASELIB["extends"]=true;if(options.auto_bind){BASELIB["rebind_all"]=true}return class_()}else if(tmp_==="module"){return module_()}else if(tmp_==="def"){start=prev();func=function_(S.in_class.slice(-1)[0]);func.start=start;func.end=prev();chain=subscripts(func,true);if(chain===func){return func}else{return new AST_SimpleStatement({start:start,body:chain,end:prev()})}}else if(tmp_==="if"){return if_()}else if(tmp_==="pass"){semicolon();return new AST_EmptyStatement}else if(tmp_==="return"){if(S.in_function===0){croak("'return' outside of function")}return new AST_Return({value:is_("punc",";")?function(){semicolon();return null}.call(this):can_insert_semicolon()?null:function(){var tmp;tmp=expression(true);semicolon();return tmp}.call(this)})}else if(tmp_==="switch"){return new AST_Switch({expression:parenthesised(),body:in_loop(switch_body_)})}else if(tmp_==="raise"){if(S.token.nlb){return new AST_Throw({value:new AST_SymbolCatch({name:"_$rapyd$_Exception"})})}tmp=expression(true);semicolon();return new AST_Throw({value:tmp})}else if(tmp_==="try"){return try_()}else if(tmp_==="nonlocal"){tmp=nonlocal_();semicolon();return tmp}else if(tmp_==="const"){tmp=const_();semicolon();return tmp}else if(tmp_==="with"){return new AST_With({expression:parenthesised(),body:statement()})}else{unexpected()}}});function labeled_statement(){var label,stat;label=as_symbol(AST_Label);if(find_if(function(l){return l.name===label.name},S.labels)){croak("Label "+label.name+" defined twice")}expect(":");S.labels.push(label);stat=statement();S.labels.pop();return new AST_LabeledStatement({body:stat,label:label})}function simple_statement(tmp){tmp=expression(true);semicolon();return new AST_SimpleStatement({body:tmp})}function break_cont(type){var label;label=null;if(!can_insert_semicolon()){label=as_symbol(AST_LabelRef,true)}if(label!==null){if(!find_if(function(l){return l.name===label.name},S.labels)){croak("Undefined label "+label.name)}}else if(S.in_loop===0){croak(type.TYPE+" not inside a loop or switch")}semicolon();return new type({label:label})}function for_(list_comp){var tmp,iter,init;init=null;if(!is_("punc",";")){init=expression(true,true);if(init instanceof AST_Seq){tmp=[];iter=init;while(iter&&iter.car){tmp.push(iter.car);iter=iter.cdr}tmp.push(iter);init=new AST_Array({start:init.start,elements:tmp,end:init.end})}if(is_("operator","in")){if(init instanceof AST_Var&&init.definitions.length>1){croak("Only one variable declaration allowed in for..in loop")}next();return for_in(init,list_comp)}}unexpected()}function for_in(init,list_comp){var lhs,obj;lhs=init instanceof AST_Var?init.definitions[0].name:null;obj=expression(true);if(list_comp){return{init:init,name:lhs,object:obj}}return new AST_ForIn({init:init,name:lhs,object:obj,body:in_loop(statement)})}function scan_for_classes(body){var classes,stmt,i;classes=new ModuleTreeNode;for(i in body){stmt=body[i];if(stmt instanceof AST_Class){classes[stmt.name.name]={"static":stmt.static,bound:stmt.bound}}else if(stmt instanceof AST_Module){classes[stmt.name.name]=scan_for_classes(stmt.body)}}return classes}function get_class_in_scope(expr){var s,referenced_path,current_scope,traversed_path,visible_scope;if(expr instanceof AST_SymbolRef){if(NATIVE_CLASSES.hasOwnProperty(expr.name)){return NATIVE_CLASSES[expr.name]}for(s=S.classes.length-1;s>-1;s-=1){if(S.classes[s].hasOwnProperty(expr.name)){return S.classes[s][expr.name]}}}else if(expr instanceof AST_Dot){referenced_path=[];while(expr instanceof AST_Dot){referenced_path.unshift(expr.property);expr=expr.expression}if(expr instanceof AST_SymbolRef){referenced_path.unshift(expr.name);current_scope=S.module_stack.slice();current_scope.unshift("");while(current_scope.length){visible_scope=S.module_tree;current_scope.forEach(function(module__){if(_$rapyd$_in(module__,visible_scope)){visible_scope=visible_scope[module__]}});traversed_path=referenced_path.slice();while(traversed_path&&visible_scope[traversed_path[0]]){visible_scope=visible_scope[traversed_path[0]];traversed_path.shift()}if(!traversed_path.length){if(!(visible_scope instanceof ModuleTreeNode)){return visible_scope}else{return false}}current_scope.pop()}}}return false}import_=function(){var name,tmp,file,contents;tmp=name=expression(false);file=".pyj";while(tmp instanceof AST_Dot){file="/"+tmp.property+file;tmp=tmp.expression}file=tmp.name+file;contents=null;var fcontents=import_read_file(file);contents=parse(fcontents,{filename:file,toplevel:contents});return new AST_Import({module:name,argnames:null,body:contents,variables:function(){return scan_for_local_vars(contents,true).filter(function(element,index,arr){return arr.lastIndexOf(element)===index})}.call(this)})};from_import_=function(){var name,file,contents;name=expression(false);file=".pyj";while(name instanceof AST_Dot){file="/"+name.property+file;name=name.expression}file=name.name+file;expect_token("keyword","import");contents=null;try{contents=parse(options.readfile(options.basedir+"/"+file,"utf-8"),{filename:file,toplevel:contents,readfile:options.readfile,basedir:options.basedir,libdir:options.libdir})}catch(_$rapyd$_Exception){contents=parse(options.readfile(options.libdir+"/"+file,"utf-8"),{filename:file,toplevel:contents,readfile:options.readfile,basedir:options.libdir,libdir:options.libdir})}return new AST_Import({module:name,argnames:function(a){a.push(as_symbol(AST_SymbolVar));while(is_("punc",",")){next();a.push(as_symbol(AST_SymbolVar))}return a}.call(this,[]),body:contents})};ModuleTreeNode=function(){};module_=function(use_name){var name,externaldecorator,definition;name=use_name?use_name:as_symbol(AST_SymbolDefun);if(!name){unexpected()}externaldecorator=S.decorators.indexOf("external");if(externaldecorator!==-1){S.decorators.splice(externaldecorator,1)}definition=new AST_Module({name:name,body:function(){var module_tree,a;module_tree=S.module_tree;S.module_stack.forEach(function(module__){module_tree=module_tree[module__]});module_tree[name.name]=new ModuleTreeNode;S.module_stack.push(name.name);a=block_();S.module_stack.pop();return a}.call(this),external:externaldecorator!==-1,decorators:function(){var d;d=[];S.decorators.forEach(function(decorator){d.push(new AST_Decorator({name:decorator}))});S.decorators=[];return d}.call(this),variables:[],localvars:[]});definition.variables=scan_for_local_vars(definition.body,true).filter(function(element,index,arr){return arr.lastIndexOf(element)===index});definition.localvars=scan_for_local_vars(definition.body,false).filter(function(element,index,arr){return arr.lastIndexOf(element)===index}).map(function(element){return new_symbol(AST_SymbolVar,element)});return definition};class_=function(){var name,externaldecorator,class_details,definition,stmt,i;name=as_symbol(AST_SymbolDefun);if(!name){unexpected()}externaldecorator=S.decorators.indexOf("external");if(externaldecorator!==-1){S.decorators.splice(externaldecorator,1)}class_details={"static":[],bound:{}};definition=new AST_Class({name:name,parent:function(){var a;if(is_("punc","(")){next();a=expr_atom(false);expect(")");return a}else{return null}}.call(this),modules:S.module_stack.slice(),localvars:[],"static":class_details.static,external:externaldecorator!==-1,bound:class_details.bound,decorators:function(){var d;d=[];S.decorators.forEach(function(decorator){d.push(new AST_Decorator({name:decorator}))});S.decorators=[];return d}.call(this),body:function(loop,labels){var module_tree,a;module_tree=S.module_tree;S.module_stack.forEach(function(module__){module_tree=module_tree[module__]});module_tree[name.name]=class_details;S.in_class.push(name.name);S.classes[S.classes.length-1][name.name]=class_details;S.classes.push({});S.in_function+=1;S.in_directives=true;S.in_loop=0;S.labels=[];a=block_();S.in_function-=1;S.classes.pop();S.in_class.pop();S.in_loop=loop;S.labels=labels;return a}.call(this,S.in_loop,S.labels)});for(i in definition.body){stmt=definition.body[i];if(stmt instanceof AST_Method&&stmt.name.name==="__init__"){definition.init=stmt;break}}return definition};function_=function(in_class,ctor){var is_accessor,name,staticloc,staticmethod,definition,assignments,j,i,nonlocals;is_accessor=ctor===AST_Accessor;name=is_("name")?as_symbol(in_class?AST_SymbolDefun:is_accessor?AST_SymbolAccessor:AST_SymbolLambda):is_accessor&&(is_("string")||is_("num"))?as_atom_node():null;if(in_class&&!name){unexpected()}staticmethod=false;if(in_class){staticloc=S.decorators.indexOf("staticmethod");if(staticloc!==-1){S.decorators.splice(staticloc,1);S.classes[S.classes.length-2][in_class].static.push(name.name);staticmethod=true}else if(name.name!=="__init__"&&options.auto_bind){BASELIB["bind"]=true;S.classes[S.classes.length-2][in_class].bound[name.name]=true}}expect("(");if(!ctor){ctor=in_class?AST_Method:AST_Function}definition=new ctor({name:name,argnames:function(a){var defaults,first,val;defaults={};first=true;while(!is_("punc",")")){if(first){first=false}else{expect(",")}if(a.starargs){token_error(prev(),"Can't define multiple *args in function definition")}else if(is_("operator","*")){next();a.starargs=as_symbol(AST_SymbolFunarg)}else{a.push(as_symbol(AST_SymbolFunarg));if(is_("operator","=")){val=prev().value;next();defaults[val]=expression(false)}}}next();a.defaults=defaults;return a}.call(this,[]),localvars:[],decorators:function(){var d;d=[];S.decorators.forEach(function(decorator){d.push(new AST_Decorator({name:decorator}))});S.decorators=[];return d}.call(this),body:function(loop,labels){var a;S.in_class.push(false);S.classes.push({});S.in_function+=1;S.in_directives=true;S.in_loop=0;S.labels=[];a=block_();S.in_function-=1;S.classes.pop();S.in_class.pop();S.in_loop=loop;S.labels=labels;return a}.call(this,S.in_loop,S.labels)});if(definition instanceof AST_Method){definition.static=staticmethod}assignments=scan_for_local_vars(definition.body,false).filter(function(element,index,arr){return arr.lastIndexOf(element)===index});for(i=0;i<assignments.length;i++){for(j=0;j<definition.argnames.length+1;j++){if(j===definition.argnames.length){definition.localvars.push(new_symbol(AST_SymbolVar,assignments[i]))}else if(j<definition.argnames.length&&assignments[i]===definition.argnames[j].name){break}}}nonlocals=scan_for_nonlocal_defs(definition.body);nonlocals.forEach(function(variable){var i;var _$rapyd$_Iter0=dir(definition.localvars).reverse();for(var _$rapyd$_Index0=0;_$rapyd$_Index0<_$rapyd$_Iter0.length;_$rapyd$_Index0++){i=_$rapyd$_Iter0[_$rapyd$_Index0];if(definition.localvars[i].name===variable){definition.localvars.splice(i,1)}}});return definition};function if_(){var cond,body,belse;cond=expression(true);body=statement();belse=null;if(is_("keyword","elif")||is_("keyword","else")){if(is_("keyword","else")){next()}else{S.token.value="if"}belse=statement()}return new AST_If({condition:cond,body:body,alternative:belse})}function block_(){var a;expect(":");a=[];if(!S.token.nlb){while(!S.token.nlb){if(is_("eof")){unexpected()}a.push(statement())}}else{while(!is_("punc","}")){if(is_("eof")){return a}a.push(statement())}next()}return a}function switch_body_(){var a,cur,branch;expect("{");a=[];cur=null;branch=null;while(!is_("punc","}")){if(is_("eof")){unexpected()}if(is_("keyword","case")){if(branch){branch.end=prev()}cur=[];branch=new AST_Case({start:tmp=[S.token,next(),tmp],expression:expression(true),body:cur});a.push(branch);expect(":")}else if(is_("keyword","default")){if(branch){branch.end=prev()}cur=[];branch=new AST_Default({start:tmp=[S.token,next(),expect(":"),tmp],body:cur});a.push(branch)}else{if(!cur){unexpected()}cur.push(statement())}}if(branch){branch.end=prev()}next();return a}function try_(){var body,bcatch,exceptions,name,start,bfinally;body=block_();bcatch=[];bfinally=null;while(is_("keyword","except")){start=S.token;next();exceptions=[];if(!is_("punc",":")&&!is_("keyword","as")){exceptions.push(as_symbol(AST_SymbolVar));while(is_("punc",",")){next();exceptions.push(as_symbol(AST_SymbolVar))}}name=null;if(is_("keyword","as")){next();name=as_symbol(AST_SymbolCatch)}bcatch.push(new AST_Except({start:start,argname:name,errors:exceptions,body:block_(),end:prev()}))}if(is_("keyword","finally")){start=S.token;next();bfinally=new AST_Finally({start:start,body:block_(),end:prev()})}if(!bcatch.length&&!bfinally){croak("Missing except/finally blocks")}return new AST_Try({body:body,bcatch:bcatch.length?new AST_Catch({body:bcatch}):null,bfinally:bfinally})}function vardefs(no_in,in_const){var a;a=[];while(true){a.push(new AST_VarDef({start:S.token,name:as_symbol(in_const?AST_SymbolConst:AST_SymbolVar),value:is_("operator","=")?(next(),expression(false,no_in)):null,end:prev()}));if(!is_("punc",",")){break}next()}return a}function new_vardefs(no_in,in_const){var a;a=[];while(true){a.push(new AST_VarDef({start:S.token,name:new_symbol(in_const?AST_SymbolConst:AST_SymbolVar),value:is_("operator","=")?(next(),expression(false,no_in)):null,end:prev()}));if(!is_("punc",",")){break}next()}return a}nonlocal_=function(no_in){return new AST_Var({start:prev(),definitions:vardefs(no_in,false),end:prev()})};const_=function(){return new AST_Const({start:prev(),definitions:vardefs(false,true),end:prev()})};new_=function(){var start,newexp,args;start=S.token;expect_token("operator","new");newexp=expr_atom(false);if(is_("punc","(")){next();args=expr_list(")")}else{args=[]}return subscripts(new AST_New({start:start,expression:newexp,args:args,end:prev()}),true)};function as_atom_node(){var tok,tmp_,tmp__,ret;tok=S.token;tmp_=tok.type;if(tmp_==="name"){return as_symbol(AST_SymbolRef)}else if(tmp_==="num"){ret=new AST_Number({start:tok,end:tok,value:tok.value})}else if(tmp_==="string"){ret=new AST_String({start:tok,end:tok,value:tok.value})}else if(tmp_==="regexp"){ret=new AST_RegExp({start:tok,end:tok,value:tok.value})}else if(tmp_==="atom"){tmp__=tok.value;if(tmp__==="False"){ret=new AST_False({start:tok,end:tok})}else if(tmp__==="True"){ret=new AST_True({start:tok,end:tok})}else if(tmp__==="None"){ret=new AST_Null({start:tok,end:tok})}}next();return ret}expr_atom=function(allow_calls){var start,tmp_,ex,cls,func;if(is_("operator","new")){return new_()}start=S.token;if(is_("punc")){tmp_=start.value;if(tmp_==="("){next();ex=expression(true);ex.start=start;ex.end=S.token;expect(")");return subscripts(ex,allow_calls)}else if(tmp_==="["){return subscripts(array_(),allow_calls)}else if(tmp_==="{"){return subscripts(object_(),allow_calls)}unexpected()}if(is_("keyword","class")){next();cls=class_();cls.start=start;cls.end=prev();return subscripts(cls,allow_calls)}if(is_("keyword","def")){next();func=function_(false);func.start=start;func.end=prev();return subscripts(func,allow_calls)}if(ATOMIC_START_TOKEN[S.token.type]){return subscripts(as_atom_node(),allow_calls)}unexpected()};function expr_list(closing,allow_trailing_comma,allow_empty,func_call){var first,saw_starargs,tmp,_$rapyd$_Unpack,i,arg,a;first=true;a=[];saw_starargs=false;while(!is_("punc",closing)){if(saw_starargs){token_error(prev(),"*args must be the last argument in a function call")}if(first){first=false}else{expect(",")}if(allow_trailing_comma&&is_("punc",closing)){break}if(is_("operator","*")&&func_call){saw_starargs=true;next()}if(is_("punc",",")&&allow_empty){a.push(new AST_Hole({start:S.token,end:S.token}))}else{a.push(expression(false))}}if(func_call){tmp=[];tmp.kwargs=[];var _$rapyd$_Iter1=enumerate(a);for(var _$rapyd$_Index1=0;_$rapyd$_Index1<_$rapyd$_Iter1.length;_$rapyd$_Index1++){_$rapyd$_Unpack=_$rapyd$_Iter1[_$rapyd$_Index1];i=_$rapyd$_Unpack[0];arg=_$rapyd$_Unpack[1];if(arg instanceof AST_Assign){tmp.kwargs.push([arg.left,arg.right])}else{tmp.push(arg)}}a=tmp}next();if(saw_starargs){a.starargs=true}return a}function func_call_list(){return expr_list(")",false,false,true)}array_=embed_tokens(function(){var expr,forloop,ret;expect("[");expr=[];if(!is_("punc","]")){expr.push(expression(false));if(is_("keyword","for")){next();forloop=for_(true);ret=new AST_ListComprehension({statement:expr[0],init:forloop.init,name:forloop.name,object:forloop.object,condition:is_("punc","]")?null:(expect_token("keyword","if"),expression(true))});expect("]");return ret}if(is_("operator","til")){next();expr.push(expression(false));ret=subscripts(new AST_Call({start:S.token,expression:new AST_SymbolRef({name:"range"}),args:expr,end:prev()}),true);expect("]");return ret}else if(is_("operator","to")){next();expr.push(new AST_Binary({left:expression(false),operator:"+",right:new AST_Number({value:1})}));ret=subscripts(new AST_Call({start:S.token,expression:new AST_SymbolRef({name:"range"}),args:expr,end:prev()}),true);expect("]");return ret}else if(!is_("punc","]")){expect(",")}}return new AST_Array({elements:expr.concat(expr_list("]",!options.strict,true))})});object_=embed_tokens(function(){var a,first,start,type,key,name,quoted;expect("{");first=true;a=[];while(!is_("punc","}")){if(first){first=false}else{expect(",")}if(!options.strict&&is_("punc","}")){break}start=S.token;type=start.type;key=as_property_name();name=key.value;quoted=key.type==="string"?true:false;if(type==="name"&&!is_("punc",":")){if(name==="get"){a.push(new AST_ObjectGetter({start:start,key:name,quoted:quoted,value:function_(false,AST_Accessor),end:prev()}));continue}if(name==="set"){a.push(new AST_ObjectSetter({start:start,key:name,quoted:quoted,value:function_(false,AST_Accessor),end:prev()}));continue}}expect(":");a.push(new AST_ObjectKeyVal({start:start,key:name,quoted:quoted,value:expression(false),end:prev()}))}next();return new AST_Object({properties:a})});function as_property_name(){var tmp,tmp_;tmp=S.token;next();tmp_=tmp.type;if(tmp_==="num"||tmp_==="string"||tmp_==="name"||tmp_==="operator"||tmp_==="keyword"||tmp_==="atom"){return tmp}else{unexpected()}}function as_name(){var tmp,tmp_;tmp=S.token;next();tmp_=tmp.type;if(tmp_==="name"||tmp_==="operator"||tmp_==="keyword"||tmp_==="atom"){return tmp.value}else{unexpected()}}function as_symbol(type,noerror){var name,sym;if(!is_("name")){if(!noerror){croak("Name expected")}return null}name=S.token.value;sym=new(name==="this"?AST_This:type)({name:String(S.token.value),start:S.token,end:S.token});next();return sym}function new_symbol(type,name){var sym;sym=new(name==="this"?AST_This:type)({name:String(name),start:null,end:null});return sym}function is_static_method(cls,method){if(cls.static&&cls.static.indexOf(method)!==-1){return true}else{return false}}subscripts=function(expr,allow_calls){var start,slice_bounds,is_slice,str_,ret,c,funcname,tmp_,args;start=expr.start;if(is_("punc",".")){next();return subscripts(new AST_Dot({start:start,expression:expr,property:as_name(),end:prev()}),allow_calls)}if(is_("punc","[")&&!S.token.nlb){next();slice_bounds=[];is_slice=false;if(is_("punc",":")){slice_bounds.push(new AST_Number({value:0}))}else{slice_bounds.push(expression(false))}if(is_("punc",":")){is_slice=true;next();if(!is_("punc","]")){slice_bounds.push(expression(false))}}expect("]");if(is_slice){return subscripts(new AST_Call({start:start,expression:new AST_Dot({start:start,expression:expr,property:"slice",end:prev()}),args:slice_bounds,end:prev()}),allow_calls)}else{return subscripts(new AST_Sub({start:start,expression:expr,property:slice_bounds[0],end:prev()}),allow_calls)}}if(allow_calls&&is_("punc","(")&&!S.token.nlb){next();if(expr instanceof AST_SymbolRef&&expr.name==="JS"){str_=expression(false);if(!(str_ instanceof AST_String)){token_error(prev(),"Compile-time function JS() can't process variables or expressions")}ret=new AST_Verbatim({start:start,value:str_.value,end:prev()});expect(")");return subscripts(ret,true)}else if(get_class_in_scope(expr)){return subscripts(new AST_New({start:start,expression:expr,args:func_call_list(),end:prev()}),true)}else{if(expr instanceof AST_Dot){c=get_class_in_scope(expr.expression)}if(c){funcname=expr;if(funcname.property==="__init__"){funcname.property="constructor"}return subscripts(new AST_ClassCall({start:start,"class":expr.expression,method:funcname.property,"static":is_static_method(c,funcname.property),args:func_call_list(),end:prev()}),true)}else if(expr instanceof AST_SymbolRef){tmp_=expr.name;if(tmp_==="abs"||tmp_==="bind"||tmp_==="rebind_all"||tmp_==="dir"||tmp_==="enumerate"||tmp_==="len"||tmp_==="mixin"||tmp_==="print"||tmp_==="range"||tmp_==="reversed"||tmp_==="getattr"||tmp_==="setattr"||tmp_==="hasattr"){BASELIB[expr.name]=true}else if(tmp_==="type"){return new AST_UnaryPrefix({start:start,operator:"typeof",expression:func_call_list()[0],end:prev()})}else if(tmp_==="isinstance"){args=func_call_list();return new AST_Binary({start:start,operator:"instanceof",left:args[0],right:args[1],end:prev()})}}return subscripts(new AST_Call({start:start,expression:expr,args:func_call_list(),end:prev()}),true)}}return expr};maybe_unary=function(allow_calls){var start,ex,val;start=S.token;if(is_("operator")&&UNARY_PREFIX(start.value)){next();if(start.value==="@"){if(is_("name")&&(peek().value==="@"||peek().value==="def"||peek().value==="class"||peek().value==="module")){S.decorators.push(S.token.value);next();return new AST_EmptyStatement}else{unexpected()}}ex=make_unary(AST_UnaryPrefix,start.value,maybe_unary(allow_calls));ex.start=start;ex.end=prev();return ex}val=expr_atom(allow_calls);while(is_("operator")&&UNARY_POSTFIX(S.token.value)&&!S.token.nlb){val=make_unary(AST_UnaryPostfix,S.token.value,val);val.start=start;val.end=S.token;next()}return val};function make_unary(ctor,op,expr){return new ctor({operator:op,expression:expr})}expr_op=function(left,min_prec,no_in){var not_in,op,prec,right,ret;op=is_("operator")?S.token.value:null;not_in=false;if(op==="!"&&peek().type==="operator"&&peek().value==="in"){next();op="in";not_in=true}if(op==="in"){if(no_in){op=null}else{BASELIB[op]=true}}prec=op!==null?PRECEDENCE[op]:null;if(prec!==null&&prec>min_prec){next();right=expr_op(maybe_unary(true),prec,no_in);ret=new AST_Binary({start:left.start,left:left,operator:op,right:right,end:right.end});if(not_in){ret=new AST_UnaryPrefix({start:left.start,operator:"!",expression:ret,end:right.end})}return expr_op(ret,min_prec,no_in)}return left};function expr_ops(no_in){return expr_op(maybe_unary(true),0,no_in)}maybe_conditional=function(no_in){var start,expr,yes;start=S.token;expr=expr_ops(no_in);if(is_("operator","?")){next();yes=expression(false);expect(":");return new AST_Conditional({start:start,condition:expr,consequent:yes,alternative:expression(false,no_in),end:peek()})}return expr};function is_assignable(expr){var tmp_;if(!options.strict){return true}tmp_=expr[0]+"";if(tmp_==="dot"||tmp_==="sub"||tmp_==="new"||tmp_==="call"){return true}else if(tmp_==="name"){return expr[1]!=="this"}}maybe_assign=function(no_in){var start,left,val;start=S.token;left=maybe_conditional(no_in);val=S.token.value;if(is_("operator")&&ASSIGNMENT(val)){if(is_assignable(left)){next();return new AST_Assign({start:start,left:left,operator:val,right:maybe_assign(no_in),end:prev()})}croak("Invalid assignment")}return left};expression=function(commas,no_in){var start,left,right,expr;start=S.token;expr=maybe_assign(no_in);if(commas){left=[expr];right=[];while(is_("punc",",")&&!peek().nlb){next();if(expr instanceof AST_Assign){left[left.length-1]=left.slice(-1)[0].left;return new AST_Assign({start:start,left:left.length===1?left[0]:new AST_Array({elements:left}),operator:expr.operator,right:new AST_Seq({car:expr.right,cdr:expression(true,no_in)}),end:peek()})}expr=maybe_assign(no_in);left.push(expr)}if(left.length>1&&left.slice(-1)[0]instanceof AST_Assign){left[left.length-1]=left.slice(-1)[0].left;return new AST_Assign({start:start,left:new AST_Array({elements:left}),operator:expr.operator,right:expr.right,end:peek()})}return function build_seq(a){if(a.length===1){return a[0]}return new AST_Seq({start:start,car:a.shift(),cdr:build_seq(a),end:peek()})}.call(this,left)}return expr};function in_loop(cont){var ret;S.in_loop+=1;ret=cont();S.in_loop-=1;return ret}return function(){var start,body,element,shebang,first_token,end,toplevel,assignments;start=S.token;body=[];first_token=true;while(!is_("eof")){element=statement();if(first_token&&element instanceof AST_Directive&&element.value.indexOf("#!")===0){shebang=element.value}else{body.push(element)}first_token=false}end=prev();toplevel=options.toplevel;if(toplevel){toplevel.body=toplevel.body.concat(body);toplevel.end=end}else{toplevel=new AST_Toplevel({start:start,body:body,strict:function(){var stmt;var _$rapyd$_Iter2=body;for(var _$rapyd$_Index2=0;_$rapyd$_Index2<_$rapyd$_Iter2.length;_$rapyd$_Index2++){stmt=_$rapyd$_Iter2[_$rapyd$_Index2];if(stmt instanceof AST_Directive&&stmt.value==="use strict"){return true}}return false}.call(this),shebang:shebang,end:end})}assignments=scan_for_local_vars(toplevel.body,false).filter(function(element,index,arr){return arr.lastIndexOf(element)===index});toplevel.localvars=[];assignments.forEach(function(item){toplevel.localvars.push(new_symbol(AST_SymbolVar,item))});toplevel.imports=IMPORTED;toplevel.baselib=BASELIB;return toplevel}.call(this)}function _$rapyd$_extends(child,parent){child.prototype=new parent;child.prototype.constructor=child}function _$rapyd$_in(val,arr){if(arr instanceof Array||typeof arr==="string")return arr.indexOf(val)!=-1;else{if(arr.hasOwnProperty(val))return true;return false}}function abs(n){return Math.abs(n)}function dir(item){var arr=[];for(var i in item){arr.push(i)}return arr}function len(obj){if(obj instanceof Array||typeof obj==="string")return obj.length;else{var count=0;for(var i in obj){if(obj.hasOwnProperty(i))count++}return count}}function range(start,stop,step){if(arguments.length<=1){stop=start||0;start=0}step=arguments[2]||1;var length=Math.max(Math.ceil((stop-start)/step),0);var idx=0;var range=new Array(length);while(idx<length){range[idx++]=start;start+=step}return range}function _$rapyd$_mixin(target,source,overwrite){for(var i in source){if(source.hasOwnProperty(i)&&(overwrite||typeof target[i]==="undefined"))target[i]=source[i]}}function _$rapyd$_bind(fn,thisArg){if(fn._orig)fn=fn._orig;if(thisArg===false)return fn;var ret=fn.bind(thisArg);ret._orig=fn;return ret}function enumerate(item){var arr=[];for(var i=0;i<item.length;i++){arr[arr.length]=[i,item[i]]}return arr}function _$rapyd$_print(){var args,output;args=[].slice.call(arguments,0);output=JSON.stringify(args);if("console"in window)console.log(output.substr(1,output.length-2))}function reversed(arr){var tmp=[];for(var i=arr.length-1;i>=0;i--){tmp.push(arr[i])}return tmp}function getattr(obj,name){return obj[name]}function setattr(obj,name,value){obj[name]=value}function hasattr(obj,name){return name in obj}/*This is a combined, compressed file.  Look at https://github.com/BruceSherwood/glowscript for source code and copyright information.*/
;(function(){})();